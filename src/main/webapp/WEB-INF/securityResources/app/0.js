"use strict";function changeTheme(a,b){function c(a,b){var c=$("<link rel='stylesheet' media='print' href='"+a+"'/>").appendTo("head");setTimeout(function(){b(),c.remove()},100)}function d(){var b,c=$(e).data("kendoSkin");b=h.eq(0).clone().attr("href",k),h.eq(0).before(b),h.remove(),$(e.documentElement).removeClass("k-"+c).addClass("k-"+a)}var e=document,f=$("link[href*='kendo.']",e.getElementsByTagName("head")[0]),g=f.filter("[href*='kendo.common']"),h=f.filter(":not([href*='kendo.common'])"),i=(location.href,/kendo\.\w+(\.min)?\.css/i),j="stylesheet"===h.attr("rel")?".css":".less",k=g.attr("href").replace(i,"kendo."+a+"$1"+j);$("#example");b?c(k,d):d()}function applyCurrentTheme(){try{sessionStorage&&sessionStorage.length&&(kendoSkin=sessionStorage.getItem("kendoSkin"),kendoSkin&&changeTheme(kendoSkin))}catch(a){}}$.fn.themeChooser=function(a){a=$.extend({largeIcons:!0},a);var b=[{text:"Material Black",value:"materialblack"},{text:"Blue Opal",value:"blueopal"},{text:"Default",value:"default"},{text:"Metro",value:"metro"},{text:"Moonlight",value:"moonlight"},{text:"High Contrast",value:"highcontrast"},{text:"Flat",value:"flat"}],c=kendo.template("<li data-value='#=value#' class='skin-#=value#'><span>#= text #</span></li>"),d=function(a){changeTheme(a,!0);try{sessionStorage.setItem("kendoSkin",a)}catch(b){}};return this.each(function(){var a;try{a=sessionStorage.getItem("kendoSkin")}catch(e){}a=a||"blueopal",$(this).html(kendo.render(c,b)).on("click","li",function(){var a=$(this).children("span").addClass("k-state-selected").end(),c=b[a.index()];a.siblings().children("span").removeClass("k-state-selected"),d(c.value)}).children().filter(function(){return $(this).data("value")===a}).children("span").addClass("k-state-selected")})},$("#themeChooser").themeChooser(),applyCurrentTheme(),angular.module("Authentication",[]),angular.module("angulardemoApp",["ngCookies","ngResource","ngSanitize","pascalprecht.translate","ui.router","ct.ui.router.extras.sticky","ui.bootstrap","kendo.directives","Authentication","cgPrompt"]).config(["$translateProvider",function(a){a.useStaticFilesLoader({prefix:"/BookingSystem//BookingSystem/app/i18n/locale.",suffix:".json"})}]).config(["$stateProvider","$urlRouterProvider","$locationProvider",function(a,b,c){c.html5Mode(!0)}]).controller("AppMenuCtrl",["$rootScope","$scope","$timeout","$window","$translate","$state","$compile","$q","loadParaService","$http","prompt2",function(a,b,c,d,e,f,g,h,i,j,k){function l(){b.loadingDone||(100==b.percentDone?(b.percentDone=0,c(l,1e3)):(b.percentDone+=2,c(l,200)))}var m=h.defer();b.loadingDone=!1;var n;a.serviceRoot="/BookingSystem",i.query(function(c){console.log("Data has been fetched from server"),a.userLanguage="zh-HK",a.appParameters=c[0],a.userName=a.appParameters.currentUserName,""===a.userName||null===a.userName?b.welcomeInfoVisible=!1:b.welcomeInfoVisible=!0,j({method:"GET",url:a.serviceRoot+"/menu/tree/forUser"}).success(function(a){b.treeDataOptions.dataSource=new kendo.data.HierarchicalDataSource({data:a,schema:{model:{children:"items"}}})}),j({method:"GET",url:a.serviceRoot+"/menu/userTree"}).success(function(a){m.resolve(),b.lastTreeDataOptions.dataSource=new kendo.data.HierarchicalDataSource({data:a,schema:{model:{children:"items"}}})})},function(a){console.log(a)}),h.all([n,i,m.promise]).then(function(){console.log("All services are resolved!"),console.log("$rootScope.userLanguage:",a.userLanguage);var g=angular.element(d);c(function(){g.triggerHandler("resize")}),$.when($.getScript("/BookingSystem//BookingSystem/bower_components/kendo-ui/js/messages/kendo.messages."+a.userLanguage+".min.js"),$.getScript("/BookingSystem//BookingSystem/bower_components/kendo-ui/js/cultures/kendo.culture."+a.userLanguage+".min.js")).then(function(){b.$apply(function(){e.use(a.userLanguage),kendo.culture(a.userLanguage),f.go("/")})}),b.loadingDone=!0},function(a){console.log(a),b.failure=a}),b.showpage=!0,b.treeDataOptions={},b.lastTreeDataOptions={},b.treeclick=function(c){if("#"!=c.widget){var d=!1;if(angular.forEach(b.lastTreeDataOptions.dataSource.options.data,function(a){"undefined"!=typeof a&&a.text===c.text&&(d=!0)}),d||b.lastTreeDataOptions.dataSource.options.data.push({text:c.text,spriteCssClass:"fa fa-paper-plane",url:c.widget,menuId:c.id,userId:a.appParameters.currentUser}),f.go(c.widget),!d){var e=b.lastTreeDataOptions.dataSource.options.data;j({method:"POST",url:a.serviceRoot+"/menu/saveLastMenu",data:JSON.stringify(e)}).then(function(a){b.lastTreeDataOptions.dataSource=new kendo.data.HierarchicalDataSource({data:a.data})},function(a){console.log(" save..failure")})}}},b.lastTreeClick=function(a){console.log("menu:"+a.url),console.log(a),"#"!==a.url&&f.go(a.url)},b.remove=function(c){var d=c.parent(),e=d.indexOf(c);d.splice(e,1),b.lastTreeDataOptions.dataSource.options.data.splice(e,1),f.includes(c.url)?f.go("/"):console.log("no found index:"+e+" route:"+c.url);var g=b.lastTreeDataOptions.dataSource.options.data;j({method:"POST",url:a.serviceRoot+"/menu/saveLastMenu",data:JSON.stringify(g)}).then(function(a){console.log("lastest menu saved..")},function(a){console.log(" save..failure")})},b.$watch("$viewContentLoaded",function(){}),b.langDataSource=[{langDesc:"English",langCode:"en-US"},{langDesc:"Chinese Traditional",langCode:"zh-HK"},{langDesc:"Chinese simple",langCode:"zh-CN"}],b.change=function(a){$.getScript("/BookingSystem//BookingSystem/bower_components/kendo-ui/js/messages/kendo.messages."+a.sender.element[0].value+".min.js",function(){b.$apply(function(){e.use(a.sender.element[0].value),kendo.culture(a.sender.element[0].value)})})},b.toolbarOptions={items:[{type:"button",text:"Save",id:"savebtn",spriteCssClass:"k-tool-icon k-justifyLeft"},{type:"button",text:"Edit",id:"editbtn",spriteCssClass:"k-icon netherlandsFlag"},{type:"button",text:"Delete",id:"deletebtn",spriteCssClass:"k-icon netherlandsFlag"},{type:"separator"}]},b.percentDone=0,l()}]).directive("resize",["$window","$rootScope",function(a,b){return function(c,d){var e=angular.element(a);c.getWindowDimensions=function(){return{h:e.height(),w:e.width()}},c.$watch(c.getWindowDimensions,function(a,d){c.windowHeight=a.h,c.windowWidth=a.w,b.homeHeight=a.h-20-100-50,c.style=function(){return{height:a.h-10+"px",width:a.w-10+"px"}}},!0),e.bind("resize",function(){c.$apply()})}}]).directive("resize2",["$window","$rootScope",function(a,b){return function(c,d){var e=angular.element(a);c.getWindowDimensions=function(){return{h:e.height(),w:e.width()}},c.$watch(c.getWindowDimensions,function(a,d){c.windowHeight=a.h,c.windowWidth=a.w,b.windowHeight=a.h-10-150-10,c.style2=function(){return{height:a.h-10-150-10+"px"}},c.style3=function(){return{height:a.h-10-150-10-.3*(a.h-10-150-10)-100+"px"}}},!0),e.bind("resize2",function(){c.$apply()})}}]).directive("addbuttons",["$compile",function(a){return function(b,c,d){c.bind("click",function(){angular.element(document.getElementById("lastest_pages")).append(a("<button class='btn btn-default' data-alert=''>Show alert #</button>")(b))})}}]).directive("backgroundImageDirective",function(){return function(a,b,c){b.css({"background-image":"url("+c.backgroundImageDirective+")","background-repeat":"repeat"})}}).run(["$rootScope","$location","$cookieStore","$http",function(a,b,c,d){a.globals=c.get("globals")||{},a.globals.currentUser&&(d.defaults.headers.common.Authorization="Basic "+a.globals.currentUser.authdata)}]).factory("loadParaService",["$resource","$http",function(a,b){return a("/BookingSystem/booking/readSystemParas")}]).factory("parseException",["$rootScope","prompt2",function(a,b){return{alertmsg:function(c,d){var e=c.xhr.responseJSON;if("undefined"!=typeof e&&404===e.code){var f=e.message.split("|");b({title:a.exceptionDialog,message:d[f[0]],buttons:[{label:a.confirmLabel,cancel:!0,primary:!1}]})}else console.log("Application exception is thrown.............................."),console.log(e)}}}]),angular.module("Authentication").factory("AuthenticationService",["Base64","$http","$cookieStore","$rootScope","$timeout",function(a,b,c,d,e){var f={};return f.Login=function(a,b,c){e(function(){var d={success:"test"===a&&"test"===b};d.success||(d.message="Username or password is incorrect"),c(d)},1e3)},f.SetCredentials=function(e,f){var g=a.encode(e+":"+f);d.globals={currentUser:{username:e,authdata:g}},b.defaults.headers.common.Authorization="Basic "+g,c.put("globals",d.globals)},f.ClearCredentials=function(){d.globals={},c.remove("globals"),b.defaults.headers.common.Authorization="Basic "},f}]).factory("Base64",function(){var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return{encode:function(b){var c,d,e,f,g,h="",i="",j="",k=0;do c=b.charCodeAt(k++),d=b.charCodeAt(k++),i=b.charCodeAt(k++),e=c>>2,f=(3&c)<<4|d>>4,g=(15&d)<<2|i>>6,j=63&i,isNaN(d)?g=j=64:isNaN(i)&&(j=64),h=h+a.charAt(e)+a.charAt(f)+a.charAt(g)+a.charAt(j),c=d=i="",e=f=g=j="";while(k<b.length);return h},decode:function(b){var c,d,e,f,g,h="",i="",j="",k=0,l=/[^A-Za-z0-9\+\/\=]/g;l.exec(b)&&window.alert("There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\nExpect errors in decoding."),b=b.replace(/[^A-Za-z0-9\+\/\=]/g,"");do e=a.indexOf(b.charAt(k++)),f=a.indexOf(b.charAt(k++)),g=a.indexOf(b.charAt(k++)),j=a.indexOf(b.charAt(k++)),c=e<<2|f>>4,d=(15&f)<<4|g>>2,i=(3&g)<<6|j,h+=String.fromCharCode(c),64!=g&&(h+=String.fromCharCode(d)),64!=j&&(h+=String.fromCharCode(i)),c=d=i="",e=f=g=j="";while(k<b.length);return h}}}),angular.module("angulardemoApp").controller("BookschedulerCtrl",["$scope","$http","$rootScope","$window","$timeout","$q","prompt2","checkUserService","$translate","parseException",function(a,b,c,d,e,f,g,h,i,j){function k(a,b,c,d,e){var f=$("#scheduler").getKendoScheduler(),g=f.occurrencesInRange(a,b),h=g.indexOf(d);return h>-1&&g.splice(h,1),d=$.extend({},d,e),l(g,c,d[c])}function l(b,c,d){for(var e,f=[],g=!1,h=0;h<a.schedulerOptions_resourceDS.data().length;h++){var i=a.schedulerOptions_resourceDS.data()[h];if(i.value==d){g=i.overlap;break}}if(g)return[];for(var j=0,k=b.length;k>j;j++)e=b[j],e[c]===d&&f.push(e);return f}function m(a,b,c,d){var e=k(a,b,"itemId",c,d);return e.length>0?!0:!1}function n(b,c,d,e){return b.getTime()<a.schedulerOptions_date.getTime()?!0:!1}function o(a,b,c,d){if(r.length>0&&"undefined"!=typeof c){for(var e=!0,f=moment(a),g=!1,h=0;h<r.length;h++){var i=r[h],j=c.itemId;"undefined"!=typeof d&&(j=d.itemId),i.itemId===j&&f.isSame(moment(i.startTime))&&(g=!0)}if(g||(e=!1),!e)return!0}return!1}function p(b,c,d,e){return n(b,c,d,e)?(setTimeout(function(){g({title:a.ExceptionDialog,message:a.BookExpired,buttons:[{label:a.confirmLabel,cancel:!0,primary:!1}]})},0),!1):m(b,c,d,e)?(setTimeout(function(){g({title:a.ExceptionDialog,message:a.BookOverlap,buttons:[{label:a.confirmLabel,cancel:!0,primary:!1}]})},0),!1):o(b,c,d,e)?(setTimeout(function(){g({title:a.ExceptionDialog,message:a.BookUnavailabel,buttons:[{label:a.confirmLabel,cancel:!0,primary:!1}]})},0),!1):!0}var q=angular.element(d);e(function(){q.triggerHandler("resize")}),i(["Edit","Delete","Move","Copy","Cancel","CloseWin","Confirm","Retry","PasswordDialog","InvalidPassword","EnterPasswordTip","OccupiedMore","CancelCopy","CancelMove","BookGridTitle","BookGridItem","BookGridStart","NoRecordSelected","DeleteWarning","MoveWaning","CopyWarning","BookExpired","BookOverlap","BookUnavailabel","BookDeleteItem","PatientName","PatientSex","PatientHkid","PatientTel","PatientBookItem","BookingAlerts","CurrentBooking","AllBookings","Remark","Duration","ServiceItem1","ServiceItem2","ServiceItem3","ServiceItem4","ServiceItem5","EnglishName","ChineseName","NewBookingButton","PopupEdit","DayOfBirth","ReferingDoctor","ReferingDrPhone","PatientAlert","SpecialRequest"]).then(function(b){a.editLabel=b.Edit,a.deleteLabel=b.Delete,a.moveLabel=b.Move,a.copyLabel=b.Copy,a.closeWinLabel=b.CloseWin,a.passwordDialog=b.PasswordDialog,a.invalidPassword=b.InvalidPassword,a.enterPasswordTip=b.EnterPasswordTip,a.cancelLabel=b.Cancel,a.confirmLabel=b.Confirm,a.retry=b.Retry,a.occupiedMore=b.OccupiedMore,a.BookGridTitle=b.BookGridTitle,a.BookGridItem=b.BookGridItem,a.BookGridStart=b.BookGridStart,a.NoRecordSelected=b.NoRecordSelected,a.DeleteWarning=b.DeleteWarning,a.MoveWaning=b.MoveWaning,a.CopyWarning=b.CopyWarning,a.BookUnavailabel=b.BookUnavailabel,a.BookExpired=b.BookExpired,a.BookOverlap=b.BookOverlap,a.BookDeleteItem=b.BookDeleteItem,a.CancelCopy=b.CancelCopy,a.CancelMove=b.CancelMove,a.PatientName=b.PatientName,a.PatientSex=b.PatientSex,a.PatientHkid=b.PatientHkid,a.PatientTel=b.PatientTel,a.PatientBookItem=b.PatientBookItem,a.BookingAlerts=b.BookingAlerts,a.CurrentBooking=b.CurrentBooking,a.Remark=b.Remark,a.Duration=b.Duration,a.ServiceItem1=b.ServiceItem1,a.ServiceItem2=b.ServiceItem2,a.ServiceItem3=b.ServiceItem3,a.ServiceItem4=b.ServiceItem4,a.ServiceItem5=b.ServiceItem5,a.EnglishName=b.EnglishName,a.ChineseName=b.ChineseName,a.NewBookingButton=b.NewBookingButton,a.PopupEdit=b.PopupEdit,a.DayOfBirth=b.DayOfBirth,a.ReferingDoctor=b.ReferingDoctor,a.ReferingDrPhone=b.ReferingDrPhone,a.PatientAlert=b.PatientAlert,a.SpecialRequest=b.SpecialRequest}),a.schedulerDateInterval=10,a.resetBackground=!0,a.firstClinic=1,a.cancelCopyVisible=!1,a.cancelMoveVisible=!1,a.disableGridToolbar=!1,a.selectedData=null,a.currentEditUser=null,a.md5Password=null,a.allBookingColor="#0E9619",a.currentBookingColor="#ff4500",a.messageAlertsColor="#E88C2A",a.bookingCellColor="#A8A7A5",a.disableDIV=!1,a.AllItemsForCurrentEdit=[];var r=[];b({method:"POST",url:a.serviceRoot+"/booking/clinics"}).success(function(d){function e(b){j.alertmsg(b,a.errorMessages)}function f(b){$("<div/>").appendTo(b.detailCell).kendoGrid({dataSource:{batch:!0,transport:{read:{url:a.serviceRoot+"/booking/read/grid",dataType:"json",type:"POST",contentType:"application/json"},parameterMap:function(c,d){if("read"!==d&&c.models)return JSON.stringify(c.models);if("read"===d){var e={start:moment(a.readDate).format("YYYY-MM-DDTHH:mm:ss.sss")+"Z",view:null==a.readView?"day":a.readView,clinicId:null==$("#clinics").val()?a.firstClinic:$("#clinics").val(),bookId:b.data.bookId},f=[e];return JSON.stringify(f)}}},schema:{model:{id:"taskId",fields:{taskId:{from:"taskId",type:"number"},bookId:{from:"bookId",type:"number"},title:{from:"title",defaultValue:"No title",validation:{required:!0}},start:{type:"date",from:"start",validation:{required:!0}},end:{type:"date",from:"end",validation:{required:!0}},description:{from:"description"},itemId:{from:"itemId",type:"number",validation:{required:!0}},clinicId:{from:"clinicId",type:"number",validation:{required:!0}},isAllDay:{type:"boolean",from:"isAllDay"},bookStatus:{from:"bookStatus"},clientIp:{from:"clientIp"},md5Password:{from:"md5Password"},itemCatCode:{from:"itemCatCode"},lastUpdateUser:{from:"lastUpdateUser"},serviceItem1:{from:"serviceItem1"},serviceItem2:{from:"serviceItem2"},serviceItem3:{from:"serviceItem3"},serviceItem4:{from:"serviceItem4"},serviceItem5:{from:"serviceItem5"},serviceItemDesc1:{from:"serviceItemDesc1"},serviceItemDesc2:{from:"serviceItemDesc2"},serviceItemDesc3:{from:"serviceItemDesc3"},serviceItemDesc4:{from:"serviceItemDesc4"},serviceItemDesc5:{from:"serviceItemDesc5"},serviceItemMsg1:{from:"serviceItemMsg1"},serviceItemMsg2:{from:"serviceItemMsg2"},serviceItemMsg3:{from:"serviceItemMsg3"},serviceItemMsg4:{from:"serviceItemMsg4"},serviceItemMsg5:{from:"serviceItemMsg5"},serviceItems:{from:"serviceItems"},serviceRemark:{from:"serviceRemark"},bookDuration:{type:"number",from:"bookDuration"},itemDesc:{from:"itemDesc"},clinicDesc:{from:"clinicDesc"}}}}},scrollable:!0,sortable:!0,pageable:!1,editable:"inline",rowTemplate:kendo.template($("#bookSubGridRowTemplate").html()),columns:[{field:"itemDesc",title:a.BookGridItem,width:100},{field:"start",title:a.BookGridStart,template:'#: kendo.format("{0:yyyy-MM-dd}", start)#&nbsp;<font color=red><b>#: kendo.format("{0:HH:mm}", start)#</b></font>',width:150},{field:"bookDuration",title:a.Duration,format:"{0:0}",width:90},{field:"serviceItems",title:a.PatientBookItem}]})}function i(b){b.preventDefault(),a.currentBookGrid.editRow($(b.currentTarget).closest("tr"))}function k(d){var e=g({title:c.WarningDialog,message:c.DeleteItem,buttons:[{label:a.Cancel,cancel:!0,primary:!1},{label:a.confirmLabel,cancel:!1,primary:!1}]});e.then(function(c){var e=$("#currentBookGridID").getKendoGrid(),f=e.dataItem($(d.target).closest("tr")),h=[f];b({method:"POST",url:a.serviceRoot+"/booking/destroy/patientbook",data:JSON.stringify(h)}).then(function(b){a.bookScheduler.dataSource.read(),a.closeBook()},function(b){g({title:a.exceptionDialog,message:a.OperationFailure,buttons:[{label:a.confirmLabel,cancel:!0,primary:!1}]})})})}function l(b){b.preventDefault();var c=$("#currentDetailGridID").getKendoGrid();c.options.editable={mode:"popup",template:kendo.template($("#customEditorTemplate").html())},a.bookItemForDetailEditObject=c.dataItem($(b.currentTarget).closest("tr")),c.editRow($(b.currentTarget).closest("tr")),c.options.editable="inline"}function q(b){if(!a.disableGridToolbar){b.preventDefault();var c=$("#currentDetailGridID").getKendoGrid();a.bookItemForDetailEditObject=c.dataItem($(b.currentTarget).closest("tr")),a.selectedData=a.bookItemForDetailEditObject,a.selectedData.md5Password=a.md5Password,console.log(a.selectedData),a.disableToolbar("copy"),a.disableDIV=!0,a.$apply()}}function s(b){if(!a.disableGridToolbar){b.preventDefault();var c=$("#currentDetailGridID").getKendoGrid();a.bookItemForDetailEditObject=c.dataItem($(b.currentTarget).closest("tr")),a.selectedData=a.bookItemForDetailEditObject,a.selectedData.md5Password=a.md5Password,a.disableToolbar("move"),a.disableDIV=!0,a.$apply()}}a.firstClinic=d[0].id,a.clinicsOptions={dataSource:d,dataTextField:"clinicName",dataValueField:"id"},b({method:"POST",url:a.serviceRoot+"/booking/schedulerParas/"+d[0].id}).success(function(d){a.schedulerOptions_allDaySlot=d.allDaySlot,a.schedulerOptions_allDaySlotviews=d.views,a.schedulerOptions_date=new Date(d.date),a.schedulerOptions_startTime=new Date(d.startTime),a.schedulerOptions_endTime=new Date(d.endTime),a.schedulerOptions_majorTick=d.majorTick,a.schedulerOptions_minorTickCount=d.minorTickCount,a.schedulerOptions_mobile=d.mobile,a.schedulerOptions_footer=d.footer,a.schedulerOptions_groupOrientation=d.groupOrientation,a.schedulerOptions_resourceDS=new kendo.data.DataSource({data:d.resourceDs}),console.log("resourceds...."),console.log(a.schedulerOptions_resourceDS),a.readDate=new Date(d.date),a.schedulerOptions_height=c.windowHeight-30-10,a.readView="day",a.editable=!0,a.schedulerDateInterval=a.schedulerOptions_majorTick/a.schedulerOptions_minorTickCount,a.bookGrid.dataSource.read();var e=$("#bookGridID").getKendoGrid();e.hideColumn(3),e.hideColumn(4),e.hideColumn(5),e.hideColumn(9),e.hideColumn(10),e.hideColumn(11),e.hideColumn(12),e.hideColumn(13),a.scheduleDataSource=new kendo.data.SchedulerDataSource({batch:!0,transport:{read:{url:a.serviceRoot+"/booking/read/scheduler",dataType:"json",type:"POST",contentType:"application/json"},update:{url:a.serviceRoot+"/booking/update",dataType:"json",type:"POST",contentType:"application/json"},create:{url:a.serviceRoot+"/booking/create",dataType:"json",type:"POST",contentType:"application/json"},destroy:{url:a.serviceRoot+"/booking/destroy",dataType:"json",type:"POST",contentType:"application/json"},parameterMap:function(b,c){if("read"!==c&&b.models)return JSON.stringify(b.models);if("read"===c){var d=($("#scheduler").data("kendoScheduler"),{start:moment(a.readDate).format("YYYY-MM-DDTHH:mm:ss.sss")+"Z",view:a.readView,clinicId:$("#clinics").val()}),e=[d];return null!==d.clinicId?JSON.stringify(e):JSON.stringify([])}}},schema:{model:{id:"taskId",fields:{taskId:{from:"taskId",type:"number"},bookId:{from:"bookId",type:"number"},title:{from:"title",defaultValue:"??????????",validation:{required:!0}},start:{type:"date",from:"start",validation:{required:!0}},end:{type:"date",from:"end",validation:{required:!0}},description:{from:"description"},itemId:{from:"itemId",type:"number",validation:{required:!0}},clinicId:{from:"clinicId",type:"number",validation:{required:!0}},isAllDay:{type:"boolean",from:"isAllDay"},bookStatus:{from:"bookStatus"},clientIp:{from:"clientIp"},md5Password:{from:"md5Password"},itemCatCode:{from:"itemCatCode"},lastUpdateUser:{from:"lastUpdateUser"},serviceItem1:{from:"serviceItem1"},serviceItem2:{from:"serviceItem2"},serviceItem3:{from:"serviceItem3"},serviceItem4:{from:"serviceItem4"},serviceItem5:{from:"serviceItem5"},serviceItems:{from:"serviceItems"},serviceItemDesc1:{from:"serviceItemDesc1"},serviceItemDesc2:{from:"serviceItemDesc2"},serviceItemDesc3:{from:"serviceItemDesc3"},serviceItemDesc4:{from:"serviceItemDesc4"},serviceItemDesc5:{from:"serviceItemDesc5"},serviceRemark:{from:"serviceRemark"},bookDuration:{type:"number",from:"bookDuration"}}}}}),a.schedulerOptions={culture:c.userLanguage,editable:{confirmation:a.BookDeleteItem,create:a.editable,destroy:!1,move:a.editable,resize:!1,template:$("#customEditorTemplate").html()},date:a.schedulerOptions_date,startTime:a.schedulerOptions_startTime,endTime:a.schedulerOptions_endTime,height:a.schedulerOptions_height,allDaySlot:a.schedulerOptions_allDaySlot,majorTick:a.schedulerOptions_majorTick,minorTickCount:a.schedulerOptions_minorTickCount,mobile:a.schedulerOptions_mobile,footer:a.schedulerOptions_footer,views:a.schedulerOptions_allDaySlotviews,timezone:"Etc/UTC",currentTimeMarker:{useLocalTimezone:!1},dataSource:a.scheduleDataSource,group:{resources:["Rooms"],orientation:a.schedulerOptions_groupOrientation},resources:[{field:"itemId",name:"Rooms",dataSource:a.schedulerOptions_resourceDS,title:"Item"}],resize:function(a){(n(a.start,a.end,a.event,a.resources)||m(a.start,a.end,a.event,a.resources)||o(a.start,a.end,a.event,a.resources))&&(this.wrapper.find(".k-marquee-color").addClass("invalid-slot"),a.preventDefault())},resizeEnd:function(a){p(a.start,a.end,a.events)||a.preventDefault()},move:function(a){(n(a.start,a.end,a.event,a.resources)||m(a.start,a.end,a.event,a.resources))&&(this.wrapper.find(".k-event-drag-hint").addClass("invalid-slot"),a.preventDefault())},moveEnd:function(a){p(a.start,a.end,a.event,a.resources)||a.preventDefault()},add:function(a){p(a.event.start,a.event.end,a.event)||a.preventDefault()},save:function(c){if(p(c.event.start,c.event.end,c.event)){c.preventDefault();var d="";if(c.event.isNew()?d="/booking/create":(d="/booking/update",null!=a.currentEditUser&&c.event.bookId===a.selectedPatientForEdit&&c.event.set("md5Password",a.md5Password)),""!==c.event.md5Password&&null!==c.event.md5Password){c.event.set("lastUpdateUser",a.currentEditUser);var e=[c.event];b({method:"POST",url:a.serviceRoot+d,data:JSON.stringify(e)}).then(function(b){a.bookScheduler.dataSource.read(),a.bookGrid.dataSource.read(),a.currentBookGridOptions.dataSource.read(),a.currentDetailGridOptions.dataSource.read(),0==b.data.length},function(b){g({title:a.ExceptionDialog,message:"Failed to do!",buttons:[{label:a.confirmLabel,cancel:!0,primary:!1}]})})}else{var f=g({title:a.passwordDialog,message:"",input:!0,inputtype:"password",label:a.enterPasswordTip,value:"",buttons:[{label:a.cancelLabel,cancel:!0,primary:!1},{label:a.confirmLabel,cancel:!1,primary:!1}]});f.then(function(d){console.log(d);var e=h.query(a.serviceRoot,d);e.then(function(e){if(e){c.event.set("md5Password",d);var f=[c.event];b({method:"POST",url:a.serviceRoot+"/booking/update",data:JSON.stringify(f)}).then(function(b){a.bookScheduler.dataSource.read(),a.bookGrid.dataSource.read(),a.currentBookGridOptions.dataSource.read(),a.currentDetailGridOptions.dataSource.read()},function(b){g({title:a.ExceptionDialog,message:a.OperationFailure,buttons:[{label:a.confirmLabel,cancel:!0,primary:!1}]})})}else{g({title:a.passwordDialog,message:a.invalidPassword,buttons:[{label:a.confirmLabel,cancel:!0,primary:!1}]})}})},function(){console.log("reject..."),a.bookScheduler.dataSource.read()})}}else c.preventDefault(),a.bookScheduler.dataSource.read()},remove:function(c){if(p(c.event.start,c.event.end,c.event)){c.preventDefault();var d=g({title:a.passwordDialog,message:"",input:!0,inputtype:"password",label:a.enterPasswordTip,value:"",buttons:[{label:a.cancelLabel,cancel:!0,primary:!1},{label:a.confirmLabel,cancel:!1,primary:!1}]});d.then(function(d){var e=h.query(a.serviceRoot,d);e.then(function(d){if(d){var e=[c.event];b({method:"POST",url:a.serviceRoot+"/booking/destroy",data:JSON.stringify(e)}).then(function(b){a.bookScheduler.dataSource.read(),a.bookGrid.dataSource.read(),a.currentBookGridOptions.dataSource.read(),a.currentDetailGridOptions.dataSource.read()},function(b){g({title:a.ExceptionDialog,message:a.OperationFailure,buttons:[{label:a.confirmLabel,cancel:!0,primary:!1}]})})}else{var f=g({title:a.passwordDialog,message:a.invalidPassword,buttons:[{label:a.confirmLabel,cancel:!0,primary:!1},{label:a.retry,cancel:!1,primary:!1}]});f.then(function(){a.bookScheduler.removeEvent(c.event)})}})})}else c.preventDefault()},edit:function(c){var d=c.sender.element.find('div.k-event[data-uid="'+c.event.uid+'"]'),e=a.bookScheduler.slotByElement(d);e.element;if($(e.element).hasClass("k-nonwork-hour"))c.preventDefault();else{c.event.set("clinicId",parseInt($("#clinics").val()));var f=$("#scheduler").data("kendoScheduler");if(f.cancelEvent(),c.event.isNew())if(a.disableGridToolbar&&a.cancelMoveVisible){c.preventDefault();var i=parseInt(a.selectedData.start.getMinutes()),j=parseInt(a.selectedData.end.getMinutes()),k=6e4*(j-i),l=new Date;l.setTime(c.event.start.getTime()+k),a.selectedData.set("clinicId",parseInt($("#clinics").val())),a.selectedData.set("start",c.event.start),a.selectedData.set("end",l),a.selectedData.set("itemId",c.event.itemId),a.selectedData.set("bookId",a.selectedPatientForEdit),console.log("move data:");var m=[a.selectedData];b({method:"POST",url:a.serviceRoot+"/booking/movebook",data:JSON.stringify(m)}).then(function(b){a.bookScheduler.dataSource.read(),a.bookGrid.dataSource.read(),a.currentBookGridOptions.dataSource.read(),a.currentDetailGridOptions.dataSource.read(),a.enableToolbar()},function(b){g({title:a.ExceptionDialog,message:a.OperationFailure,buttons:[{label:a.confirmLabel,cancel:!0,primary:!1}]})})}else if(a.disableGridToolbar&&a.cancelCopyVisible){c.preventDefault();var i=parseInt(a.selectedData.start.getMinutes()),j=parseInt(a.selectedData.end.getMinutes()),k=6e4*(j-i),l=new Date;l.setTime(c.event.start.getTime()+k),a.selectedData.set("clinicId",parseInt($("#clinics").val())),a.selectedData.set("start",c.event.start),a.selectedData.set("end",l),a.selectedData.set("itemId",c.event.itemId),a.selectedData.set("bookId",a.selectedPatientForEdit);var m=[a.selectedData];b({method:"POST",url:a.serviceRoot+"/booking/copybook",data:JSON.stringify(m)}).then(function(b){a.bookScheduler.dataSource.read(),a.bookGrid.dataSource.read(),a.currentBookGridOptions.dataSource.read(),a.currentDetailGridOptions.dataSource.read(),a.enableToolbar()},function(b){a.enableToolbar(),g({title:a.ExceptionDialog,message:a.OperationFailure,buttons:[{label:a.confirmLabel,cancel:!0,primary:!1}]})})}else if(null==a.currentEditUser){var n=g({title:a.passwordDialog,message:"",input:!0,inputtype:"password",label:a.enterPasswordTip,value:"",buttons:[{label:a.cancelLabel,cancel:!0,primary:!1},{label:a.confirmLabel,cancel:!1,primary:!1}]});n.then(function(d){console.log(d);var e=h.query(a.serviceRoot,d);e.then(function(e){if(e){a.currentEditUser=e,a.md5Password=d,c.event.set("bookStatus","occupied");var f=[c.event];b({method:"POST",url:a.serviceRoot+"/booking/create",data:JSON.stringify(f)}).then(function(b){a.currentGridVisible=!0,a.selectedPatientForEdit=b.data[0].bookId,a.bookScheduler.dataSource.read(),a.currentBookGridOptions.dataSource.read(),a.currentDetailGridOptions.dataSource.read()},function(b){g({title:a.ExceptionDialog,message:a.OperationFailure,buttons:[{label:a.confirmLabel,cancel:!0,primary:!1}]}),c.preventDefault()})}else{g({title:a.passwordDialog,message:a.invalidPassword,buttons:[{label:a.confirmLabel,cancel:!0,primary:!1}]})}})})}else{c.event.set("bookStatus","occupied"),c.event.set("bookId",a.selectedPatientForEdit);var m=[c.event];b({method:"POST",url:a.serviceRoot+"/booking/create",data:JSON.stringify(m)}).then(function(b){a.currentGridVisible=!0,a.selectedPatientForEdit=b.data[0].bookId,a.bookScheduler.dataSource.read(),a.bookGrid.dataSource.read(),a.currentBookGridOptions.dataSource.read(),a.currentDetailGridOptions.dataSource.read()},function(b){g({title:a.ExceptionDialog,message:a.OperationFailure,buttons:[{label:a.confirmLabel,cancel:!0,primary:!1}]})})}}},navigate:function(b){"month"==b.view&&console.log("month view"),("day"==b.view||"week"==b.view)&&(a.resetBackground=!0),a.readDate=b.date,a.readView=b.view,a.bookScheduler.dataSource.read(),a.bookGrid.dataSource.read()},dataBound:function(c){if(a.resetBackground){var d=this;kendo.ui.progress($("#scheduler"),!0),r=[],b({method:"GET",url:a.serviceRoot+"/booking/schedulerNoneWorkHours/"+this.view().name+"/"+this.date()+"/"+$("#clinics").val()}).success(function(b){a.schedulerNoneWorkHours=b;for(var c=d.view().element,e=c.find("td[role=gridcell]"),f=0;f<e.length;f++){var g=$(e[f]);g.hasClass("k-nonwork-hour")||g.addClass("k-nonwork-hour"),g.hasClass("k-today")&&g.removeClass("k-today")}for(var f=0;f<e.length;f++){var g=$(e[f]);if(null!=d){var h=d.slotByElement(g),i=(h.startDate.getHours(),h.endDate.getHours(),a.schedulerOptions_resourceDS.data().length),j=0;if("week"==d.view().name){for(var k=0;i>k;k++)if(g.context.cellIndex-7*k<=0){j=k;break}}else j=g.context.cellIndex;for(var l=a.schedulerOptions_resourceDS.data()[j].value,m=0;m<a.schedulerNoneWorkHours.length;m++){var n=a.schedulerNoneWorkHours[m],o=new Date(n.startTime),p=new Date(n.endTime);if(l==n.itemId&&h.endDate.getYear()==o.getYear()&&h.endDate.getMonth()==o.getMonth()&&h.endDate.getDate()==o.getDate()){if(n.isHoliday){g.hasClass("k-nonwork-hour")||g.addClass("k-nonwork-hour");break}if(h.startDate.getTime()>=o.getTime()&&h.endDate.getTime()<=p.getTime()){if(h.startDate.getMinutes()%n.sectionTime===0){g.hasClass("k-nonwork-hour")&&g.removeClass("k-nonwork-hour");var q=new Object;q.startTime=h.startDate,q.endTime=h.endDate,q.itemId=n.itemId,q.clinicId=n.clinicId,r.push(q)}break}}}}}a.resetBackground=!1,kendo.ui.progress($("#scheduler"),!1)}).error(function(a){console.log(a)})}c.sender._data.forEach(function(b){b.bookId===a.selectedPatientForEdit?$('div.k-event[data-uid="'+b.uid+'"]').css("background",a.currentBookingColor).css("border-color",a.currentBookingColor):b.bookId===a.highlightViewId?$('div.k-event[data-uid="'+b.uid+'"]').css("background",a.allBookingColor).css("border-color",a.allBookingColor):$('div.k-event[data-uid="'+b.uid+'"]').css("background",a.bookingCellColor).css("border-color",a.bookingCellColor)})}}}),a.allChecked=!0,a.filterAllScheduler=function(){a.allChecked=!0,$.map($("#allCheckbox :checked"),function(a){a.checked=!0}),$.map($("#itemsForFilter :checked"),function(a){a.checked=!1}),a.filterScheduler()},a.filterScheduler=function(){var b=[],c=$.map($("#itemsForFilter :checked"),function(a){return parseInt($(a).val())});if(a.startFilterResourcesForCurrentEdit){if(c.length>0)for(var d=0;d<a.AllItemsForCurrentEdit.length;d++){for(var e=!1,f=0;f<c.length;f++)if(c[f]===a.AllItemsForCurrentEdit[d]){e=!0;break}e||(b.push(a.AllItemsForCurrentEdit[d]),console.log("highlightItems push"),console.log(b),a.startFilterResourcesForHighlight||(console.log("query all checkbox"),$.map($("#itemFilters :checkbox"),function(b){parseInt($(b).val())===a.AllItemsForCurrentEdit[d]&&(b.checked=!0)})))}c=$.map($("#itemsForFilter :checked"),function(a){return parseInt($(a).val())}),a.startFilterResourcesForCurrentEdit=!1}if(c.length>0&&($.map($("#allCheckbox :checked"),function(a){a.checked=!1}),a.allChecked=!1,a.startFilterResourcesForHighlight)){console.log("highlightItems"),console.log(b);for(var f=0;f<b.length;f++)c.push(b[f]);a.startFilterResourcesForHighlight=!1}var g={logic:"or",filters:$.map(c,function(a){
return{operator:"eq",field:"value",value:a}})},h=a.bookScheduler;h.resources[0].dataSource.filter(g),a.resetBackground=!0,h.view(h.view().name)},a.filterSchedulerByArray=function(b){console.log(b),b.length>0;var c={logic:"or",filters:$.map(b,function(a){return{operator:"eq",field:"value",value:a}})},d=a.bookScheduler;d.resources[0].dataSource.filter(c),a.resetBackground=!0,d.view(d.view().name)},a.dataSource=new kendo.data.DataSource({batch:!0,transport:{read:{url:a.serviceRoot+"/booking/read/patientbook",dataType:"json",type:"POST",contentType:"application/json"},update:{url:a.serviceRoot+"/booking/update/patientbook",dataType:"json",type:"POST",contentType:"application/json"},destroy:{url:a.serviceRoot+"/booking/destroy/patientbook",dataType:"json",type:"POST",contentType:"application/json"},parameterMap:function(b,c){if("read"!==c&&b.models)return JSON.stringify(b.models);if("read"===c){var d={start:moment(a.readDate).format("YYYY-MM-DDTHH:mm:ss.sss")+"Z",view:null==a.readView?"day":a.readView,clinicId:null==$("#clinics").val()?a.firstClinic:$("#clinics").val()},e=[d];return JSON.stringify(e)}}},schema:{model:{id:"bookId",fields:{bookId:{from:"bookId",type:"number"},patientName:{from:"patientName",validation:{required:!0}},bookDate:{type:"date",from:"bookDate"},patientTel:{from:"patientTel"},clinicId:{from:"clinicId",type:"number",validation:{required:!0}},patientHkid:{from:"patientHkid"},patientSex:{from:"patientSex"},dateOfBirth:{type:"date",from:"dateOfBirth",validation:{required:!0}},clientIp:{from:"clientIp"},lastUpdateUser:{from:"lastUpdateUser"},specialRequest:{from:"specialRequest"},vip:{from:"vip"},firstName:{from:"firstName"},lastName:{from:"lastName"},middleName:{from:"middleName"},patientAlert:{from:"patientAlert"},referingDoctor:{from:"referingDoctor"},referingDrPhone:{from:"referingDrPhone"},englishName:{from:"englishName"}}}}}),a.dataSource.bind("error",e);a.mainGridOptions={dataSource:a.dataSource,sortable:!0,selectable:!0,filterable:!0,editable:{mode:"inline"},columnMenu:!0,groupable:!1,reorderable:!0,resizable:!0,detailInit:f,edit:function(a){!a.model.isNew()},remove:function(a){},save:function(c){if(c.preventDefault(),null!=a.currentEditUser){var d=[c.model];b({method:"POST",url:a.serviceRoot+"/booking/update",data:JSON.stringify(d)}).then(function(b){a.bookGrid.dataSource.read(),a.bookScheduler.dataSource.read(),0==b.data.length&&g({title:a.ExceptionDialog,message:a.OperationFailure,buttons:[{label:a.confirmLabel,cancel:!0,primary:!1}]})},function(b){g({title:a.ExceptionDialog,message:a.OperationFailure,buttons:[{label:a.confirmLabel,cancel:!0,primary:!1}]})})}else console.error("password is requied!")},change:function(a){},dataBound:function(a){},columns:[{command:[{template:"<button class='k-button' style='min-width:16px;' ng-click='editClick(this)'><span class='k-icon k-i-tick'></span></button>"},{template:"<button class='k-button' style='min-width:16px;' ng-click='highlightClick(this)'><span class='k-icon fa fa-eye'></span></button>"}],width:"80px"},{field:"englishName",title:a.EnglishName,template:'#=(bookStatus==="occupied")?("<font color=red>"+englishName+"</font>"):englishName #',width:150},{field:"patientName",title:a.PatientName,template:'#=(bookStatus==="occupied")?("<font color=red>"+patientName+"</font>"):patientName #',width:150},{field:"lastName",title:"",width:100},{field:"middleName",title:"",width:100},{field:"firstName",title:"",width:100},{field:"patientSex",title:a.PatientSex,width:70},{field:"patientTel",title:a.PatientTel,width:150},{field:"patientBookItem",title:a.PatientBookItem},{field:"specialRequest",title:"Special Request"},{field:"vip",title:"VIP",width:70},{field:"patientAlert",title:"Patient Alert"},{field:"referingDoctor",title:"Refering Doctor"},{field:"referingDrPhone",title:"Refering Dr. Phone"}]},a.editContent=a.editLabel,a.delContent=a.deleteLabel,a.moveContent=a.moveLabel,a.copyContent=a.copyLabel,a.closeWinContent=a.copyLabel,a.kposition="top",a.highlightClick=function(c){if(a.highlightViewId=c.dataItem.bookId,null===a.currentEditUser){var d={start:moment(a.readDate).format("YYYY-MM-DDTHH:mm:ss.sss")+"Z",view:null==a.readView?"day":a.readView,clinicId:null==$("#clinics").val()?a.firstClinic:$("#clinics").val(),bookId:c.dataItem.bookId},e=[d];b({method:"POST",url:a.serviceRoot+"/booking/read/grid",data:JSON.stringify(e)}).then(function(b){if(b.data.length>0&&(a.startFilterResourcesForCurrentEdit=!0,a.startFilterResourcesForHighlight=!0,a.startFilterResourcesForCurrentEdit)){a.AllItemsForCurrentEdit=[];for(var c=0;c<b.data.length;c++)a.AllItemsForCurrentEdit[c]=b.data[c].itemId;console.log("highlight"),console.log(a.AllItemsForCurrentEdit),a.filterScheduler(),a.bookScheduler.dataSource.read()}})}else a.bookScheduler.dataSource.read()},a.editClick=function(b){var c=g({title:a.passwordDialog,message:"",input:!0,inputtype:"password",label:a.enterPasswordTip,value:"",buttons:[{label:a.cancelLabel,cancel:!0,primary:!1},{label:a.confirmLabel,cancel:!1,primary:!1}]});c.then(function(c){var d=h.query(a.serviceRoot,c);d.then(function(d){if(d){a.currentGridVisible=!0,a.currentEditUser=d,a.md5Password=c;var d=b.dataItem;a.selectedPatientForEdit=d.bookId,a.serviceItemDS.read(),a.currentBookGridOptions.dataSource.read(),a.currentDetailGridOptions.dataSource.read(),a.startFilterResourcesForCurrentEdit=!0}else{g({title:a.passwordDialog,message:a.invalidPassword,buttons:[{label:a.confirmLabel,cancel:!0,primary:!1}]})}})})},a.editBook3=function(){if(!a.disableGridToolbar){a.gridEditTip.hide();var b=a.bookGrid.select();0==b.length?g({title:a.ExceptionDialog,message:a.NoRecordSelected,buttons:[{label:a.confirmLabel,cancel:!0,primary:!1}]}):a.bookGrid.editRow(b)}},a.delBook3=function(){if(!a.disableGridToolbar){a.gridDelTip.hide();var c=a.bookGrid.select();if(0==c.length)g({title:a.ExceptionDialog,message:a.NoRecordSelected,buttons:[{label:a.confirmLabel,cancel:!0,primary:!1}]});else{var d=(a.bookGrid.dataItem(c),g({title:a.passwordDialog,message:a.DeleteWarning,input:!0,inputtype:"password",label:a.enterPasswordTip,value:"",buttons:[{label:a.cancelLabel,cancel:!0,primary:!1},{label:a.confirmLabel,cancel:!1,primary:!1}]}));d.then(function(d){var e=h.query(a.serviceRoot,d);e.then(function(d){if(d){var e=[a.bookGrid.dataItem(c)];b({method:"POST",url:a.serviceRoot+"/booking/destroy",data:JSON.stringify(e)}).then(function(b){a.bookScheduler.dataSource.read(),a.bookGrid.dataSource.read()},function(a){console.log(" save..failure")})}else{var f=g({title:a.passwordDialog,message:a.invalidPassword,buttons:[{label:a.confirmLabel,cancel:!0,primary:!1},{label:a.retry,cancel:!1,primary:!1}]});f.then(function(){a.delBook()})}})})}}},a.moveBook3=function(){if(!a.disableGridToolbar){var b=a.bookGrid.select();if(0==b.length)g({title:a.ExceptionDialog,message:a.NoRecordSelected,buttons:[{label:a.confirmLabel,cancel:!0,primary:!1}]});else{var c=g({title:a.passwordDialog,message:a.MoveWaning,input:!0,inputtype:"password",label:a.enterPasswordTip,value:"",buttons:[{label:a.cancelLabel,cancel:!0,primary:!1},{label:a.confirmLabel,cancel:!1,primary:!1}]});c.then(function(c){var d=h.query(a.serviceRoot,c);d.then(function(d){if(d)a.selectedData=a.bookGrid.dataItem(b),a.selectedData.md5Password=c,a.disableToolbar("move");else{var e=g({title:a.passwordDialog,message:a.invalidPassword,buttons:[{label:a.confirmLabel,cancel:!0,primary:!1},{label:a.retry,cancel:!1,primary:!1}]});e.then(function(){a.moveBook()})}})})}}},a.copyBook3=function(){if(!a.disableGridToolbar){var b=a.bookGrid.select();if(0==b.length)g({title:a.ExceptionDialog,message:a.NoRecordSelected,buttons:[{label:a.confirmLabel,cancel:!0,primary:!1}]});else{var c=g({title:a.passwordDialog,message:a.CopyWarning,input:!0,inputtype:"password",label:a.enterPasswordTip,value:"",buttons:[{label:a.cancelLabel,cancel:!0,primary:!1},{label:a.confirmLabel,cancel:!1,primary:!1}]});c.then(function(c){var d=h.query(a.serviceRoot,c);d.then(function(d){if(d)a.selectedData=a.bookGrid.dataItem(b),a.selectedData.md5Password=c,a.disableToolbar("copy");else{var e=g({title:a.passwordDialog,message:a.invalidPassword,buttons:[{label:a.confirmLabel,cancel:!0,primary:!1},{label:a.retry,cancel:!1,primary:!1}]});e.then(function(){a.copyBook()})}})})}}},a.itemDataSource=new kendo.data.DataSource({transport:{read:{url:a.serviceRoot+"/bookitem/listRemark",dataType:"json",type:"POST",contentType:"application/json"},parameterMap:function(b,c){if("read"!==c&&b.models)return JSON.stringify(b.models);if("read"===c){var d={clinicId:null==$("#clinics").val()?a.firstClinic:$("#clinics").val()},e=[d];return JSON.stringify(e)}}}}),a.itemGridOptions={dataSource:a.itemDataSource,sortable:!0,pageable:!1,height:200,columns:[{field:"itemDesc",title:a.PatientBookItem,width:"100px"},{field:"usRemark",title:a.Remark}]},a.currentGridVisible=!1,a.selectedPatientForEdit=0,a.currentBookGridOptions={},a.dataSource2=new kendo.data.DataSource({batch:!0,transport:{read:{url:a.serviceRoot+"/booking/read/patientbook/single",dataType:"json",type:"POST",contentType:"application/json"},update:{url:a.serviceRoot+"/booking/update/patientbook",dataType:"json",type:"POST",contentType:"application/json"},destroy:{url:a.serviceRoot+"/booking/destroy/patientbook",dataType:"json",type:"POST",contentType:"application/json"},parameterMap:function(b,c){if("read"!==c&&b.models)return JSON.stringify(b.models);if("read"===c){var d={start:moment(a.readDate).format("YYYY-MM-DDTHH:mm:ss.sss")+"Z",view:null==a.readView?"day":a.readView,clinicId:null==$("#clinics").val()?a.firstClinic:$("#clinics").val(),bookId:a.selectedPatientForEdit},e=[d];return JSON.stringify(e)}}},schema:{model:{id:"bookId",fields:{bookId:{from:"bookId",type:"number"},patientName:{from:"patientName",validation:{required:!0}},bookDate:{type:"date",from:"bookDate"},patientTel:{from:"patientTel"},clinicId:{from:"clinicId",type:"number",validation:{required:!0}},patientHkid:{from:"patientHkid"},patientSex:{from:"patientSex"},dateOfBirth:{type:"date",from:"dateOfBirth",validation:{required:!0}},clientIp:{from:"clientIp"},lastUpdateUser:{from:"lastUpdateUser"},specialRequest:{from:"specialRequest"},vip:{from:"vip"},firstName:{from:"firstName"},lastName:{from:"lastName"},middleName:{from:"middleName"},patientAlert:{from:"patientAlert"},referingDoctor:{from:"referingDoctor"},referingDrPhone:{from:"referingDrPhone"},englishName:{from:"englishName"},patientInfo:{from:"patientInfo"}}}}}),a.dataSource2.bind("error",e),$("#currentBookGridID").kendoTooltip({filter:"span.k-icon",content:function(a){var b,c=$("#currentBookGridID").data("kendoGrid");return $.each(c.columns[0].command,function(c,d){return a.target.hasClass(d.imageClass)?(b=d.title,!1):void 0}),b},position:"top"}).data("kendoTooltip"),$("#currentDetailGridID").kendoTooltip({filter:"span.k-icon",content:function(a){var b,c=$("#currentDetailGridID").data("kendoGrid");return $.each(c.columns[0].command,function(c,d){return a.target.hasClass(d.imageClass)?(b=d.title,!1):void 0}),b},position:"top"}).data("kendoTooltip"),$("#currentDetailGridID").kendoTooltip({filter:"span.fa",content:function(a){var b,c=$("#currentDetailGridID").data("kendoGrid");return $.each(c.columns[0].command,function(c,d){return a.target.hasClass(d.imageClass)?(b=d.title,!1):void 0}),b},position:"top"}).data("kendoTooltip");a.currentBookGridOptions={dataSource:a.dataSource2,sortable:!0,selectable:"row",filterable:!0,editable:{mode:"popup",template:kendo.template($("#patientEditorTemplate").html())},columnMenu:!0,groupable:!1,reorderable:!0,resizable:!0,toolbar:$("#gridToolbarTemplate").html(),edit:function(a){a.model.isNew()||(console.log("grid eidt....."),console.log(a.model))},remove:function(a){},save:function(c){if(console.log("saved"),console.log(c.model),c.preventDefault(),c.model.md5Password=a.md5Password,c.model.lastUpdateUser=a.currentEditUser,""!==c.model.md5Password&&null!==c.model.md5Password){var d=[c.model];b({method:"POST",url:a.serviceRoot+"/booking/update/patientbook",data:JSON.stringify(d)}).then(function(b){a.bookGrid.dataSource.read(),a.bookScheduler.dataSource.read(),a.currentBookGrid.dataSource.read(),a.currentDetailGrid.dataSource.read(),0==b.data.length&&g({title:a.ExceptionDialog,message:a.OperationFailure,buttons:[{label:a.confirmLabel,cancel:!0,primary:!1}]})},function(b){g({title:a.ExceptionDialog,message:a.OperationFailure,buttons:[{label:a.confirmLabel,cancel:!0,primary:!1}]})})}else console.error("password is requied!")},change:function(a){},dataBound:function(a){},columns:[{command:[{name:"Edit",text:"",imageClass:"k-icon k-edit",title:a.Edit,click:i},{name:"Delete",text:"",imageClass:"k-icon k-delete",title:a.Delete,click:k}],width:"80px"},{field:"patientInfo",title:a.PatientName,template:'#=(bookStatus==="occupied")?("<font color=red>"+patientInfo+"</font>"):patientInfo #'}]},a.refreshBook=function(){a.currentBookGridOptions.dataSource.read()},a.closeBook=function(){a.selectedPatientForEdit=0,a.highlightViewId=0,a.currentEditUser=null,a.md5Password=null;var b=a.currentBookGrid;b.dataSource.data([]);var c=a.currentDetailGrid;c.dataSource.data([]),a.bookScheduler.dataSource.read(),a.mainGridOptions.dataSource.read(),a.currentGridVisible=!1},a.selectBook=function(){var a=$("#currentBookGridID").data("kendoGrid");a.select("tr:eq(1)")},a.moveBook=function(){if(!a.disableGridToolbar){var b=a.bookGrid.select();if(0==b.length)g({title:a.ExceptionDialog,message:a.NoRecordSelected,buttons:[{label:a.confirmLabel,cancel:!0,primary:!1}]});else{var c=g({title:a.passwordDialog,message:a.MoveWaning,input:!0,inputtype:"password",label:a.enterPasswordTip,value:"",buttons:[{label:a.cancelLabel,cancel:!0,primary:!1},{label:a.confirmLabel,cancel:!1,primary:!1}]});c.then(function(c){var d=h.query(a.serviceRoot,c);d.then(function(d){if(d)a.selectedData=a.bookGrid.dataItem(b),a.selectedData.md5Password=c,a.disableToolbar("move");else{var e=g({title:a.passwordDialog,message:a.invalidPassword,buttons:[{label:a.confirmLabel,cancel:!0,primary:!1},{label:a.retry,cancel:!1,primary:!1}]});e.then(function(){a.moveBook()})}})})}}},a.copyBook=function(){if(!a.disableGridToolbar){var b=a.bookGrid.select();if(0==b.length)g({title:a.ExceptionDialog,message:a.NoRecordSelected,buttons:[{label:a.confirmLabel,cancel:!0,primary:!1}]});else{var c=g({title:a.passwordDialog,message:a.CopyWarning,input:!0,inputtype:"password",label:a.enterPasswordTip,value:"",buttons:[{label:a.cancelLabel,cancel:!0,primary:!1},{label:a.confirmLabel,cancel:!1,primary:!1}]});c.then(function(c){var d=h.query(a.serviceRoot,c);d.then(function(d){if(d)a.selectedData=a.bookGrid.dataItem(b),a.selectedData.md5Password=c,a.disableToolbar("copy");else{var e=g({title:a.passwordDialog,message:a.invalidPassword,buttons:[{label:a.confirmLabel,cancel:!0,primary:!1},{label:a.retry,cancel:!1,primary:!1}]});e.then(function(){a.copyBook()})}})})}}},a.serviceItemDS=new kendo.data.DataSource({transport:{read:{url:a.serviceRoot+"/booking/findServicItems",dataType:"json",type:"POST",contentType:"application/json"},parameterMap:function(a,b){if("read"===b){var c="";return JSON.stringify(c)}}}}),a.dataSource3=new kendo.data.DataSource({batch:!0,transport:{read:{url:a.serviceRoot+"/booking/read/grid",dataType:"json",type:"POST",contentType:"application/json"},update:{url:a.serviceRoot+"/booking/update",dataType:"json",type:"POST",contentType:"application/json"},destroy:{url:a.serviceRoot+"/booking/destroy",dataType:"json",type:"POST",contentType:"application/json"},parameterMap:function(b,c){if("read"!==c&&b.models)return JSON.stringify(b.models);if("read"===c){var d={start:moment(a.readDate).format("YYYY-MM-DDTHH:mm:ss.sss")+"Z",view:null==a.readView?"day":a.readView,clinicId:null==$("#clinics").val()?a.firstClinic:$("#clinics").val(),bookId:a.selectedPatientForEdit},e=[d];return JSON.stringify(e)}}},change:function(b){this.data();if("sync"===b.action)a.bookItemForDetailEditObject=null,a.bookGrid.dataSource.read(),a.bookScheduler.dataSource.read();else if(a.startFilterResourcesForCurrentEdit){a.AllItemsForCurrentEdit=[];for(var c=0;c<b.items.length;c++)a.AllItemsForCurrentEdit[c]=b.items[c].itemId;a.filterScheduler(),a.bookScheduler.dataSource.read()}},schema:{model:{id:"taskId",fields:{taskId:{from:"taskId",type:"number"},bookId:{from:"bookId",type:"number"},title:{from:"title",defaultValue:"No title",validation:{required:!0}},start:{type:"date",from:"start",validation:{required:!0,startvalidation:function(b){if(b.is("[name='start']")&&""!=b.val()){b.val();console.log(b.val());var c;if(null!=a.bookItemForDetailEditObject)c=a.bookItemForDetailEditObject;else{var d=b.closest("tr"),e=a.currentDetailGrid;c=e.dataItem(d)}return b.attr("data-startvalidation-msg","Invalid start time!"),a.checkStartValid(b.val(),c.itemId,c.clinicId)}return!0}}},end:{type:"date",from:"end"},description:{from:"description"},itemId:{from:"itemId",type:"number",validation:{required:!0}},clinicId:{from:"clinicId",type:"number",validation:{required:!0}},isAllDay:{type:"boolean",from:"isAllDay"},bookStatus:{from:"bookStatus"},clientIp:{from:"clientIp"},md5Password:{from:"md5Password"},itemCatCode:{from:"itemCatCode"},lastUpdateUser:{from:"lastUpdateUser"},serviceItem1:{from:"serviceItem1"},serviceItem2:{from:"serviceItem2"},serviceItem3:{from:"serviceItem3"},serviceItem4:{from:"serviceItem4"},serviceItem5:{from:"serviceItem5"},serviceItemDesc1:{from:"serviceItemDesc1"},serviceItemDesc2:{from:"serviceItemDesc2"},serviceItemDesc3:{from:"serviceItemDesc3"},serviceItemDesc4:{from:"serviceItemDesc4"},serviceItemDesc5:{from:"serviceItemDesc5"},serviceItems:{from:"serviceItems"},serviceRemark:{from:"serviceRemark"},bookDuration:{type:"number",from:"bookDuration"},itemDesc:{from:"itemDesc"},clinicDesc:{from:"clinicDesc"}}}}}),a.dataSource3.bind("error",e),a.durationEditor=function(a,b){$('<input data-bind="value:'+b.field+'"/>').appendTo(a).kendoNumericTextBox({min:5,step:5,format:"n0"})},a.dateTimeEditor=function(a,b){$('<input data-text-field="'+b.field+'" data-value-field="'+b.field+'" data-bind="value:'+b.field+'" data-format="'+b.format+'"/>').appendTo(a).kendoDateTimePicker({}),$('<span class="k-invalid-msg" data-for="start"></span>').appendTo(a)},a.serviceItem1Editor=function(b,c){$("<input data-bind='value:"+c.field+"'+ />").attr("id","ddl_serviceItem1").appendTo(b).kendoDropDownList({dataSource:{transport:{read:{dataType:"json",url:a.serviceRoot+"/booking/findItemCat"}}},dataTextField:"itemCat",dataValueField:"itemCat",template:"<span data-id='${data.itemCat}'>${data.itemCat}</span>"})},a.serviceItem2Editor=function(b,c){$("<input data-bind='value:"+c.field+"'+ />").attr("id","ddl_serviceItem2").appendTo(b).kendoDropDownList({dataSource:a.serviceItemDS,dataTextField:"itemDesc",dataValueField:"itemCode",template:"<span data-id='${data.itemCode}'>${data.itemDesc}</span>"})},a.serviceRemarkEditor=function(a,b){$('<textarea name="'+b.field+'" style="width: '+a.width()+'px;height:72px" />').appendTo(a)},a.checkStartValid=function(b,c,d){var e=new XMLHttpRequest;return e.open("POST",a.serviceRoot+"/booking/validateStartTime",!1),e.setRequestHeader("Content-Type","application/json;charset=UTF-8"),e.send(JSON.stringify({starttime:b,itemId:c,clinicId:d})),200===e.status?(console.log(e.response),"true"===e.response?!0:!1):!1},a.currentDetailGridOptions={dataSource:a.dataSource3,save:function(c){if(null!=a.currentEditUser&&null!=a.bookItemForDetailEditObject){c.model=a.bookItemForDetailEditObject,c.model.set("md5Password",a.md5Password),c.model.set("lastUpdateUser",a.currentEditUser),""!==c.model.serviceItem1&&"object"==typeof c.model.serviceItem1&&(c.model.serviceItem1=c.model.serviceItem1.itemCode),""!==c.model.serviceItem2&&"object"==typeof c.model.serviceItem2&&(c.model.serviceItem2=c.model.serviceItem2.itemCode),""!==c.model.serviceItem3&&"object"==typeof c.model.serviceItem3&&(c.model.serviceItem3=c.model.serviceItem3.itemCode),""!==c.model.serviceItem4&&"object"==typeof c.model.serviceItem4&&(c.model.serviceItem4=c.model.serviceItem4.itemCode),""!==c.model.serviceItem5&&"object"==typeof c.model.serviceItem5&&(c.model.serviceItem5=c.model.serviceItem5.itemCode);var d=[c.model];b({method:"POST",url:a.serviceRoot+"/booking/update",data:JSON.stringify(d)}).then(function(a){0==a.data.length},function(b){null!=a.bookItemForDetailEditObject,g({title:a.ExceptionDialog,message:a.OperationFailure,buttons:[{label:a.confirmLabel,cancel:!0,primary:!1}]})})}else c.model.set("md5Password",a.md5Password),c.model.set("lastUpdateUser",a.currentEditUser),""!==c.model.serviceItem1&&"object"==typeof c.model.serviceItem1&&(c.model.serviceItem1=c.model.serviceItem1.itemCode),""!==c.model.serviceItem2&&"object"==typeof c.model.serviceItem2&&(c.model.serviceItem2=c.model.serviceItem2.itemCode),""!==c.model.serviceItem3&&"object"==typeof c.model.serviceItem3&&(c.model.serviceItem3=c.model.serviceItem3.itemCode),""!==c.model.serviceItem4&&"object"==typeof c.model.serviceItem4&&(c.model.serviceItem4=c.model.serviceItem4.itemCode),""!==c.model.serviceItem5&&"object"==typeof c.model.serviceItem5&&(c.model.serviceItem5=c.model.serviceItem5.itemCode)},edit:function(b){if(!b.model.isNew()){$('[name="itemDesc"]').attr("readonly",!0);var c=this.editable.validatable;b.container.find("[name=start]").blur(function(){c.validateInput($(this))}),console.log("cat:"+b.model.itemCatCode);var d=b.model.itemCatCode.split(","),e={logic:"or",filters:$.map(d,function(a){return{operator:"eq",field:"itemCat",value:a}})};a.serviceItemDS.filter(e)}},scrollable:!0,sortable:!0,pageable:!1,resizable:!0,editable:"inline",columns:[{command:[{name:"edit",text:"",imageClass:"k-icon k-edit",title:a.Edit},{name:"popup",text:"",imageClass:"k-icon k-i-folder-up",click:l,title:a.PopupEdit},{name:"destroy",text:"",imageClass:"k-icon k-delete",title:a.Delete},{name:"Copy",text:"",imageClass:"fa fa-files-o",title:a.copyLabel,click:q},{name:"Move",text:"",imageClass:"fa fa-exchange",title:a.moveLabel,click:s}],width:"180px"},{field:"itemDesc",title:a.BookGridItem,width:100},{field:"start",title:a.BookGridStart,format:"{0:"+a.appParameters.appDateTimeFormat+"}",template:'#: kendo.format("{0:yyyy-MM-dd}", start)#&nbsp;<font color=red><b>#: kendo.format("{0:HH:mm}", start)#</b></font>',width:180},{field:"bookDuration",title:a.Duration,editor:a.durationEditor,width:90},{field:"serviceItem1",title:a.ServiceItem1,editor:a.serviceItem2Editor,template:"{{getServiceItemDesc(dataItem.serviceItem1)}}",width:120},{field:"serviceItem2",title:a.ServiceItem2,editor:a.serviceItem2Editor,template:"{{getServiceItemDesc(dataItem.serviceItem2)}}",width:120},{field:"serviceRemark",title:a.Remark,editor:a.serviceRemarkEditor}]},a.getServiceItemDesc=function(b){for(var c=a.serviceItemDS.data(),d=0,e=c.length;e>d;d++)if(c[d].itemCode===b)return c[d].itemDesc}}),a.changeClinic=function(){b({method:"POST",url:a.serviceRoot+"/booking/schedulerParas/"+$("#clinics").val()}).success(function(b){if(console.log("scheduler:",a.bookScheduler),a.bookScheduler.options.startTime=new Date(b.startTime),a.bookScheduler.options.endTime=new Date(b.endTime),a.bookScheduler.options.majorTick=new Date(b.majorTick),b.resourceDs.length>0){var d,e,f=a.schedulerOptions_resourceDS.data(),g=f.length;for(e=g-1;e>=0;e--)d=f[e],a.schedulerOptions_resourceDS.remove(d);for(var e=0;e<b.resourceDs.length;e++)a.schedulerOptions_resourceDS.add(b.resourceDs[e])}var d,e,f=a.schedulerOptions_resourceDS.data(),g=f.length,h=[];for(e=0;g>e;e++)h[e]=f[e].value;a.filterSchedulerByArray(h),a.readDate=new Date(b.date),a.schedulerOptions_height=c.windowHeight-30-10,a.readView="day",a.editable=!0,a.schedulerDateInterval=a.schedulerOptions_majorTick/a.schedulerOptions_minorTickCount,a.bookGrid.dataSource.read(),a.closeBook()})},a.disableToolbar=function(b){$(".k-grid-toolbar").children(".k-button").addClass("k-state-disabled"),$("#currentBookGridID a .k-button .k-button-icontext .k-grid-Edit").removeClass("k-button-icontext k-grid-Edit").addClass("k-state-disabled"),a.disableGridToolbar=!0,"move"===b?(a.cancelMoveVisible=!0,a.cancelCopyVisible=!1):"copy"===b&&(a.cancelMoveVisible=!1,a.cancelCopyVisible=!0,console.log("copy mode...."))},a.enableToolbar=function(){$(".k-grid-toolbar").children(".k-button").removeClass("k-state-disabled"),a.cancelMoveVisible=!1,a.cancelCopyVisible=!1,a.disableGridToolbar=!1,a.disableDIV=!1},a.cancelSave=function(){a.win1.close()},a.showInfo=function(b,c){a.schedulerNotif.show(b,c)},a.cancelMove=function(){a.enableToolbar(),a.disableDIV=!1},a.cancelCopy=function(){$(".k-grid-toolbar").children(".k-button").removeClass("k-state-disabled"),a.cancelCopyVisible=!1,a.disableGridToolbar=!1,a.disableDIV=!1}}]).factory("checkUserService",["$http","$q",function(a,b,c){return{query:function(c,d){var e=b.defer(),f=JSON.stringify({password:d});return a({method:"POST",url:c+"/booking/validateUser/",data:f}).success(function(a){e.resolve(a)}).error(function(a){e.reject(a)}),e.promise}}}]),angular.module("angulardemoApp").config(["$stateProvider",function(a){a.state("bookscheduler",{views:{booktab:{url:"/bookscheduler",templateUrl:"/BookingSystem/app/bookscheduler/bookscheduler.html",controller:"BookschedulerCtrl"}},sticky:!0})}]),angular.module("angulardemoApp").controller("ClinicpageCtrl",["$rootScope","$scope","$timeout","$window","$http","$translate","$state","prompt2","parseException",function(a,b,c,d,e,f,g,h,i){var j=angular.element(d);c(function(){j.triggerHandler("resize"),f(["ClinicCode","ClinicName","ClinicAddress","ClinicTel","ItemDesc","Overlap","SectionTime","DisplaySequence","UsRemark","HkRemark","CnRemark","SelectClinic","AllFieldsRequired","StartTime","EndTime","Holiday","EffectiveDateTo","EffectiveDateFrom","Reason","SchedulerTick"]).then(function(c){function d(c){b.selectedMasterId=c.data.id,$("<div/>").appendTo(c.detailCell).kendoGrid({dataSource:{batch:!0,transport:{read:{url:b.serviceRoot+"/specialdatedetail/list",dataType:"json",type:"POST",contentType:"application/json"},create:{url:b.serviceRoot+"/specialdatedetail/create",dataType:"json",type:"POST",contentType:"application/json"},update:{url:b.serviceRoot+"/specialdatedetail/update",dataType:"json",type:"POST",contentType:"application/json"},destroy:{url:b.serviceRoot+"/specialdatedetail/destroy",dataType:"json",type:"POST",contentType:"application/json"},parameterMap:function(a,b){if("read"!==b&&a.models)return console.log("edit..",a.models[0]),JSON.stringify(a.models[0]);if("read"===b){var d={masterId:c.data.id};return JSON.stringify(d)}}},schema:{model:{id:"id",fields:{masterId:{from:"masterId",type:"number"},id:{from:"id",type:"number"},startTime:{from:"startTime",validation:{required:!0}},endTime:{from:"endTime",validation:{required:!0}}}}}},scrollable:!0,sortable:!0,pageable:!1,toolbar:["create"],editable:{model:"inline"},save:function(c){if(""===c.model.startTime||""===c.model.endTime){c.preventDefault();h({title:a.ExceptionDialog,message:"Start or End is required!",buttons:[{label:b.confirmLabel,cancel:!0,primary:!1}]})}"object"==typeof c.model.startTime&&c.model.set("startTime",moment(c.model.startTime).format("HH:mm")),"object"==typeof c.model.endTime&&c.model.set("endTime",moment(c.model.endTime).format("HH:mm"))},edit:function(a){a.model.isNew()&&a.model.set("masterId",b.selectedMasterId)},columns:[{field:"startTime",title:b.StartTime,width:"100px",format:"{0:HH:mm}",editor:b.startTimeEditor},{field:"endTime",title:b.EndTime,width:"100px",format:"{0:HH:mm}",editor:b.startTimeEditor},{command:["edit","destroy"]}]})}b.ClinicCode=c.ClinicCode,b.ClinicName=c.ClinicName,b.ClinicAddress=c.ClinicAddress,b.ClinicTel=c.ClinicTel,b.ItemDesc=c.ItemDesc,b.Overlap=c.Overlap,b.SectionTime=c.SectionTime,b.DisplaySequence=c.DisplaySequence,b.UsRemark=c.UsRemark,b.HkRemark=c.HkRemark,b.CnRemark=c.CnRemark,b.SelectClinic=c.SelectClinic,b.AllFieldsRequired=c.AllFieldsRequired,b.StartTime=c.StartTime,b.EndTime=c.EndTime,b.Holiday=c.Holiday,b.EffectiveDateFrom=c.EffectiveDateFrom,b.EffectiveDateTo=c.EffectiveDateTo,b.Reason=c.Reason,b.SchedulerTick=c.SchedulerTick,b.dataSource_error=function(b){console.log(b),i.alertmsg(b,a.errorMessages)},b.dataSource=new kendo.data.DataSource({batch:!0,transport:{read:{url:a.serviceRoot+"/clinic/list",dataType:"json",type:"POST",contentType:"application/json"},update:{url:a.serviceRoot+"/clinic/update",dataType:"json",type:"POST",contentType:"application/json"},create:{url:a.serviceRoot+"/clinic/create",dataType:"json",type:"POST",contentType:"application/json"},destroy:{url:a.serviceRoot+"/clinic/destroy",dataType:"json",type:"POST",contentType:"application/json"},parameterMap:function(a,b){return"read"!==b&&a.models?JSON.stringify(a.models[0]):void 0}},pageSize:20,schema:{model:{id:"id",fields:{id:{from:"id",type:"number"},clinicCode:{from:"clinicCode",validation:{required:!0}},clinicName:{from:"clinicName",validation:{required:!0}},clinicAddress:{from:"clinicAddress",validation:{required:!0}},clinicTel:{from:"clinicTel",validation:{required:!0}}}}}}),b.dataSource.bind("error",b.dataSource_error),b.clinicGridOptions={dataSource:b.dataSource,sortable:!0,selectable:"row",pageable:!1,filterable:!1,editable:{mode:"inline"},columnMenu:!1,groupable:!1,reorderable:!0,resizable:!0,toolbar:["create"],change:function(a){this.select();b.refreshSubData()},columns:[{field:"clinicCode",title:b.ClinicCode,width:"100px"},{field:"clinicName",title:b.ClinicName,width:"200px"},{field:"clinicAddress",title:b.ClinicAddress,width:"300px"},{field:"clinicTel",title:b.ClinicTel,width:"160px"},{command:[{name:"edit"},{template:"<button class='k-button' style='min-width:16px;' ng-click='deleteClinic(this)'><span class='k-icon k-delete'></span>"+a.Delete+"</button>"}],title:"&nbsp;"}]},b.deleteClinic=function(c){var d=h({title:a.WarningDialog,message:a.DeleteItem,buttons:[{label:b.Cancel,cancel:!0,primary:!1},{label:b.confirmLabel,cancel:!1,primary:!1}]});d.then(function(d){console.log(c.dataItem),e({method:"POST",url:a.serviceRoot+"/clinic/destroy",data:JSON.stringify(c.dataItem)}).then(function(a){b.dataSource.read()},function(a){console.log(a)})})},b.itemsDataSource=new kendo.data.DataSource({batch:!0,transport:{read:{url:a.serviceRoot+"/bookitem/list",dataType:"json",type:"POST",contentType:"application/json"},update:{url:a.serviceRoot+"/bookitem/update",dataType:"json",type:"POST",contentType:"application/json"},create:{url:a.serviceRoot+"/bookitem/create",dataType:"json",type:"POST",contentType:"application/json"},destroy:{url:a.serviceRoot+"/bookitem/destroy",dataType:"json",type:"POST",contentType:"application/json"},parameterMap:function(a,c){if("read"!==c&&a.models){var d=b.clinicGrid,e=d.dataItem(d.select());if(null!=e&&(a.models[0].clinicId=e.id),"object"==typeof a.models[0].clinicItemUI)a.models[0].itemId=a.models[0].clinicItemUI.id;else if("number"==typeof a.models[0].clinicItemUI||"string"==typeof a.models[0].clinicItemUI){console.log("test"),a.models[0].itemId=a.models[0].clinicItemUI;var f={};f.id=a.models[0].clinicItemUI,a.models[0].clinicItemUI=f}return JSON.stringify(a.models[0])}if("read"===c){var g={},d=b.clinicGrid,e=d.dataItem(d.select());null!=e?g.clinicId=e.id:g.clinicId="NULL";var h=[g];return JSON.stringify(h)}}},pageSize:20,schema:{model:{id:"id",fields:{id:{from:"id",type:"number"},clinicId:{from:"clinicId",type:"number",validation:{required:!0}},itemId:{from:"itemId",type:"number"},itemCode:{from:"itemCode"},itemDesc:{from:"itemDesc"},itemSequence:{from:"itemSequence",validation:{required:!0}},overlap:{from:"overlap",type:"boolean"},sectionTime:{from:"sectionTime",type:"number"},usRemark:{from:"usRemark"},hkRemark:{from:"hkRemark"},cnRemark:{from:"cnRemark"},color:{from:"color"},clinicItemUI:{from:"clinicItemUI"}}}}}),b.itemsDataSource.bind("error",b.dataSource_error),b.systemItemsDS=new kendo.data.DataSource({transport:{read:{url:a.serviceRoot+"/item/list",dataType:"json",type:"POST",contentType:"application/json"}}}),b.systemItemsDS.read(),b.clinicItemEditor=function(a,c){$("<input data-bind='value:"+c.field+"'+ />").appendTo(a).kendoDropDownList({
dataSource:b.systemItemsDS,dataTextField:"itemDesc",dataValueField:"id"})},b.sectionTimeEditor=function(a,b){$('<input data-bind="value:'+b.field+'"/>').appendTo(a).kendoNumericTextBox({min:5,step:5,format:"n0"})},b.itemRemarkEditor=function(a,b){$('<textarea name="'+b.field+'" style="width: '+a.width()+'px;height:72px" />').appendTo(a)},b.itemsGridOptions={autoBind:!1,dataSource:b.itemsDataSource,sortable:!0,selectable:"row",pageable:!1,filterable:!1,editable:{mode:"inline"},columnMenu:!1,groupable:!1,reorderable:!0,resizable:!0,toolbar:["create"],edit:function(c){if(c.model.isNew()){var d=b.clinicGrid,e=d.dataItem(d.select());if(null==e){c.preventDefault();h({title:a.ExceptionDialog,message:b.SelectClinic,buttons:[{label:b.confirmLabel,cancel:!0,primary:!1}]})}}},columns:[{field:"clinicItemUI",title:b.ItemDesc,width:"150px",editor:b.clinicItemEditor,template:"{{getItemDesc(dataItem.itemId)}}"},{field:"overlap",title:b.Overlap,width:"100px"},{field:"sectionTime",title:b.SectionTime,editor:b.sectionTimeEditor,width:"200px"},{field:"itemSequence",title:b.DisplaySequence,width:"120px"},{field:"usRemark",title:b.UsRemark,editor:b.itemRemarkEditor,width:"220px"},{field:"hkRemark",title:b.HkRemark,editor:b.itemRemarkEditor,width:"220px"},{field:"cnRemark",title:b.CnRemark,editor:b.itemRemarkEditor,width:"220px"},{command:[{name:"edit"},{template:"<button class='k-button' style='min-width:16px;' ng-click='deleteClick(this)'><span class='k-icon k-delete'></span>"+a.Delete+"</button>"}],title:"&nbsp;"}]},b.getItemDesc=function(a){for(var c=b.systemItemsDS.data(),d=0,e=c.length;e>d;d++)if(c[d].id===a)return c[d].itemDesc;return"test"},b.deleteClick=function(c){var d=h({title:a.WarningDialog,message:a.DeleteItem,buttons:[{label:b.Cancel,cancel:!0,primary:!1},{label:b.confirmLabel,cancel:!1,primary:!1}]});d.then(function(d){console.log(c.dataItem),e({method:"POST",url:a.serviceRoot+"/bookitem/destroy",data:JSON.stringify(c.dataItem)}).then(function(a){b.itemsDataSource.read()},function(a){console.log(a)})})},b.dayTreeOptions={},b.hoursTreeClick=function(c){console.log("Selecting",c),b.workhourDataSource.transport.options.read.url=a.serviceRoot+"/workhour/list/"+c.clinicId+"/"+c.dayOfWeek+"/"+c.itemId,b.workhourDataSource.read()},b.workhourDataSource=new kendo.data.DataSource({batch:!0,transport:{read:{url:a.serviceRoot+"/workhour/list",dataType:"json",type:"POST",contentType:"application/json"},update:{url:a.serviceRoot+"/workhour/update",dataType:"json",type:"POST",contentType:"application/json"},create:{url:a.serviceRoot+"/workhour/create",dataType:"json",type:"POST",contentType:"application/json"},destroy:{url:a.serviceRoot+"/workhour/destroy",dataType:"json",type:"POST",contentType:"application/json"},parameterMap:function(a,b){return"read"!==b&&a.models?JSON.stringify(a.models[0]):void 0}},schema:{model:{id:"id",fields:{id:{from:"id",type:"number"},clinicId:{from:"clinicId",type:"number",validation:{required:!0}},itemId:{from:"itemId",type:"number",validation:{required:!0}},dayOfWeek:{from:"dayOfWeek",validation:{required:!0}},startTime:{from:"startTime",validation:{required:!0}},endTime:{from:"endTime",validation:{required:!0}},clinicItemUI:{from:"clinicItemUI"}}}}}),b.workhourDataSource.bind("error",b.dataSource_error),b.systemItemsForhoursDS=new kendo.data.DataSource({transport:{read:{url:a.serviceRoot+"/bookitem/listForWorkhours/-1",dataType:"json",type:"POST",contentType:"application/json"}},change:function(a){console.log("e.action",a);var c=b.clinicTabStrip.select().index();2===c&&b.readSpecialDateDS&&(b.specialDataSource.read(),b.readSpecialDateDS=!1)}}),b.clinicItemForHoursEditor=function(a,c){$("<input data-bind='value:"+c.field+"'+ />").appendTo(a).kendoDropDownList({dataSource:b.systemItemsForhoursDS,dataTextField:"itemDesc",dataValueField:"id"})},b.startTimeEditor=function(a,b){$('<input ng-model="'+b.field+'" data-bind="value:'+b.field+'" data-format="'+b.format+'"/>').appendTo(a).kendoTimePicker({format:"HH:mm"}),$("<span class='k-invalid-msg' data-for='"+b.field+"'></span>").appendTo(a)},b.workhourGridOptions={autoBind:!1,dataSource:b.workhourDataSource,sortable:!0,height:200,selectable:"multiple, row",pageable:!1,filterable:!1,editable:{mode:"inline"},columnMenu:!1,groupable:!1,reorderable:!0,resizable:!0,toolbar:["create"],save:function(c){if(""===c.model.startTime||""===c.model.endTime||-1===c.model.itemId){c.preventDefault();h({title:a.ExceptionDialog,message:b.AllFieldsRequired,buttons:[{label:b.confirmLabel,cancel:!0,primary:!1}]})}"object"==typeof c.model.startTime&&c.model.set("startTime",moment(c.model.startTime).format("HH:mm")),"object"==typeof c.model.endTime&&c.model.set("endTime",moment(c.model.endTime).format("HH:mm"))},edit:function(c){if(c.model.isNew()){var d=b.clinicGrid,e=d.dataItem(d.select());if(null==e){c.preventDefault();h({title:a.ExceptionDialog,message:b.SelectClinic,buttons:[{label:b.confirmLabel,cancel:!0,primary:!1}]})}else{var f=b.hoursTree,g=f.select(),i=f.dataItem(g);if(i){console.log("item..",i),c.model.set("clinicId",i.clinicId),c.model.set("dayOfWeek",i.dayOfWeek),c.model.set("itemId",-1);var j={};if(!i.hasChildren){c.model.set("itemId",i.itemId);for(var k=b.systemItemsForhoursDS.data(),l=0,m=k.length;m>l;l++)if(k[l].id===i.itemId){j=k[l];break}}c.model.set("clinicItemUI",j)}else{h({title:a.ExceptionDialog,message:b.SelectClinic,buttons:[{label:b.confirmLabel,cancel:!0,primary:!1}]})}}}},columns:[{field:"clinicItemUI",title:b.ItemDesc,width:"200px",editor:b.clinicItemForHoursEditor,template:"{{getItemDescForHours(dataItem.itemId)}}"},{field:"startTime",title:b.StartTime,width:"100px",format:"{0:HH:mm}",editor:b.startTimeEditor},{field:"endTime",title:b.EndTime,width:"100px",format:"{0:HH:mm}",editor:b.startTimeEditor},{command:[{name:"edit"},{template:"<button class='k-button' style='min-width:16px;' ng-click='deleteClick2(this)'><span class='k-icon k-delete'></span>"+a.Delete+"</button>"}],title:"&nbsp;"}]},b.getItemDescForHours=function(a){for(var c=b.systemItemsForhoursDS.data(),d=0,e=c.length;e>d;d++)if(c[d].id===a)return c[d].itemDesc;return"test"},b.deleteClick2=function(c){var d=h({title:a.WarningDialog,message:a.DeleteItem,buttons:[{label:b.Cancel,cancel:!0,primary:!1},{label:b.confirmLabel,cancel:!1,primary:!1}]});d.then(function(d){e({method:"POST",url:a.serviceRoot+"/workhour/destroy",data:JSON.stringify(c.dataItem)}).then(function(a){b.workhourDataSource.read()},function(a){console.log(a)})})},b.specialDataSource=new kendo.data.DataSource({batch:!0,transport:{read:{url:a.serviceRoot+"/specialdate/list",dataType:"json",type:"POST",contentType:"application/json"},update:{url:a.serviceRoot+"/specialdate/update",dataType:"json",type:"POST",contentType:"application/json"},create:{url:a.serviceRoot+"/specialdate/create",dataType:"json",type:"POST",contentType:"application/json"},destroy:{url:a.serviceRoot+"/specialdate/destroy",dataType:"json",type:"POST",contentType:"application/json"},parameterMap:function(a,c){if("read"!==c&&a.models)return console.log(a.models[0]),JSON.stringify(a.models[0]);var d={},e=b.clinicGrid,f=e.dataItem(e.select());return null!=f?(d.clinicId=f.id,d.effectiveFrom=new Date,d.effectiveTo=null):(d.clinicId=-1,d.effectiveFrom=new Date,d.effectiveTo=null),JSON.stringify(d)}},schema:{model:{id:"id",fields:{id:{from:"id",type:"number"},clinicId:{from:"clinicId",type:"number",validation:{required:!0}},itemId:{from:"itemId",type:"number",validation:{required:!0}},effectiveFrom:{from:"effectiveFrom",type:"date",validation:{required:!0}},effectiveTo:{from:"effectiveTo",type:"date"},description:{from:"description",validation:{required:!0}},openClose:{from:"openClose"},isHoliday:{from:"isHoliday",type:"boolean"},clinicItemUI:{from:"clinicItemUI"}}}}}),b.specialDateGridOptions={dataSource:b.specialDataSource,sortable:!0,selectable:!0,filterable:!0,editable:{mode:"inline"},columnMenu:!0,groupable:!1,reorderable:!0,resizable:!0,detailInit:d,toolbar:["create"],save:function(c){var d=b.clinicGrid,e=d.dataItem(d.select());if(null==e){c.preventDefault();h({title:a.ExceptionDialog,message:b.SelectClinic,buttons:[{label:b.confirmLabel,cancel:!0,primary:!1}]})}if(c.model.isHoliday?c.model.set("openClose","CLOSE"):c.model.set("openClose","OPEN"),c.model.set("clinicId",e.id),c.model.set("itemId",-1),"object"==typeof c.model.clinicItemUI)c.model.itemId=c.model.clinicItemUI.id,c.model.set("itemId",c.model.clinicItemUI.id);else if("number"==typeof c.model.clinicItemUI||"string"==typeof c.model.clinicItemUI){for(var f={},g=b.systemItemsForhoursDS.data(),i=0,j=g.length;j>i;i++)if(g[i].id===c.model.clinicItemUI){f=g[i];break}c.model.set("itemId",f.id),c.model.set("clinicItemUI",f)}},edit:function(c){if(c.model.isNew()){var d=b.clinicGrid,e=d.dataItem(d.select());if(null==e){c.preventDefault();h({title:a.ExceptionDialog,message:b.SelectClinic,buttons:[{label:b.confirmLabel,cancel:!0,primary:!1}]})}}!c.model.isNew()},columns:[{field:"clinicItemUI",title:b.ItemDesc,width:"200px",editor:b.clinicItemForHoursEditor,template:"{{getItemDescForHours(dataItem.itemId)}}"},{field:"isHoliday",title:b.Holiday,width:100},{field:"effectiveFrom",title:b.EffectiveDateFrom,format:"{0:"+a.appParameters.appDateFormat+"}",width:200},{field:"effectiveTo",title:b.EffectiveDateTo,format:"{0:"+a.appParameters.appDateFormat+"}",width:200},{field:"description",title:b.Reason,width:500,editor:b.itemRemarkEditor},{command:[{name:"edit"},{template:"<button class='k-button' style='min-width:16px;' ng-click='deleteClick3(this)'><span class='k-icon k-delete'></span>"+a.Delete+"</button>"}],title:"&nbsp;"}]},b.deleteClick3=function(c){var d=h({title:a.WarningDialog,message:a.DeleteItem,buttons:[{label:b.Cancel,cancel:!0,primary:!1},{label:b.confirmLabel,cancel:!1,primary:!1}]});d.then(function(d){e({method:"POST",url:a.serviceRoot+"/specialdate/destroy",data:JSON.stringify(c.dataItem)}).then(function(a){b.specialDataSource.read()},function(a){console.log(a)})})},b.selectedMasterId=0,b.parasDataSource=new kendo.data.DataSource({batch:!0,transport:{read:{url:a.serviceRoot+"/schedulerparas/list",dataType:"json",type:"POST",contentType:"application/json"},update:{url:a.serviceRoot+"/schedulerparas/update",dataType:"json",type:"POST",contentType:"application/json"},create:{url:a.serviceRoot+"/schedulerparas/create",dataType:"json",type:"POST",contentType:"application/json"},destroy:{url:a.serviceRoot+"/schedulerparas/destroy",dataType:"json",type:"POST",contentType:"application/json"},parameterMap:function(a,c){if("read"!==c&&a.models)return JSON.stringify(a.models[0]);var d=-1,e=b.clinicGrid,f=e.dataItem(e.select());return null!=f&&(d=f.id),JSON.stringify(d)}},schema:{model:{id:"id",fields:{id:{from:"id",type:"number"},clinicId:{from:"clinicId",type:"number"},startTime:{from:"startTime",validation:{required:!0}},endTime:{from:"endTime",validation:{required:!0}},majorTick:{from:"majorTick",type:"number"},groupOrientation:{from:"groupOrientation"}}}}}),b.parasGridOptions={autoBind:!1,dataSource:b.parasDataSource,sortable:!0,selectable:"row",pageable:!1,filterable:!1,editable:{mode:"inline"},columnMenu:!1,groupable:!1,reorderable:!0,resizable:!0,edit:function(a){},columns:[{field:"startTime",title:b.StartTime,width:"200px"},{field:"endTime",title:b.EndTime,width:"200px"},{field:"majorTick",title:b.SchedulerTick,width:"160px",editor:b.sectionTimeEditor},{command:[{name:"edit"},{template:"<button class='k-button' style='min-width:16px;' ng-click='deleteClick4(this)'><span class='k-icon k-delete'></span>"+a.Delete+"</button>"}],title:"&nbsp;"}]},b.deleteClick4=function(c){var d=h({title:a.WarningDialog,message:a.DeleteItem,buttons:[{label:b.Cancel,cancel:!0,primary:!1},{label:b.confirmLabel,cancel:!1,primary:!1}]});d.then(function(d){e({method:"POST",url:a.serviceRoot+"/schedulerparas/destroy",data:JSON.stringify(c.dataItem)}).then(function(a){b.parasDataSource.read()},function(a){console.log(a)})})}})}),b.activedTabName="",b.tabStripOptions={show:function(a){console.log("Shown: "+a.item.innerText+"index :"+b.clinicTabStrip.select().index()),b.refreshSubData()},contentLoad:function(a){console.log("Content loaded in "+a.item.innerText)},error:function(a){console.log("Loading failed with "+a.xhr.statusText+" "+a.xhr.status)}},b.readSpecialDateDS=!1,b.refreshSubData=function(){var c=b.clinicTabStrip.select().index();if(0===c)b.itemsDataSource.read();else if(1===c){var d=b.clinicGrid,f=d.dataItem(d.select());null!==f&&(e({method:"POST",url:a.serviceRoot+"/workhour/listTree/"+f.id}).success(function(a){b.dayTreeOptions.dataSource=new kendo.data.HierarchicalDataSource({data:a,schema:{model:{children:"items"}}})}),b.systemItemsForhoursDS.transport.options.read.url=a.serviceRoot+"/bookitem/listForWorkhours/"+f.id,b.systemItemsForhoursDS.read())}else if(2===c){var d=b.clinicGrid,f=d.dataItem(d.select());null!==f&&(b.readSpecialDateDS=!0,b.systemItemsForhoursDS.transport.options.read.url=a.serviceRoot+"/bookitem/listForWorkhours/"+f.id,b.systemItemsForhoursDS.read())}else if(3===c){var d=b.clinicGrid,f=d.dataItem(d.select());null!==f&&b.parasDataSource.read()}}}]),angular.module("angulardemoApp").controller("ClinicpageCtrl",["$rootScope","$scope","$timeout","$window","$http","$translate","$state","prompt2","parseException",function(a,b,c,d,e,f,g,h,i){var j=angular.element(d);c(function(){j.triggerHandler("resize"),f(["ClinicCode","ClinicName","ClinicAddress","ClinicTel","ItemDesc","Overlap","SectionTime","DisplaySequence","UsRemark","HkRemark","CnRemark","SelectClinic","AllFieldsRequired","StartTime","EndTime","Holiday","EffectiveDateTo","EffectiveDateFrom","Reason","SchedulerTick"]).then(function(c){function d(c){b.selectedMasterId=c.data.id,$("<div/>").appendTo(c.detailCell).kendoGrid({dataSource:{batch:!0,transport:{read:{url:b.serviceRoot+"/specialdatedetail/list",dataType:"json",type:"POST",contentType:"application/json"},create:{url:b.serviceRoot+"/specialdatedetail/create",dataType:"json",type:"POST",contentType:"application/json"},update:{url:b.serviceRoot+"/specialdatedetail/update",dataType:"json",type:"POST",contentType:"application/json"},destroy:{url:b.serviceRoot+"/specialdatedetail/destroy",dataType:"json",type:"POST",contentType:"application/json"},parameterMap:function(a,b){if("read"!==b&&a.models)return console.log("edit..",a.models[0]),JSON.stringify(a.models[0]);if("read"===b){var d={masterId:c.data.id};return JSON.stringify(d)}}},schema:{model:{id:"id",fields:{masterId:{from:"masterId",type:"number"},id:{from:"id",type:"number"},startTime:{from:"startTime",validation:{required:!0}},endTime:{from:"endTime",validation:{required:!0}}}}}},scrollable:!0,sortable:!0,pageable:!1,toolbar:["create"],editable:"inline",save:function(c){if(""===c.model.startTime||""===c.model.endTime){c.preventDefault();h({title:a.ExceptionDialog,message:"Start or End is required!",buttons:[{label:b.confirmLabel,cancel:!0,primary:!1}]})}"object"==typeof c.model.startTime&&c.model.set("startTime",moment(c.model.startTime).format("HH:mm")),"object"==typeof c.model.endTime&&c.model.set("endTime",moment(c.model.endTime).format("HH:mm"))},edit:function(a){a.model.isNew()&&a.model.set("masterId",b.selectedMasterId)},columns:[{field:"startTime",title:b.StartTime,width:"100px",format:"{0:HH:mm}",editor:b.startTimeEditor},{field:"endTime",title:b.EndTime,width:"100px",format:"{0:HH:mm}",editor:b.startTimeEditor},{command:["edit","destroy"]}]})}b.ClinicCode=c.ClinicCode,b.ClinicName=c.ClinicName,b.ClinicAddress=c.ClinicAddress,b.ClinicTel=c.ClinicTel,b.ItemDesc=c.ItemDesc,b.Overlap=c.Overlap,b.SectionTime=c.SectionTime,b.DisplaySequence=c.DisplaySequence,b.UsRemark=c.UsRemark,b.HkRemark=c.HkRemark,b.CnRemark=c.CnRemark,b.SelectClinic=c.SelectClinic,b.AllFieldsRequired=c.AllFieldsRequired,b.StartTime=c.StartTime,b.EndTime=c.EndTime,b.Holiday=c.Holiday,b.EffectiveDateFrom=c.EffectiveDateFrom,b.EffectiveDateTo=c.EffectiveDateTo,b.Reason=c.Reason,b.SchedulerTick=c.SchedulerTick,b.dataSource_error=function(b){console.log(b),i.alertmsg(b,a.errorMessages)},b.dataSource=new kendo.data.DataSource({batch:!0,transport:{read:{url:a.serviceRoot+"/clinic/list",dataType:"json",type:"POST",contentType:"application/json"},update:{url:a.serviceRoot+"/clinic/update",dataType:"json",type:"POST",contentType:"application/json"},create:{url:a.serviceRoot+"/clinic/create",dataType:"json",type:"POST",contentType:"application/json"},destroy:{url:a.serviceRoot+"/clinic/destroy",dataType:"json",type:"POST",contentType:"application/json"},parameterMap:function(a,b){return"read"!==b&&a.models?JSON.stringify(a.models[0]):void 0}},pageSize:20,schema:{model:{id:"id",fields:{id:{from:"id",type:"number"},clinicCode:{from:"clinicCode",validation:{required:!0}},clinicName:{from:"clinicName",validation:{required:!0}},clinicAddress:{from:"clinicAddress",validation:{required:!0}},clinicTel:{from:"clinicTel",validation:{required:!0}}}}}}),b.dataSource.bind("error",b.dataSource_error),b.clinicGridOptions={dataSource:b.dataSource,sortable:!0,selectable:"row",pageable:!1,filterable:!1,editable:{mode:"inline"},columnMenu:!1,groupable:!1,reorderable:!0,resizable:!0,toolbar:["create"],change:function(a){this.select();b.refreshSubData()},columns:[{field:"clinicCode",title:b.ClinicCode,width:"100px"},{field:"clinicName",title:b.ClinicName,width:"200px"},{field:"clinicAddress",title:b.ClinicAddress,width:"300px"},{field:"clinicTel",title:b.ClinicTel,width:"160px"},{command:[{name:"edit"},{template:"<button class='k-button' style='min-width:16px;' ng-click='deleteClick(this)'><span class='k-icon k-delete'></span>"+a.Delete+"</button>"}],title:"&nbsp;"}]},b.deleteClick=function(c){var d=h({title:a.WarningDialog,message:a.DeleteItem,buttons:[{label:b.Cancel,cancel:!0,primary:!1},{label:b.confirmLabel,cancel:!1,primary:!1}]});d.then(function(d){console.log(c.dataItem),e({method:"POST",url:a.serviceRoot+"/clinic/destroy",data:JSON.stringify(c.dataItem)}).then(function(a){b.dataSource.read()},function(a){console.log(a)})})},b.itemsDataSource=new kendo.data.DataSource({batch:!0,transport:{read:{url:a.serviceRoot+"/bookitem/list",dataType:"json",type:"POST",contentType:"application/json"},update:{url:a.serviceRoot+"/bookitem/update",dataType:"json",type:"POST",contentType:"application/json"},create:{url:a.serviceRoot+"/bookitem/create",dataType:"json",type:"POST",contentType:"application/json"},destroy:{url:a.serviceRoot+"/bookitem/destroy",dataType:"json",type:"POST",contentType:"application/json"},parameterMap:function(a,c){if("read"!==c&&a.models){var d=b.clinicGrid,e=d.dataItem(d.select());if(null!=e&&(a.models[0].clinicId=e.id),"object"==typeof a.models[0].clinicItemUI)a.models[0].itemId=a.models[0].clinicItemUI.id;else if("number"==typeof a.models[0].clinicItemUI||"string"==typeof a.models[0].clinicItemUI){console.log("test"),a.models[0].itemId=a.models[0].clinicItemUI;var f={};f.id=a.models[0].clinicItemUI,a.models[0].clinicItemUI=f}return JSON.stringify(a.models[0])}if("read"===c){var g={},d=b.clinicGrid,e=d.dataItem(d.select());null!=e?g.clinicId=e.id:g.clinicId="NULL";var h=[g];return JSON.stringify(h)}}},pageSize:20,schema:{model:{id:"id",fields:{id:{from:"id",type:"number"},clinicId:{from:"clinicId",type:"number",validation:{required:!0}},itemId:{from:"itemId",type:"number"},itemCode:{from:"itemCode"},itemDesc:{from:"itemDesc"},itemSequence:{from:"itemSequence",validation:{required:!0}},overlap:{from:"overlap",type:"boolean"},sectionTime:{from:"sectionTime",type:"number"},usRemark:{from:"usRemark"},hkRemark:{from:"hkRemark"},cnRemark:{from:"cnRemark"},color:{from:"color"},clinicItemUI:{from:"clinicItemUI"}}}}}),b.itemsDataSource.bind("error",b.dataSource_error),b.systemItemsDS=new kendo.data.DataSource({transport:{read:{url:a.serviceRoot+"/item/list",dataType:"json",type:"POST",contentType:"application/json"}}}),b.systemItemsDS.read(),b.clinicItemEditor=function(a,c){$("<input data-bind='value:"+c.field+"'+ />").appendTo(a).kendoDropDownList({dataSource:b.systemItemsDS,dataTextField:"itemDesc",dataValueField:"id"})},b.sectionTimeEditor=function(a,b){$('<input data-bind="value:'+b.field+'"/>').appendTo(a).kendoNumericTextBox({min:5,step:5,format:"n0"})},b.itemRemarkEditor=function(a,b){$('<textarea name="'+b.field+'" style="width: '+a.width()+'px;height:72px" />').appendTo(a)},b.itemsGridOptions={autoBind:!1,dataSource:b.itemsDataSource,sortable:!0,selectable:"row",pageable:!1,filterable:!1,editable:{mode:"inline"},columnMenu:!1,groupable:!1,reorderable:!0,resizable:!0,toolbar:["create"],edit:function(c){if(c.model.isNew()){var d=b.clinicGrid,e=d.dataItem(d.select());if(null==e){c.preventDefault();h({title:a.ExceptionDialog,message:b.SelectClinic,buttons:[{label:b.confirmLabel,cancel:!0,primary:!1}]})}}},columns:[{field:"clinicItemUI",title:b.ItemDesc,width:"150px",editor:b.clinicItemEditor,template:"{{getItemDesc(dataItem.itemId)}}"},{field:"overlap",title:b.Overlap,width:"100px"},{field:"sectionTime",title:b.SectionTime,editor:b.sectionTimeEditor,width:"200px"},{field:"itemSequence",title:b.DisplaySequence,width:"120px"},{field:"usRemark",title:b.UsRemark,editor:b.itemRemarkEditor,width:"220px"},{field:"hkRemark",title:b.HkRemark,editor:b.itemRemarkEditor,width:"220px"},{field:"cnRemark",title:b.CnRemark,editor:b.itemRemarkEditor,width:"220px"},{command:[{name:"edit"},{template:"<button class='k-button' style='min-width:16px;' ng-click='deleteClick2(this)'><span class='k-icon k-delete'></span>"+a.Delete+"</button>"}],title:"&nbsp;"}]},b.getItemDesc=function(a){for(var c=b.systemItemsDS.data(),d=0,e=c.length;e>d;d++)if(c[d].id===a)return c[d].itemDesc;return"test"},b.deleteClick2=function(c){var d=h({title:a.WarningDialog,message:a.DeleteItem,buttons:[{label:b.Cancel,cancel:!0,primary:!1},{label:b.confirmLabel,cancel:!1,primary:!1}]});d.then(function(d){console.log(c.dataItem),e({method:"POST",url:a.serviceRoot+"/bookitem/destroy",data:JSON.stringify(c.dataItem)}).then(function(a){b.itemsDataSource.read()},function(a){console.log(a)})})},b.dayTreeOptions={},b.hoursTreeClick=function(c){console.log("Selecting",c),b.workhourDataSource.transport.options.read.url=a.serviceRoot+"/workhour/list/"+c.clinicId+"/"+c.dayOfWeek+"/"+c.itemId,b.workhourDataSource.read()},b.workhourDataSource=new kendo.data.DataSource({batch:!0,transport:{read:{url:a.serviceRoot+"/workhour/list",dataType:"json",type:"POST",contentType:"application/json"},update:{url:a.serviceRoot+"/workhour/update",dataType:"json",type:"POST",contentType:"application/json"},create:{url:a.serviceRoot+"/workhour/create",dataType:"json",type:"POST",contentType:"application/json"},destroy:{url:a.serviceRoot+"/workhour/destroy",dataType:"json",type:"POST",contentType:"application/json"},parameterMap:function(a,b){return"read"!==b&&a.models?JSON.stringify(a.models[0]):void 0}},schema:{model:{id:"id",fields:{id:{from:"id",type:"number"},clinicId:{from:"clinicId",type:"number",validation:{required:!0}},itemId:{from:"itemId",type:"number",validation:{required:!0}},dayOfWeek:{from:"dayOfWeek",validation:{required:!0}},startTime:{from:"startTime",validation:{required:!0}},endTime:{from:"endTime",validation:{required:!0}},clinicItemUI:{from:"clinicItemUI"}}}}}),b.workhourDataSource.bind("error",b.dataSource_error),b.systemItemsForhoursDS=new kendo.data.DataSource({transport:{read:{url:a.serviceRoot+"/bookitem/listForWorkhours/-1",dataType:"json",type:"POST",contentType:"application/json"}},change:function(a){console.log("e.action",a);var c=b.clinicTabStrip.select().index();2===c&&b.readSpecialDateDS&&(b.specialDataSource.read(),b.readSpecialDateDS=!1)}}),b.clinicItemForHoursEditor=function(a,c){$("<input data-bind='value:"+c.field+"'+ />").appendTo(a).kendoDropDownList({dataSource:b.systemItemsForhoursDS,dataTextField:"itemDesc",dataValueField:"id"})},b.startTimeEditor=function(a,b){$('<input ng-model="'+b.field+'" data-bind="value:'+b.field+'" data-format="'+b.format+'"/>').appendTo(a).kendoTimePicker({format:"HH:mm"}),$("<span class='k-invalid-msg' data-for='"+b.field+"'></span>").appendTo(a)},b.workhourGridOptions={autoBind:!1,dataSource:b.workhourDataSource,sortable:!0,height:200,selectable:"multiple, row",pageable:!1,filterable:!1,editable:{mode:"inline"},columnMenu:!1,groupable:!1,reorderable:!0,resizable:!0,toolbar:["create"],save:function(c){if(""===c.model.startTime||""===c.model.endTime||-1===c.model.itemId){c.preventDefault();h({title:a.ExceptionDialog,message:b.AllFieldsRequired,buttons:[{label:b.confirmLabel,cancel:!0,primary:!1}]})}"object"==typeof c.model.startTime&&c.model.set("startTime",moment(c.model.startTime).format("HH:mm")),"object"==typeof c.model.endTime&&c.model.set("endTime",moment(c.model.endTime).format("HH:mm"))},edit:function(c){if(c.model.isNew()){var d=b.clinicGrid,e=d.dataItem(d.select());if(null==e){c.preventDefault();h({title:a.ExceptionDialog,message:b.SelectClinic,buttons:[{label:b.confirmLabel,cancel:!0,primary:!1}]})}else{var f=b.hoursTree,g=f.select(),i=f.dataItem(g);if(i){console.log("item..",i),c.model.set("clinicId",i.clinicId),c.model.set("dayOfWeek",i.dayOfWeek),c.model.set("itemId",-1);var j={};if(!i.hasChildren){c.model.set("itemId",i.itemId);for(var k=b.systemItemsForhoursDS.data(),l=0,m=k.length;m>l;l++)if(k[l].id===i.itemId){j=k[l];break}}c.model.set("clinicItemUI",j)}else{h({title:a.ExceptionDialog,message:b.SelectClinic,buttons:[{label:b.confirmLabel,cancel:!0,primary:!1}]})}}}},columns:[{field:"clinicItemUI",title:b.ItemDesc,width:"200px",editor:b.clinicItemForHoursEditor,template:"{{getItemDescForHours(dataItem.itemId)}}"},{field:"startTime",title:b.StartTime,width:"100px",format:"{0:HH:mm}",editor:b.startTimeEditor},{field:"endTime",title:b.EndTime,width:"100px",format:"{0:HH:mm}",editor:b.startTimeEditor},{command:[{name:"edit"},{template:"<button class='k-button' style='min-width:16px;' ng-click='deleteClick3(this)'><span class='k-icon k-delete'></span>"+a.Delete+"</button>"}],title:"&nbsp;"}]},b.getItemDescForHours=function(a){for(var c=b.systemItemsForhoursDS.data(),d=0,e=c.length;e>d;d++)if(c[d].id===a)return c[d].itemDesc;return"test"},b.deleteClick3=function(c){var d=h({title:a.WarningDialog,message:a.DeleteItem,buttons:[{label:b.Cancel,cancel:!0,primary:!1},{label:b.confirmLabel,cancel:!1,primary:!1}]});d.then(function(d){e({method:"POST",url:a.serviceRoot+"/workhour/destroy",data:JSON.stringify(c.dataItem)}).then(function(a){b.workhourDataSource.read()},function(a){console.log(a)})})},b.specialDataSource=new kendo.data.DataSource({batch:!0,transport:{read:{url:a.serviceRoot+"/specialdate/list",dataType:"json",type:"POST",contentType:"application/json"},update:{url:a.serviceRoot+"/specialdate/update",dataType:"json",type:"POST",contentType:"application/json"},create:{url:a.serviceRoot+"/specialdate/create",dataType:"json",type:"POST",contentType:"application/json"},destroy:{url:a.serviceRoot+"/specialdate/destroy",dataType:"json",type:"POST",contentType:"application/json"},parameterMap:function(a,c){if("read"!==c&&a.models)return console.log(a.models[0]),JSON.stringify(a.models[0]);var d={},e=b.clinicGrid,f=e.dataItem(e.select());return null!=f?(d.clinicId=f.id,d.effectiveFrom=new Date,d.effectiveTo=null):(d.clinicId=-1,d.effectiveFrom=new Date,d.effectiveTo=null),JSON.stringify(d)}},schema:{model:{id:"id",fields:{id:{from:"id",type:"number"},clinicId:{from:"clinicId",type:"number",validation:{required:!0}},itemId:{from:"itemId",type:"number",validation:{required:!0}},effectiveFrom:{from:"effectiveFrom",type:"date",validation:{required:!0}},effectiveTo:{from:"effectiveTo",type:"date"},description:{from:"description",validation:{required:!0}},openClose:{from:"openClose"},isHoliday:{from:"isHoliday",type:"boolean"},clinicItemUI:{from:"clinicItemUI"}}}}}),b.specialDateGridOptions={dataSource:b.specialDataSource,sortable:!0,selectable:!0,filterable:!0,editable:{mode:"inline"},columnMenu:!0,groupable:!1,reorderable:!0,resizable:!0,detailInit:d,toolbar:["create"],save:function(c){var d=b.clinicGrid,e=d.dataItem(d.select());if(null==e){c.preventDefault();h({title:a.ExceptionDialog,message:b.SelectClinic,buttons:[{label:b.confirmLabel,cancel:!0,primary:!1}]})}if(c.model.isHoliday?c.model.set("openClose","CLOSE"):c.model.set("openClose","OPEN"),c.model.set("clinicId",e.id),c.model.set("itemId",-1),"object"==typeof c.model.clinicItemUI)c.model.itemId=c.model.clinicItemUI.id,c.model.set("itemId",c.model.clinicItemUI.id);else if("number"==typeof c.model.clinicItemUI||"string"==typeof c.model.clinicItemUI){for(var f={},g=b.systemItemsForhoursDS.data(),i=0,j=g.length;j>i;i++)if(g[i].id===c.model.clinicItemUI){f=g[i];break}c.model.set("itemId",f.id),c.model.set("clinicItemUI",f)}},edit:function(c){if(c.model.isNew()){var d=b.clinicGrid,e=d.dataItem(d.select());if(null==e){c.preventDefault();h({title:a.ExceptionDialog,message:b.SelectClinic,buttons:[{label:b.confirmLabel,cancel:!0,primary:!1}]})}}!c.model.isNew()},columns:[{field:"clinicItemUI",title:b.ItemDesc,width:"200px",editor:b.clinicItemForHoursEditor,template:"{{getItemDescForHours(dataItem.itemId)}}"},{field:"isHoliday",title:b.Holiday,width:100},{field:"effectiveFrom",title:b.EffectiveDateFrom,format:"{0:"+a.appParameters.appDateFormat+"}",width:200},{field:"effectiveTo",title:b.EffectiveDateTo,format:"{0:"+a.appParameters.appDateFormat+"}",width:200},{field:"description",title:b.Reason,width:500,editor:b.itemRemarkEditor},{command:[{name:"edit"},{template:"<button class='k-button' style='min-width:16px;' ng-click='deleteClick4(this)'><span class='k-icon k-delete'></span>"+a.Delete+"</button>"}],title:"&nbsp;"}]},b.deleteClick4=function(c){var d=h({title:a.WarningDialog,message:a.DeleteItem,buttons:[{label:b.Cancel,cancel:!0,primary:!1},{label:b.confirmLabel,cancel:!1,primary:!1}]});d.then(function(d){e({method:"POST",url:a.serviceRoot+"/specialdate/destroy",data:JSON.stringify(c.dataItem)}).then(function(a){b.specialDataSource.read()},function(a){console.log(a)})})},b.selectedMasterId=0,b.parasDataSource=new kendo.data.DataSource({batch:!0,transport:{read:{url:a.serviceRoot+"/schedulerparas/list",dataType:"json",type:"POST",contentType:"application/json"},update:{url:a.serviceRoot+"/schedulerparas/update",dataType:"json",type:"POST",contentType:"application/json"},create:{url:a.serviceRoot+"/schedulerparas/create",dataType:"json",type:"POST",contentType:"application/json"},destroy:{url:a.serviceRoot+"/schedulerparas/destroy",dataType:"json",type:"POST",contentType:"application/json"},parameterMap:function(a,c){if("read"!==c&&a.models)return JSON.stringify(a.models[0]);var d=-1,e=b.clinicGrid,f=e.dataItem(e.select());return null!=f&&(d=f.id),JSON.stringify(d)}},schema:{model:{id:"id",fields:{id:{from:"id",type:"number"},clinicId:{from:"clinicId",type:"number"},startTime:{from:"startTime",validation:{required:!0}},endTime:{from:"endTime",validation:{required:!0}},majorTick:{from:"majorTick",type:"number"},groupOrientation:{from:"groupOrientation"}}}}}),b.parasGridOptions={autoBind:!1,dataSource:b.parasDataSource,sortable:!0,selectable:"row",pageable:!1,filterable:!1,editable:{mode:"inline"},columnMenu:!1,groupable:!1,reorderable:!0,resizable:!0,edit:function(a){},columns:[{field:"startTime",title:b.StartTime,width:"200px"},{field:"endTime",title:b.EndTime,width:"200px"},{field:"majorTick",title:b.SchedulerTick,width:"160px",editor:b.sectionTimeEditor},{command:[{name:"edit"},{template:"<button class='k-button' style='min-width:16px;' ng-click='deleteClick5(this)'><span class='k-icon k-delete'></span>"+a.Delete+"</button>"}],title:"&nbsp;"}]},b.deleteClick5=function(c){var d=h({title:a.WarningDialog,message:a.DeleteItem,buttons:[{label:b.Cancel,cancel:!0,primary:!1},{label:b.confirmLabel,cancel:!1,primary:!1}]});d.then(function(d){e({method:"POST",url:a.serviceRoot+"/schedulerparas/destroy",data:JSON.stringify(c.dataItem)}).then(function(a){b.parasDataSource.read()},function(a){console.log(a)})})}})}),b.activedTabName="",b.tabStripOptions={show:function(a){console.log("Shown: "+a.item.innerText+"index :"+b.clinicTabStrip.select().index()),
b.refreshSubData()},contentLoad:function(a){console.log("Content loaded in "+a.item.innerText)},error:function(a){console.log("Loading failed with "+a.xhr.statusText+" "+a.xhr.status)}},b.readSpecialDateDS=!1,b.refreshSubData=function(){var c=b.clinicTabStrip.select().index();if(0===c)b.itemsDataSource.read();else if(1===c){var d=b.clinicGrid,f=d.dataItem(d.select());null!==f&&(e({method:"POST",url:a.serviceRoot+"/workhour/listTree/"+f.id}).success(function(a){b.dayTreeOptions.dataSource=new kendo.data.HierarchicalDataSource({data:a,schema:{model:{children:"items"}}})}),b.systemItemsForhoursDS.transport.options.read.url=a.serviceRoot+"/bookitem/listForWorkhours/"+f.id,b.systemItemsForhoursDS.read())}else if(2===c){var d=b.clinicGrid,f=d.dataItem(d.select());null!==f&&(b.readSpecialDateDS=!0,b.systemItemsForhoursDS.transport.options.read.url=a.serviceRoot+"/bookitem/listForWorkhours/"+f.id,b.systemItemsForhoursDS.read())}else if(3===c){var d=b.clinicGrid,f=d.dataItem(d.select());null!==f&&b.parasDataSource.read()}}}]),angular.module("angulardemoApp").config(["$stateProvider",function(a){a.state("clinicpage",{views:{clinictab:{url:"/clinicpage",templateUrl:"/BookingSystem/app/clinicpage/clinicpage.html",controller:"ClinicpageCtrl"}},sticky:!0})}]),angular.module("angulardemoApp").controller("GriddemoCtrl",["$scope",function(a){a.crudServiceBaseUrl="http://demos.telerik.com/kendo-ui/service",a.dataSource=new kendo.data.DataSource({transport:{read:{url:a.crudServiceBaseUrl+"/Products",dataType:"jsonp"},update:{url:a.crudServiceBaseUrl+"/Products/Update",dataType:"jsonp"},destroy:{url:a.crudServiceBaseUrl+"/Products/Destroy",dataType:"jsonp"},create:{url:a.crudServiceBaseUrl+"/Products/Create",dataType:"jsonp"},parameterMap:function(a,b){return"read"!==b&&a.models?{models:kendo.stringify(a.models)}:void 0}},batch:!0,pageSize:20,schema:{model:{id:"ProductID",fields:{ProductID:{editable:!1,nullable:!0},ProductName:{validation:{required:!0}},UnitPrice:{type:"number",validation:{required:!0,min:1}},Discontinued:{type:"boolean"},UnitsInStock:{type:"number",validation:{min:0,required:!0}}}}}}),a.mainGridOptions={language:"zh-HK",dataSource:a.dataSource,sortable:!0,selectable:!0,pageable:!0,editable:"popup",toolbar:["create",{name:"customEdit",text:"Edit",imageClass:"k-edit",className:"k-custom-edit",iconClass:"k-icon"}],columns:["ProductName",{field:"UnitPrice",title:"Unit Price",format:"{0:c}",width:"120px"},{field:"UnitsInStock",title:"Units In Stock",width:"120px"},{field:"Discontinued",width:"120px"}]},a.$on("kendoWidgetCreated",function(b,c){c===a.myGrid&&c.element.find(".k-custom-edit").on("click",function(b){b.preventDefault();var c=a.myGrid.select();0==c.length?alert("No record selected"):a.myGrid.editRow(c)})}),a.doOperation=function(a){console.log(a),alert("test")},a.visibelAttrs=[{editbtn:!0}]}]),angular.module("angulardemoApp").config(["$stateProvider",function(a){a.state("griddemo",{views:{mytab2:{url:"/griddemo",templateUrl:"/BookingSystem/app/griddemo/griddemo.html",controller:"GriddemoCtrl"}},sticky:!0})}]),angular.module("angulardemoApp").controller("ItempageCtrl",["$rootScope","$scope","$timeout","$window","$http","$translate","$state","prompt2","parseException",function(a,b,c,d,e,f,g,h,i){c(function(){f(["ItemCode","ItemDesc","ItemColor","Category","ItemShortDesc"]).then(function(c){b.ItemCode=c.ItemCode,b.ItemDesc=c.ItemDesc,b.ItemColor=c.ItemColor,b.Category=c.Category,b.ItemShortDesc=c.ItemShortDesc,b.categoryEditor=function(a,c){$("<select multiple='multiple' data-bind='value : categorys'/>").appendTo(a).kendoMultiSelect({dataTextField:"itemCat",dataValueField:"itemCat",dataSource:b.categoryDataSource})},b.itemGridOptions={dataSource:b.dataSource,sortable:!0,selectable:"row",pageable:{refresh:!0,pageSizes:!0},filterable:!0,editable:{mode:"inline"},columnMenu:!0,groupable:!1,reorderable:!0,resizable:!0,toolbar:["create"],save:function(a){if(""!==a.model.categorys&&"object"==typeof a.model.categorys){for(var b="",c=0;c<a.model.categorys.length;c++)""===b?b=a.model.categorys[c].itemCat:b+=","+a.model.categorys[c].itemCat;a.model.itemCat=b}},columns:[{field:"itemCode",title:b.ItemCode,width:"200px"},{field:"itemDesc",title:b.ItemDesc,width:"150px"},{field:"colDesc",title:b.ItemShortDesc,width:"200px"},{field:"categorys",title:b.Category,width:"200px",editor:b.categoryEditor,template:function(a){for(var b=[],c=0;c<a.categorys.length;c++)b.push(a.categorys[c].itemCat);return b.join(", ")}},{command:[{name:"edit"},{template:"<button class='k-button' style='min-width:16px;' ng-click='deleteClick(this)'><span class='k-icon k-delete'></span>"+a.Delete+"</button>"}],title:"&nbsp;"}]},b.deleteClick=function(c){var d=h({title:a.WarningDialog,message:a.DeleteItem,buttons:[{label:b.Cancel,cancel:!0,primary:!1},{label:b.confirmLabel,cancel:!1,primary:!1}]});d.then(function(d){console.log(c.dataItem),e({method:"POST",url:a.serviceRoot+"/item/destroy",data:JSON.stringify(c.dataItem)}).then(function(a){b.dataSource.read()},function(a){console.log(a)})})}})}),b.dataSource_error=function(b){console.log(b),i.alertmsg(b,a.errorMessages)},b.dataSource=new kendo.data.DataSource({batch:!0,transport:{read:{url:a.serviceRoot+"/item/list",dataType:"json",type:"POST",contentType:"application/json"},update:{url:a.serviceRoot+"/item/update",dataType:"json",type:"POST",contentType:"application/json"},create:{url:a.serviceRoot+"/item/create",dataType:"json",type:"POST",contentType:"application/json"},destroy:{url:a.serviceRoot+"/item/destroy",dataType:"json",type:"POST",contentType:"application/json"},parameterMap:function(a,b){return"read"!==b&&a.models?JSON.stringify(a.models[0]):void 0}},pageSize:20,schema:{model:{id:"id",fields:{id:{from:"id",type:"number"},itemCode:{from:"itemCode",validation:{required:!0}},itemDesc:{from:"itemDesc"},itemCat:{from:"itemCat"},colDesc:{from:"colDesc"},itemType:{from:"itemType"},color:{from:"color"}}}}}),b.dataSource.bind("error",b.dataSource_error),b.categoryDataSource=new kendo.data.DataSource({transport:{read:{url:a.serviceRoot+"/booking/findItemCat",dataType:"json",type:"GET",contentType:"application/json"}}}),b.categoryDataSource.bind("error",b.dataSource_error)}]),angular.module("angulardemoApp").config(["$stateProvider",function(a){a.state("itempage",{views:{itemtab:{url:"/itempage",templateUrl:"/BookingSystem/app/itempage/itempage.html",controller:"ItempageCtrl"}},sticky:!0})}]),angular.module("angulardemoApp").service("loadParaService2",function(){return{makeFact:function(){return["$q","$timeout",function(a,b){var c=a.defer(),d=500+Math.floor(1e3*Math.random());return console.log("service:loadParaService will time out in "+d+"Ms"),b(function(){console.log("resolving "+returnText),c.resolve("Service loadParaService returned in "+d+"Milliseconds")},d),c.promise}]}}}),angular.module("angulardemoApp").controller("LoginCtrl",["$scope","$rootScope","$location","$state","AuthenticationService",function(a,b,c,d,e){a.login=function(){a.dataLoading=!0,e.Login(a.username,a.password,function(b){b.success?d.go("/"):(a.error=b.message,a.dataLoading=!1)})}}]),angular.module("angulardemoApp").config(["$stateProvider",function(a){a.state("login",{url:"/login",templateUrl:"/BookingSystem/app/login/login.html",controller:"LoginCtrl"})}]),angular.module("angulardemoApp").controller("MainCtrl",["$rootScope","$scope","$timeout","$window","$http","$translate","$state",function(a,b,c,d,e,f,g){b.awesomeThings=[],kendo.ui.progress($("#mainPage"),!0),c(function(){console.log("timeout"),f(["APP1000","APP1001","ExceptionDialog","Confirm","WarningDialog","InfoDialog","OperationSuccess","OperationFailure","NoRecordSelected","required","email","url","date","pattern","min","max","dateCompare","Delete","Edit","Cancel","DeleteItem"]).then(function(b){a.errorMessages={},a.errorMessages.APP1000=b.APP1000,a.errorMessages.APP1001=b.APP1001,a.ExceptionDialog=b.ExceptionDialog,a.InfoDialog=b.InfoDialog,a.WarningDialog=b.WarningDialog,a.OperationSuccess=b.OperationSuccess,a.OperationFailure=b.OperationFailure,a.NoRecordSelected=b.NoRecordSelected,a.required=b.required,a.url=b.url,a.email=b.email,a.min=b.min,a.max=b.max,a.date=b.date,a.pattern=b.pattern,a.dateCompare=b.dateCompare,a.confirmLabel=b.Confirm,a.Delete=b.Delete,a.Edit=b.Edit,a.Cancel=b.Cancel,a.DeleteItem=b.DeleteItem,console.log(a.userLanguage+" in app.js :"+b.ExceptionDialog),function(b,c){b.extend(!0,c.ui.validator,{messages:{required:a.required}})}(jQuery,kendo),kendo.ui.progress($("#mainPage"),!1)})})}]),angular.module("angulardemoApp").config(["$stateProvider",function(a){a.state("/",{views:{hometab:{url:"/",templateUrl:"/BookingSystem/app/main/main.html",controller:"MainCtrl"}}})}]).config(["$stickyStateProvider",function(a){a.enableDebug(!0)}]).run(["$rootScope","$state",function(a,b){a.$state=b}]),angular.module("angulardemoApp").controller("MenulabelpageCtrl",["$rootScope","$scope","$timeout","$window","$http","$translate","$state","prompt2",function(a,b,c,d,e,f,g,h){c(function(){f(["MenulabelUS","MenulabelHK","MenulabelCN"]).then(function(c){b.MenulabelUS=c.MenulabelUS,b.MenulabelHK=c.MenulabelHK,b.MenulabelCN=c.MenulabelCN,b.dataSource_error=function(a){console.log(a.status),console.log(a)},b.dataSource=new kendo.data.DataSource({batch:!0,transport:{read:{url:a.serviceRoot+"/menu/readLabel",dataType:"json",type:"POST",contentType:"application/json"},update:{url:a.serviceRoot+"/menu/updateLabel",dataType:"json",type:"POST",contentType:"application/json"},parameterMap:function(a,b){return"read"!==b&&a.models?JSON.stringify(a.models[0]):void 0}},pageSize:20,schema:{model:{id:"id",fields:{id:{from:"id",type:"number"},text:{from:"text",validation:{required:!0,validationMessage:b.MenulabelUS+a.required}},hkText:{from:"hkText",validation:{required:!0,validationMessage:b.MenulabelHK+a.required}},cnText:{from:"cnText",validation:{required:!0,validationMessage:b.MenulabelCN+a.required}}}}}}),b.dataSource.bind("error",b.dataSource_error),b.menuGridOptions={dataSource:b.dataSource,sortable:!0,selectable:"row",pageable:{refresh:!0,pageSizes:!0},filterable:!0,editable:"inline",columnMenu:!0,reorderable:!0,resizable:!0,columns:[{field:"text",title:b.MenulabelUS,width:"280px"},{field:"hkText",title:b.MenulabelHK,width:"280px"},{field:"cnText",title:b.MenulabelCN,width:"280px"},{command:["edit"],title:"&nbsp;"}]}})})}]),angular.module("angulardemoApp").config(["$stateProvider",function(a){a.state("menulabelpage",{views:{menulabeltab:{url:"/menulabelpage",templateUrl:"/BookingSystem/app/menulabelpage/menulabelpage.html",controller:"MenulabelpageCtrl"}},sticky:!0})}]),angular.module("angulardemoApp").controller("RolepageCtrl",["$rootScope","$scope","$timeout","$window","$http","$translate","$state","prompt2","parseException",function(a,b,c,d,e,f,g,h,i){function j(c){console.log(l);var d=b.roleGrid;if(0==d.select().length)h({title:a.ExceptionDialog,message:a.NoRecordSelected,buttons:[{label:a.confirmLabel,cancel:!0,primary:!1}]});else{var f=d.dataItem(d.select());e({method:"POST",url:a.serviceRoot+"/menu/saveRoleMenu/"+f.role,data:JSON.stringify(l)}).then(function(b){h({title:a.InfoDialog,message:a.OperationSuccess,buttons:[{label:a.confirmLabel,cancel:!0,primary:!1}]})},function(b){h({title:a.ExceptionDialog,message:a.OperationFailure,buttons:[{label:a.confirmLabel,cancel:!0,primary:!1}]})})}}var k=angular.element(d);c(function(){k.triggerHandler("resize")}),c(function(){f(["RoleCode","RoleDesc"]).then(function(c){b.RoleCode=c.RoleCode,b.RoleDesc=c.RoleDesc,b.roleGridOptions={dataSource:b.dataSource,sortable:!0,selectable:"row",filterable:!0,editable:{mode:"inline"},columnMenu:!1,groupable:!1,reorderable:!0,resizable:!0,toolbar:["create"],columns:[{field:"role",title:b.RoleCode,width:200},{field:"roleDesc",title:b.RoleDesc,width:200},{command:[{name:"edit"},{template:"<button class='k-button' style='min-width:16px;' ng-click='deleteClick(this)'><span class='k-icon k-delete'></span>"+a.Delete+"</button>"}],title:"&nbsp;"}]},b.deleteClick=function(c){var d=h({title:a.WarningDialog,message:a.DeleteItem,buttons:[{label:b.Cancel,cancel:!0,primary:!1},{label:b.confirmLabel,cancel:!1,primary:!1}]});d.then(function(d){console.log(c.dataItem),e({method:"POST",url:a.serviceRoot+"/role/destroy",data:JSON.stringify(c.dataItem)}).then(function(a){b.dataSource.read()},function(a){console.log(a)})})},b.treeRoleOptions={},b.changeRole=function(c){var d=b.roleGrid,f=d.dataItem(d.select());e({method:"GET",url:a.serviceRoot+"/menu/tree/forRole/"+f.role}).success(function(a){b.treeRoleOptions.dataSource=new kendo.data.HierarchicalDataSource({data:a,schema:{model:{children:"items"}}})})}})}),b.toolbarOptions={items:[{type:"button",id:"confirmUpdateMenusBtn",text:a.confirmLabel,click:j}]};var l="";b.checkedNodeIds=function(a,c,d){for(var e=0;e<c.length;e++){if(c[e].checked&&(d.push(c[e].id),null!=a)){for(var f=!1,g=0;g<d.length;g++)if(d[g]===a.id){f=!0;break}f||d.push(a.id)}c[e].hasChildren&&b.checkedNodeIds(c[e],c[e].children.view(),d)}},b.checkboxes={checkChildren:!0},b.onCheck=function(){var a=[],c=b.tree;b.checkedNodeIds(null,c.dataSource.view(),a),l=a.length>0?a.join(","):""},b.click=function(a){},b.dataSource_error=function(b){i.alertmsg(b,a.errorMessages)},b.dataSource=new kendo.data.DataSource({batch:!0,transport:{read:{url:a.serviceRoot+"/role/read",dataType:"json",type:"POST",contentType:"application/json"},update:{url:a.serviceRoot+"/role/update",dataType:"json",type:"POST",contentType:"application/json"},create:{url:a.serviceRoot+"/role/create",dataType:"json",type:"POST",contentType:"application/json"},destroy:{url:a.serviceRoot+"/role/destroy",dataType:"json",type:"POST",contentType:"application/json"},parameterMap:function(a,b){return"read"!==b&&a.models?JSON.stringify(a.models[0]):void 0}},pageSize:20,schema:{model:{id:"id",fields:{id:{from:"id",type:"number"},role:{from:"role",validation:{required:!0}},roleDesc:{from:"roleDesc",validation:{required:!0}},lastUpdateDate:{type:"date",from:"lastUpdateDate"}}}}}),b.dataSource.bind("error",b.dataSource_error)}]),angular.module("angulardemoApp").config(["$stateProvider",function(a){a.state("rolepage",{views:{roletab:{url:"/rolepage",templateUrl:"/BookingSystem/app/rolepage/rolepage.html",controller:"RolepageCtrl"}},sticky:!0})}]),angular.module("angulardemoApp").controller("ScheduledemoCtrl",["$scope","$http","$rootScope","$window","$timeout","$q","prompt2","checkUserService",function(a,b,c,d,e,f,g,h){function i(a,b,c,d,e){var f=$("#scheduler").getKendoScheduler(),g=f.occurrencesInRange(a,b),h=g.indexOf(d);return h>-1&&g.splice(h,1),d=$.extend({},d,e),j(g,c,d[c])}function j(b,c,d){for(var e,f=[],g=!1,h=0;h<a.schedulerOptions_resourceDS.length;h++){var i=a.schedulerOptions_resourceDS[h];if(i.value==d){g=i.overlap;break}}if(g)return[];for(var j=0,k=b.length;k>j;j++)e=b[j],e[c]===d&&f.push(e);return f}function k(a,b,c,d){var e=i(a,b,"itemId",c,d);return e.length>0?!0:!1}function l(b,c,d,e){return b.getTime()<a.schedulerOptions_date.getTime()?!0:!1}function m(b,c,d,e){if(p.length>0&&"undefined"!=typeof d){console.log("none-workhour"),console.log(d);for(var f=!0,g=moment(c),h=moment(b);h.isBefore(g);h=h.add(a.schedulerDateInterval,"minute")){for(var i=!1,j=0;j<p.length;j++){var k=p[j];k.itemId==d.itemId&&(console.log("slotStart="+h),console.log("moment(tempTime.startTime)="+moment(k.startTime)),(h.isSame(moment(k.startTime))||h.isBetween(moment(k.startTime),moment(k.endTime)))&&(i=!0))}if(!i){f=!1;break}}if(!f)return!0}return!1}function n(a,b,c,d){return l(a,b,c,d)?(setTimeout(function(){alert("Book is expired.")},0),!1):k(a,b,c,d)?(setTimeout(function(){alert("Book is overlap in this time period.")},0),!1):m(a,b,c,d)?(setTimeout(function(){alert("Book is not available in none-workhour time period.")},0),!1):!0}var o=angular.element(d);e(function(){o.triggerHandler("resize")}),a.schedulerDateInterval=10,a.resetBackground=!0,a.firstClinic=1;var p=[];b({method:"POST",url:c.serviceRoot+"/booking/clinics"}).success(function(d){console.log(d),a.firstClinic=d[0].id,console.log("$scope.firstClinic="+a.firstClinic),a.clinicsOptions={dataSource:d,dataTextField:"clinicName",dataValueField:"id"},b({method:"POST",url:c.serviceRoot+"/booking/schedulerParas/"+d[0].id}).success(function(d){console.log("rootScope.windowHeight="+c.windowHeight),a.schedulerOptions_allDaySlot=d.allDaySlot,a.schedulerOptions_allDaySlotviews=d.views,a.schedulerOptions_date=new Date(d.date),a.schedulerOptions_startTime=new Date(d.startTime),a.schedulerOptions_endTime=new Date(d.endTime),a.schedulerOptions_majorTick=d.majorTick,a.schedulerOptions_minorTickCount=d.minorTickCount,a.schedulerOptions_mobile=d.mobile,a.schedulerOptions_footer=d.footer,a.schedulerOptions_resourceDS=d.resourceDs,a.readDate=new Date(d.date),console.log("$scope.readDate 1="+a.readDate),a.schedulerOptions_height=c.windowHeight-30-10,a.readView="day",a.editable=!0,a.schedulerDateInterval=a.schedulerOptions_majorTick/a.schedulerOptions_minorTickCount,a.myGrid.dataSource.read(),a.schedulerOptions={editable:{confirmation:a.editable,create:a.editable,destroy:a.editable,move:a.editable,resize:a.editable,template:$("#customEditorTemplate").html()},date:a.schedulerOptions_date,startTime:a.schedulerOptions_startTime,endTime:a.schedulerOptions_endTime,height:a.schedulerOptions_height,allDaySlot:a.schedulerOptions_allDaySlot,majorTick:a.schedulerOptions_majorTick,minorTickCount:a.schedulerOptions_minorTickCount,mobile:a.schedulerOptions_mobile,footer:a.schedulerOptions_footer,views:a.schedulerOptions_allDaySlotviews,timezone:"Etc/UTC",dataSource:{batch:!0,transport:{read:{url:c.serviceRoot+"/booking/read",dataType:"json",type:"POST",contentType:"application/json"},update:{url:c.serviceRoot+"/booking/update",dataType:"json",type:"POST",contentType:"application/json"},create:{url:c.serviceRoot+"/booking/create",dataType:"json",type:"POST",contentType:"application/json"},destroy:{url:c.serviceRoot+"/booking/destroy",dataType:"json",type:"POST",contentType:"application/json"},parameterMap:function(b,c){if("read"!==c&&b.models)return JSON.stringify(b.models);if("read"===c){$("#scheduler").data("kendoScheduler");console.log("read...");var d={start:moment(a.readDate).format("YYYY-MM-DDTHH:mm:ss.sss")+"Z",view:a.readView,clinicId:$("#clinics").val()},e=[d];return null!==d.clinicId?(console.log("reload....."),console.log(JSON.stringify(e)),JSON.stringify(e)):JSON.stringify([])}}},schema:{model:{id:"taskId",fields:{taskId:{from:"taskId",type:"number"},title:{from:"title",defaultValue:"Occupied",validation:{required:!0}},start:{type:"date",from:"start",validation:{required:!0}},end:{type:"date",from:"end",validation:{required:!0}},description:{from:"description"},itemId:{from:"itemId",type:"number",validation:{required:!0}},clinicId:{from:"clinicId",type:"number",validation:{required:!0}},isAllDay:{type:"boolean",from:"isAllDay"},bookStatus:{from:"bookStatus"},clientIp:{from:"clientIp"},md5Password:{from:"md5Password",validation:{required:!0}}}}}},group:{resources:["Rooms"],orientation:"horizontal"},resources:[{field:"itemId",name:"Rooms",dataSource:a.schedulerOptions_resourceDS,title:"Item"}],resize:function(a){(l(a.start,a.end,a.event,a.resources)||k(a.start,a.end,a.event,a.resources)||m(a.start,a.end,a.event,a.resources))&&(this.wrapper.find(".k-marquee-color").addClass("invalid-slot"),a.preventDefault())},resizeEnd:function(a){n(a.start,a.end,a.events)||a.preventDefault()},move:function(a){(l(a.start,a.end,a.event,a.resources)||k(a.start,a.end,a.event,a.resources)||m(a.start,a.end,a.event,a.resources))&&this.wrapper.find(".k-event-drag-hint").addClass("invalid-slot")},moveEnd:function(a){n(a.start,a.end,a.event,a.resources)||a.preventDefault()},add:function(a){n(a.event.start,a.event.end,a.event)||a.preventDefault()},save:function(d){if(n(d.event.start,d.event.end,d.event)){d.preventDefault();var e="";if(e=d.event.isNew()?"/booking/create":"/booking/update",""!==d.event.md5Password&&null!==d.event.md5Password){var f=[d.event];b({method:"POST",url:c.serviceRoot+e,data:JSON.stringify(f)}).then(function(b){console.log(b),a.bookScheduler.dataSource.read(),0==b.data.length&&g({title:"Password Dialog",message:"Invalid password"})},function(a){console.log(" save..failure")})}else{var i=g({title:"Password Dialog",message:"",input:!0,label:"Please input your password:",value:"",buttons:[{label:"Cancel",cancel:!0,primary:!1},{label:"Confirm",cancel:!1,primary:!1}]});i.then(function(e){var f=h.query(c.serviceRoot,e);f.then(function(f){if(f){d.event.set("md5Password",e);var h=[d.event];b({method:"POST",url:c.serviceRoot+"/booking/update",data:JSON.stringify(h)}).then(function(b){a.bookScheduler.dataSource.read()},function(a){console.log(" save..failure")})}else d.preventDefault(),g({title:"Password Dialog",message:"Invalid password"})})})}}else d.preventDefault()},remove:function(d){if(n(d.event.start,d.event.end,d.event)){d.preventDefault();var e=g({title:"Password Dialog",message:"",input:!0,label:"Please input your password:",value:"",buttons:[{label:"Cancel",cancel:!0,primary:!1},{label:"Confirm",cancel:!1,primary:!1}]});e.then(function(e){var f=h.query(c.serviceRoot,e);f.then(function(e){if(e){var f=[d.event];b({method:"POST",url:c.serviceRoot+"/booking/destroy",data:JSON.stringify(f)}).then(function(b){a.bookScheduler.dataSource.read()},function(a){console.log(" save..failure")})}else d.preventDefault(),alert("invalid password")})})}else d.preventDefault()},edit:function(d){var e=d.sender.element.find('div.k-event[data-uid="'+d.event.uid+'"]'),f=a.bookScheduler.slotByElement(e);f.element;if($(f.element).hasClass("k-nonwork-hour"))d.preventDefault();else{d.event.set("clinicId",parseInt($("#clinics").val()));var g=$("#scheduler").data("kendoScheduler");if(g.cancelEvent(),d.event.isNew()){d.event.set("bookStatus","occupied");var h=[d.event];b({method:"POST",url:c.serviceRoot+"/booking/create",data:JSON.stringify(h)}).then(function(b){a.bookScheduler.dataSource.read(),a.myGrid.dataSource.read()},function(a){console.log(" save..failure")})}}},navigate:function(b){"month"==b.view&&console.log("month view"),("day"==b.view||"week"==b.view)&&(a.resetBackground=!0),a.readDate=b.date,a.readView=b.view,a.bookScheduler.dataSource.read(),a.myGrid.dataSource.read()},dataBound:function(d){if(a.resetBackground){var e=this;kendo.ui.progress($("#scheduler"),!0),p=[],b({method:"GET",url:c.serviceRoot+"/booking/schedulerNoneWorkHours/"+this.view().name+"/"+this.date()+"/"+$("#clinics").val()}).success(function(b){a.schedulerNoneWorkHours=b;for(var c=e.view().element,d=c.find("td[role=gridcell]"),f=0;f<d.length;f++){var g=$(d[f]);g.hasClass("k-nonwork-hour")||g.addClass("k-nonwork-hour"),g.hasClass("k-today")&&g.removeClass("k-today")}for(var f=0;f<d.length;f++){var g=$(d[f]);if(null!=e){var h=e.slotByElement(g),i=(h.startDate.getHours(),h.endDate.getHours(),a.schedulerOptions_resourceDS.length),j=0;if("week"==e.view().name){for(var k=0;i>k;k++)if(g.context.cellIndex-7*k<=0){j=k;break}}else j=g.context.cellIndex;for(var l=a.schedulerOptions_resourceDS[j].value,m=0;m<a.schedulerNoneWorkHours.length;m++){var n=a.schedulerNoneWorkHours[m],o=new Date(n.startTime),q=new Date(n.endTime);if(l==n.itemId&&h.endDate.getYear()==o.getYear()&&h.endDate.getMonth()==o.getMonth()&&h.endDate.getDate()==o.getDate()){if(n.isHoliday){g.hasClass("k-nonwork-hour")||g.addClass("k-nonwork-hour");break}if(h.startDate.getTime()>=o.getTime()&&h.endDate.getTime()<=q.getTime()){g.hasClass("k-nonwork-hour")&&g.removeClass("k-nonwork-hour");var r=new Object;r.startTime=o,r.endTime=q,r.itemId=n.itemId,r.clinicId=n.clinicId,p.push(r);break}}}}}a.resetBackground=!1,kendo.ui.progress($("#scheduler"),!1)}).error(function(a){console.log(a)})}}}}),a.dataSource=new kendo.data.DataSource({batch:!0,transport:{read:{url:c.serviceRoot+"/booking/read",dataType:"json",type:"POST",contentType:"application/json"},update:{url:c.serviceRoot+"/booking/update",dataType:"json",type:"POST",contentType:"application/json"},create:{url:c.serviceRoot+"/booking/create",dataType:"json",type:"POST",contentType:"application/json"},destroy:{url:c.serviceRoot+"/booking/destroy",dataType:"json",type:"POST",contentType:"application/json"},parameterMap:function(b,c){if("read"!==c&&b.models)return JSON.stringify(b.models);if("read"===c){var d={start:moment(a.readDate).format("YYYY-MM-DDTHH:mm:ss.sss")+"Z",view:null==a.readView?"day":a.readView,clinicId:null==$("#clinics").val()?a.firstClinic:$("#clinics").val()},e=[d];return console.log("grid models:"),console.log(e),JSON.stringify(e)}}},pageSize:20,schema:{model:{id:"taskId",fields:{taskId:{from:"taskId",type:"number"},title:{from:"title",defaultValue:"No title",validation:{required:!0}},start:{type:"date",from:"start",validation:{required:!0}},end:{type:"date",from:"end",validation:{required:!0}},description:{from:"description"},itemId:{from:"itemId",type:"number",validation:{required:!0}},clinicId:{from:"clinicId",type:"number",validation:{required:!0}},isAllDay:{type:"boolean",from:"isAllDay"},lastUpdateDate:{type:"date",from:"lastUpdateDate"}}}}}),a.mainGridOptions={language:"zh-HK",dataSource:a.dataSource,sortable:!0,selectable:!0,pageable:{refresh:!0,pageSizes:!0,buttonCount:5},filterable:!0,editable:{mode:"popup",template:kendo.template($("#customEditorTemplate").html())},columnMenu:!0,groupable:!0,reorderable:!0,resizable:!0,toolbar:["create",{name:"customEdit",text:"Edit",imageClass:"k-edit",className:"k-custom-edit",iconClass:"k-icon"}],edit:function(a){a.model.isNew()||(console.log("grid eidt....."),a.model.set("start",new Date(a.model.start.getTime()+6e4*a.model.start.getTimezoneOffset())),a.model.set("end",new Date(a.model.end.getTime()+6e4*a.model.end.getTimezoneOffset())))},remove:function(a){console.log("Removing",a.model.title)},save:function(d){if(console.log("saved",d.model.title),console.log(d),a.myGrid.cancelChanges(),""!==d.model.md5Password&&null!==d.model.md5Password){var e=[d.model];b({method:"POST",url:c.serviceRoot+"/booking/update",data:JSON.stringify(e)}).then(function(b){console.log(b),a.myGrid.dataSource.read(),a.bookScheduler.dataSource.read(),0==b.data.length&&g({title:"Password Dialog",message:"Invalid password"})},function(a){console.log(" save..failure")})}},saveChanges:function(a){confirm("Are you sure you want to save all changes?")||a.preventDefault()},columns:[{field:"lastUpdateDate",title:"Update Date",template:'#= kendo.toString(new Date(data.lastUpdateDate.getTime() + data.lastUpdateDate.getTimezoneOffset()*60000), "'+c.appParameters.appDateTimeFormat+'") #'},{field:"title",title:"Title"},{field:"itemId",title:"Item"},{field:"start",title:"Start",template:'#= kendo.toString(new Date(data.start.getTime() + data.start.getTimezoneOffset()*60000), "'+c.appParameters.appDateTimeFormat+'") #'},{field:"end",title:"End",template:'#= kendo.toString(new Date(data.end.getTime() + data.end.getTimezoneOffset()*60000), "'+c.appParameters.appDateTimeFormat+'") #'}]},a.$on("kendoWidgetCreated",function(b,c){c===a.myGrid&&c.element.find(".k-custom-edit").on("click",function(b){b.preventDefault();var c=a.myGrid.select();0==c.length?alert("No record selected"):a.myGrid.editRow(c)})})}),a.cancelSave=function(){a.win1.close()},a.showInfo=function(b,c){a.schedulerNotif.show(b,c)}}]).factory("checkUserService",["$http","$q",function(a,b,c){return{query:function(c,d){var e=b.defer();return a({method:"POST",url:c+"/booking/validateUser/"+d}).success(function(a){e.resolve(a)}).error(function(a){e.reject(a)}),e.promise}}}]),angular.module("angulardemoApp").controller("ScheduledemoCtrl",["$scope","$http","$rootScope","$window","$timeout","$q","prompt2","checkUserService","$translate",function(a,b,c,d,e,f,g,h,i){function j(a,b,c,d,e){var f=$("#scheduler").getKendoScheduler(),g=f.occurrencesInRange(a,b),h=g.indexOf(d);return h>-1&&g.splice(h,1),d=$.extend({},d,e),k(g,c,d[c])}function k(b,c,d){for(var e,f=[],g=!1,h=0;h<a.schedulerOptions_resourceDS.length;h++){var i=a.schedulerOptions_resourceDS[h];if(i.value==d){g=i.overlap;break}}if(g)return[];for(var j=0,k=b.length;k>j;j++)e=b[j],e[c]===d&&f.push(e);return f}function l(a,b,c,d){var e=j(a,b,"itemId",c,d);return e.length>0?!0:!1}function m(b,c,d,e){return b.getTime()<a.schedulerOptions_date.getTime()?!0:!1}function n(b,c,d,e){if(q.length>0&&"undefined"!=typeof d){for(var f=!0,g=moment(c),h=moment(b);h.isBefore(g);h=h.add(a.schedulerDateInterval,"minute")){for(var i=!1,j=0;j<q.length;j++){var k=q[j];k.itemId==d.itemId&&(h.isSame(moment(k.startTime))||h.isBetween(moment(k.startTime),moment(k.endTime)))&&(i=!0)}if(!i){f=!1;break}}if(!f)return!0}return!1}function o(b,c,d,e){return m(b,c,d,e)?(setTimeout(function(){g({title:a.exceptionDialog,message:a.BookExpired,buttons:[{label:a.confirmLabel,cancel:!0,primary:!1}]})},0),!1):l(b,c,d,e)?(setTimeout(function(){g({title:a.exceptionDialog,message:a.OccupiedMore,buttons:[{label:a.confirmLabel,cancel:!0,primary:!1}]})},0),!1):n(b,c,d,e)?(setTimeout(function(){g({title:a.exceptionDialog,message:a.BookUnavailabel,buttons:[{label:a.confirmLabel,cancel:!0,primary:!1}]})},0),!1):!0}var p=angular.element(d);e(function(){p.triggerHandler("resize")}),i(["Edit","Delete","Move","Copy","Cancel","Confirm","Retry","PasswordDialog","InvalidPassword","EnterPasswordTip","ExceptionDialog","OccupiedMore","BookGridTitle","BookGridItem","BookGridStart","NoRecordSelected","DeleteWarning","MoveWaning","CopyWarning","BookExpired","BookOverlap","BookUnavailabel","BookDeleteItem"]).then(function(b){a.editLabel=b.Edit,a.deleteLabel=b.Delete,a.moveLabel=b.Move,a.copyLabel=b.Copy,a.passwordDialog=b.PasswordDialog,a.invalidPassword=b.InvalidPassword,a.enterPasswordTip=b.EnterPasswordTip,a.exceptionDialog=b.ExceptionDialog,a.cancelLabel=b.Cancel,a.confirmLabel=b.Confirm,a.retry=b.Retry,a.occupiedMore=b.OccupiedMore,a.BookGridTitle=b.BookGridTitle,a.BookGridItem=b.BookGridItem,a.BookGridStart=b.BookGridStart,a.NoRecordSelected=b.NoRecordSelected,a.DeleteWarning=b.DeleteWarning,a.MoveWaning=b.MoveWaning,a.CopyWarning=b.CopyWarning,a.BookUnavailabel=b.BookUnavailabel,a.BookExpired=b.BookExpired,a.BookOverlap=b.BookOverlap,a.BookDeleteItem=b.BookDeleteItem}),a.schedulerDateInterval=10,a.resetBackground=!0,a.firstClinic=1,a.cancelCopyVisible=!1,a.cancelMoveVisible=!1,a.disableGridToolbar=!1,a.selectedData=null;var q=[];b({method:"POST",url:c.serviceRoot+"/booking/clinics"}).success(function(d){a.firstClinic=d[0].id,a.clinicsOptions={dataSource:d,dataTextField:"clinicName",dataValueField:"id"},b({method:"POST",url:c.serviceRoot+"/booking/schedulerParas/"+d[0].id}).success(function(d){a.schedulerOptions_allDaySlot=d.allDaySlot,a.schedulerOptions_allDaySlotviews=d.views,a.schedulerOptions_date=new Date(d.date),a.schedulerOptions_startTime=new Date(d.startTime),a.schedulerOptions_endTime=new Date(d.endTime),a.schedulerOptions_majorTick=d.majorTick,a.schedulerOptions_minorTickCount=d.minorTickCount,a.schedulerOptions_mobile=d.mobile,a.schedulerOptions_footer=d.footer,a.schedulerOptions_resourceDS=d.resourceDs,a.readDate=new Date(d.date),a.schedulerOptions_height=c.windowHeight-30-10,a.readView="day",a.editable=!0,a.schedulerDateInterval=a.schedulerOptions_majorTick/a.schedulerOptions_minorTickCount,a.bookGrid.dataSource.read(),a.schedulerOptions={editable:{confirmation:a.BookDeleteItem,create:a.editable,destroy:a.editable,move:a.editable,resize:a.editable,template:$("#customEditorTemplate").html()},date:a.schedulerOptions_date,startTime:a.schedulerOptions_startTime,endTime:a.schedulerOptions_endTime,height:a.schedulerOptions_height,allDaySlot:a.schedulerOptions_allDaySlot,majorTick:a.schedulerOptions_majorTick,minorTickCount:a.schedulerOptions_minorTickCount,mobile:a.schedulerOptions_mobile,footer:a.schedulerOptions_footer,views:a.schedulerOptions_allDaySlotviews,timezone:"Etc/UTC",dataSource:{batch:!0,transport:{read:{url:c.serviceRoot+"/booking/read/scheduler",dataType:"json",type:"POST",contentType:"application/json"},update:{url:c.serviceRoot+"/booking/update",dataType:"json",type:"POST",contentType:"application/json"},create:{url:c.serviceRoot+"/booking/create",dataType:"json",
type:"POST",contentType:"application/json"},destroy:{url:c.serviceRoot+"/booking/destroy",dataType:"json",type:"POST",contentType:"application/json"},parameterMap:function(b,c){if("read"!==c&&b.models)return JSON.stringify(b.models);if("read"===c){$("#scheduler").data("kendoScheduler");console.log("read...");var d={start:moment(a.readDate).format("YYYY-MM-DDTHH:mm:ss.sss")+"Z",view:a.readView,clinicId:$("#clinics").val()},e=[d];return null!==d.clinicId?(console.log("reload....."),console.log(JSON.stringify(e)),JSON.stringify(e)):JSON.stringify([])}}},schema:{model:{id:"taskId",fields:{taskId:{from:"taskId",type:"number"},title:{from:"title",defaultValue:"Occupied",validation:{required:!0}},start:{type:"date",from:"start",validation:{required:!0}},end:{type:"date",from:"end",validation:{required:!0}},description:{from:"description"},itemId:{from:"itemId",type:"number",validation:{required:!0}},clinicId:{from:"clinicId",type:"number",validation:{required:!0}},isAllDay:{type:"boolean",from:"isAllDay"},bookStatus:{from:"bookStatus"},clientIp:{from:"clientIp"},md5Password:{from:"md5Password",validation:{required:!0}}}}}},group:{resources:["Rooms"],orientation:"horizontal"},resources:[{field:"itemId",name:"Rooms",dataSource:a.schedulerOptions_resourceDS,title:"Item"}],resize:function(a){(m(a.start,a.end,a.event,a.resources)||l(a.start,a.end,a.event,a.resources)||n(a.start,a.end,a.event,a.resources))&&(this.wrapper.find(".k-marquee-color").addClass("invalid-slot"),a.preventDefault())},resizeEnd:function(a){o(a.start,a.end,a.events)?(console.log("resize end:"),console.log(a.event)):a.preventDefault()},move:function(a){(m(a.start,a.end,a.event,a.resources)||l(a.start,a.end,a.event,a.resources)||n(a.start,a.end,a.event,a.resources))&&this.wrapper.find(".k-event-drag-hint").addClass("invalid-slot")},moveEnd:function(a){o(a.start,a.end,a.event,a.resources)?(console.log("move end:"),console.log(a.event)):a.preventDefault()},add:function(a){o(a.event.start,a.event.end,a.event)||a.preventDefault()},save:function(d){if(o(d.event.start,d.event.end,d.event)){d.preventDefault();var e="";if(e=d.event.isNew()?"/booking/create":"/booking/update",""!==d.event.md5Password&&null!==d.event.md5Password){var f=[d.event];b({method:"POST",url:c.serviceRoot+e,data:JSON.stringify(f)}).then(function(b){a.bookScheduler.dataSource.read(),a.bookGrid.dataSource.read(),0==b.data.length},function(b){g({title:a.exceptionDialog,message:"Failed to do!",buttons:[{label:a.confirmLabel,cancel:!0,primary:!1}]})})}else{var i=g({title:a.passwordDialog,message:"",input:!0,inputtype:"password",label:a.enterPasswordTip,value:"",buttons:[{label:a.cancelLabel,cancel:!0,primary:!1},{label:a.confirmLabel,cancel:!1,primary:!1}]});i.then(function(e){var f=h.query(c.serviceRoot,e);f.then(function(f){if(f){d.event.set("md5Password",e);var h=[d.event];b({method:"POST",url:c.serviceRoot+"/booking/update",data:JSON.stringify(h)}).then(function(b){a.bookScheduler.dataSource.read(),a.bookGrid.dataSource.read()},function(b){g({title:a.exceptionDialog,message:"Failed to handle!",buttons:[{label:a.confirmLabel,cancel:!0,primary:!1}]})})}else{g({title:a.passwordDialog,message:a.invalidPassword,buttons:[{label:a.confirmLabel,cancel:!0,primary:!1}]})}})})}}else d.preventDefault()},remove:function(d){if(o(d.event.start,d.event.end,d.event)){d.preventDefault();var e=g({title:a.passwordDialog,message:"",input:!0,inputtype:"password",label:a.enterPasswordTip,value:"",buttons:[{label:a.cancelLabel,cancel:!0,primary:!1},{label:a.confirmLabel,cancel:!1,primary:!1}]});e.then(function(e){var f=h.query(c.serviceRoot,e);f.then(function(e){if(e){var f=[d.event];b({method:"POST",url:c.serviceRoot+"/booking/destroy",data:JSON.stringify(f)}).then(function(b){a.bookScheduler.dataSource.read(),a.bookGrid.dataSource.read()},function(b){g({title:a.exceptionDialog,message:"Failed to handle!",buttons:[{label:a.confirmLabel,cancel:!0,primary:!1}]})})}else{var h=g({title:a.passwordDialog,message:a.invalidPassword,buttons:[{label:a.confirmLabel,cancel:!0,primary:!1},{label:a.retry,cancel:!1,primary:!1}]});h.then(function(){a.bookScheduler.removeEvent(d.event)})}})})}else d.preventDefault()},edit:function(d){var e=d.sender.element.find('div.k-event[data-uid="'+d.event.uid+'"]'),f=a.bookScheduler.slotByElement(e);f.element;if($(f.element).hasClass("k-nonwork-hour"))d.preventDefault();else{d.event.set("clinicId",parseInt($("#clinics").val()));var h=$("#scheduler").data("kendoScheduler");if(h.cancelEvent(),d.event.isNew())if(a.disableGridToolbar&&a.cancelMoveVisible){d.preventDefault(),a.selectedData.set("clinicId",parseInt($("#clinics").val())),a.selectedData.set("start",d.event.start),a.selectedData.set("end",d.event.end),a.selectedData.set("itemId",d.event.itemId),console.log("move data:");var i=[a.selectedData];b({method:"POST",url:c.serviceRoot+"/booking/update",data:JSON.stringify(i)}).then(function(b){a.bookScheduler.dataSource.read(),a.bookGrid.dataSource.read(),a.enableToolbar()},function(b){g({title:a.exceptionDialog,message:"Failed to handle!",buttons:[{label:a.confirmLabel,cancel:!0,primary:!1}]})})}else if(a.disableGridToolbar&&a.cancelCopyVisible){d.preventDefault(),a.selectedData.set("clinicId",parseInt($("#clinics").val())),a.selectedData.set("start",d.event.start),a.selectedData.set("end",d.event.end),a.selectedData.set("itemId",d.event.itemId),a.selectedData.set("taskId",null);var i=[a.selectedData];b({method:"POST",url:c.serviceRoot+"/booking/create",data:JSON.stringify(i)}).then(function(b){a.bookScheduler.dataSource.read(),a.bookGrid.dataSource.read(),a.enableToolbar()},function(b){g({title:a.exceptionDialog,message:"Failed to handle!",buttons:[{label:a.confirmLabel,cancel:!0,primary:!1}]})})}else{for(var j=!1,k=0;k<a.bookGrid.dataSource.data().length;k++){var l=a.bookGrid.dataSource.data()[k];if("occupied"===l.bookStatus){j=!0;break}}if(j)d.preventDefault(),g({title:a.exceptionDialog,message:a.occupiedMore,buttons:[{label:a.confirmLabel,cancel:!0,primary:!1}]});else{d.event.set("bookStatus","occupied");var i=[d.event];b({method:"POST",url:c.serviceRoot+"/booking/create",data:JSON.stringify(i)}).then(function(b){a.bookScheduler.dataSource.read(),a.bookGrid.dataSource.read()},function(b){g({title:a.exceptionDialog,message:"Failed to handle!"})})}}}},navigate:function(b){"month"==b.view&&console.log("month view"),("day"==b.view||"week"==b.view)&&(a.resetBackground=!0),a.readDate=b.date,a.readView=b.view,a.bookScheduler.dataSource.read(),a.bookGrid.dataSource.read()},dataBound:function(d){if(a.resetBackground){var e=this;kendo.ui.progress($("#scheduler"),!0),q=[],b({method:"GET",url:c.serviceRoot+"/booking/schedulerNoneWorkHours/"+this.view().name+"/"+this.date()+"/"+$("#clinics").val()}).success(function(b){a.schedulerNoneWorkHours=b;for(var c=e.view().element,d=c.find("td[role=gridcell]"),f=0;f<d.length;f++){var g=$(d[f]);g.hasClass("k-nonwork-hour")||g.addClass("k-nonwork-hour"),g.hasClass("k-today")&&g.removeClass("k-today")}for(var f=0;f<d.length;f++){var g=$(d[f]);if(null!=e){var h=e.slotByElement(g),i=(h.startDate.getHours(),h.endDate.getHours(),a.schedulerOptions_resourceDS.length),j=0;if("week"==e.view().name){for(var k=0;i>k;k++)if(g.context.cellIndex-7*k<=0){j=k;break}}else j=g.context.cellIndex;for(var l=a.schedulerOptions_resourceDS[j].value,m=0;m<a.schedulerNoneWorkHours.length;m++){var n=a.schedulerNoneWorkHours[m],o=new Date(n.startTime),p=new Date(n.endTime);if(l==n.itemId&&h.endDate.getYear()==o.getYear()&&h.endDate.getMonth()==o.getMonth()&&h.endDate.getDate()==o.getDate()){if(n.isHoliday){g.hasClass("k-nonwork-hour")||g.addClass("k-nonwork-hour");break}if(h.startDate.getTime()>=o.getTime()&&h.endDate.getTime()<=p.getTime()){if(h.startDate.getMinutes()%n.sectionTime===0){g.hasClass("k-nonwork-hour")&&g.removeClass("k-nonwork-hour");var r=new Object;r.startTime=o,r.endTime=p,r.itemId=n.itemId,r.clinicId=n.clinicId,q.push(r)}break}}}}}a.resetBackground=!1,kendo.ui.progress($("#scheduler"),!1)}).error(function(a){console.log(a)})}}}}),a.dataSource=new kendo.data.DataSource({batch:!0,transport:{read:{url:c.serviceRoot+"/booking/read/grid",dataType:"json",type:"POST",contentType:"application/json"},update:{url:c.serviceRoot+"/booking/update",dataType:"json",type:"POST",contentType:"application/json"},create:{url:c.serviceRoot+"/booking/create",dataType:"json",type:"POST",contentType:"application/json"},destroy:{url:c.serviceRoot+"/booking/destroy",dataType:"json",type:"POST",contentType:"application/json"},parameterMap:function(b,c){if("read"!==c&&b.models)return JSON.stringify(b.models);if("read"===c){var d={start:moment(a.readDate).format("YYYY-MM-DDTHH:mm:ss.sss")+"Z",view:null==a.readView?"day":a.readView,clinicId:null==$("#clinics").val()?a.firstClinic:$("#clinics").val()},e=[d];return JSON.stringify(e)}}},pageSize:20,schema:{model:{id:"taskId",fields:{taskId:{from:"taskId",type:"number"},title:{from:"title",defaultValue:"No title",validation:{required:!0}},start:{type:"date",from:"start",validation:{required:!0}},end:{type:"date",from:"end",validation:{required:!0}},description:{from:"description"},itemId:{from:"itemId",type:"number",validation:{required:!0}},clinicId:{from:"clinicId",type:"number",validation:{required:!0}},isAllDay:{type:"boolean",from:"isAllDay"},lastUpdateDate:{type:"date",from:"lastUpdateDate"}}}}});var e={};a.mainGridOptions={dataSource:a.dataSource,sortable:!0,selectable:!0,pageable:{refresh:!0,pageSizes:!0},filterable:!0,editable:{mode:"popup",template:kendo.template($("#customEditorTemplate").html())},columnMenu:!0,groupable:!0,reorderable:!0,resizable:!0,toolbar:$("#gridToolbarTemplate").html(),edit:function(a){!a.model.isNew()},remove:function(a){},save:function(d){if(d.preventDefault(),""!==d.model.md5Password&&null!==d.model.md5Password){var e=[d.model];b({method:"POST",url:c.serviceRoot+"/booking/update",data:JSON.stringify(e)}).then(function(b){if(console.log(b),a.bookGrid.dataSource.read(),a.bookScheduler.dataSource.read(),0==b.data.length){var c=g({title:a.passwordDialog,message:a.invalidPassword,buttons:[{label:a.confirmLabel,cancel:!0,primary:!1},{label:a.retry,cancel:!1,primary:!1}]});c.then(function(){a.editBook()})}},function(b){g({title:a.exceptionDialog,message:"Failed to handle!",buttons:[{label:a.confirmLabel,cancel:!0,primary:!1}]})})}},change:function(b){e={};for(var c=a.bookGrid.dataSource.view(),d=this.select(),f=0;f<c.length;f++){var g=c[f].taskId;if(1==e[g]){for(var h=!1,i=0;i<d.length;i++){var j=a.bookGrid.dataItem(d[i]);if(j.taskId==g){h=!0;break}}h||(e[g]=!1)}}for(var f=0;f<d.length;f++)e[a.bookGrid.dataItem(d[f]).taskId]=!0},dataBound:function(b){for(var c=a.bookGrid.dataSource.view(),d=[],f=0;f<c.length;f++)e[c[f].taskId]&&d.push(a.bookGrid.tbody.find(">tr[data-uid='"+c[f].uid+"']"));a.bookGrid.select(d)},columns:[{field:"title",title:a.BookGridTitle,template:'#=(bookStatus==="occupied")?("<font color=red>"+title+"</font>"):title #'},{field:"itemId",title:a.BookGridItem},{field:"start",title:a.BookGridStart,format:"{0:"+c.appParameters.appDateTimeFormat+"}"}]},a.editContent=a.editLabel,a.delContent=a.deleteLabel,a.moveContent=a.moveLabel,a.copyContent=a.copyLabel,a.kposition="top",a.editBook=function(){if(!a.disableGridToolbar){a.gridEditTip.hide();var b=a.bookGrid.select();0==b.length?g({title:a.exceptionDialog,message:a.NoRecordSelected,buttons:[{label:a.confirmLabel,cancel:!0,primary:!1}]}):a.bookGrid.editRow(b)}},a.delBook=function(){if(!a.disableGridToolbar){a.gridDelTip.hide();var d=a.bookGrid.select();if(0==d.length)g({title:a.exceptionDialog,message:a.NoRecordSelected,buttons:[{label:a.confirmLabel,cancel:!0,primary:!1}]});else{var e=(a.bookGrid.dataItem(d),g({title:a.passwordDialog,message:a.DeleteWarning,input:!0,inputtype:"password",label:a.enterPasswordTip,value:"",buttons:[{label:a.cancelLabel,cancel:!0,primary:!1},{label:a.confirmLabel,cancel:!1,primary:!1}]}));e.then(function(e){var f=h.query(c.serviceRoot,e);f.then(function(e){if(e){var f=[a.bookGrid.dataItem(d)];b({method:"POST",url:c.serviceRoot+"/booking/destroy",data:JSON.stringify(f)}).then(function(b){a.bookScheduler.dataSource.read(),a.bookGrid.dataSource.read()},function(a){console.log(" save..failure")})}else{var h=g({title:a.passwordDialog,message:a.invalidPassword,buttons:[{label:a.confirmLabel,cancel:!0,primary:!1},{label:a.retry,cancel:!1,primary:!1}]});h.then(function(){a.delBook()})}})})}}},a.moveBook=function(){if(!a.disableGridToolbar){a.gridMoveTip.hide();var b=a.bookGrid.select();if(0==b.length)g({title:a.exceptionDialog,message:a.NoRecordSelected,buttons:[{label:a.confirmLabel,cancel:!0,primary:!1}]});else{var d=g({title:a.passwordDialog,message:a.MoveWaning,input:!0,inputtype:"password",label:a.enterPasswordTip,value:"",buttons:[{label:a.cancelLabel,cancel:!0,primary:!1},{label:a.confirmLabel,cancel:!1,primary:!1}]});d.then(function(d){var e=h.query(c.serviceRoot,d);e.then(function(c){if(c)a.selectedData=a.bookGrid.dataItem(b),a.selectedData.md5Password=d,a.disableToolbar("move");else{var e=g({title:a.passwordDialog,message:a.invalidPassword,buttons:[{label:a.confirmLabel,cancel:!0,primary:!1},{label:a.retry,cancel:!1,primary:!1}]});e.then(function(){a.moveBook()})}})})}}},a.copyBook=function(){if(!a.disableGridToolbar){a.gridCopyTip.hide();var b=a.bookGrid.select();if(0==b.length)g({title:a.exceptionDialog,message:a.NoRecordSelected,buttons:[{label:a.confirmLabel,cancel:!0,primary:!1}]});else{var d=g({title:a.passwordDialog,message:a.CopyWarning,input:!0,inputtype:"password",label:a.enterPasswordTip,value:"",buttons:[{label:a.cancelLabel,cancel:!0,primary:!1},{label:a.confirmLabel,cancel:!1,primary:!1}]});d.then(function(d){var e=h.query(c.serviceRoot,d);e.then(function(c){if(c)a.selectedData=a.bookGrid.dataItem(b),a.selectedData.md5Password=d,a.disableToolbar("copy");else{var e=g({title:a.passwordDialog,message:a.invalidPassword,buttons:[{label:a.confirmLabel,cancel:!0,primary:!1},{label:a.retry,cancel:!1,primary:!1}]});e.then(function(){a.copyBook()})}})})}}}}),a.changeClinic=function(){a.bookGrid.dataSource.read(),a.bookScheduler.dataSource.read()},a.disableToolbar=function(b){$(".k-grid-toolbar").children(".k-button").addClass("k-state-disabled"),a.disableGridToolbar=!0,"move"===b?(a.cancelMoveVisible=!0,a.cancelCopyVisible=!1):"copy"===b&&(a.cancelMoveVisible=!1,a.cancelCopyVisible=!0)},a.enableToolbar=function(){$(".k-grid-toolbar").children(".k-button").removeClass("k-state-disabled"),a.cancelMoveVisible=!1,a.cancelCopyVisible=!1,a.disableGridToolbar=!1},a.cancelSave=function(){a.win1.close()},a.showInfo=function(b,c){a.schedulerNotif.show(b,c)},a.cancelMove=function(){a.enableToolbar()},a.cancelCopy=function(){$(".k-grid-toolbar").children(".k-button").removeClass("k-state-disabled"),a.cancelCopyVisible=!1,a.disableGridToolbar=!1}}]).factory("checkUserService",["$http","$q",function(a,b,c){return{query:function(c,d){var e=b.defer(),f=JSON.stringify({password:d});return a({method:"POST",url:c+"/booking/validateUser/",data:f}).success(function(a){e.resolve(a)}).error(function(a){e.reject(a)}),e.promise}}}]),angular.module("angulardemoApp").config(["$stateProvider",function(a){a.state("scheduledemo",{views:{mytab1:{url:"/scheduledemo",templateUrl:"/BookingSystem/app/scheduledemo/scheduledemo.html",controller:"ScheduledemoCtrl"}},sticky:!0})}]),angular.module("angulardemoApp").controller("TreedemoCtrl",["$scope",function(a){a.treeData=new kendo.data.HierarchicalDataSource({data:[{text:"Home",url:"index",spriteCssClass:"fa fa-sitemap"},{text:"Kendo UI",url:"xxx",expanded:!0,items:[{text:"Schedular Demo",url:"scheduledemo"},{text:"Grid Demo",url:"griddemo"}]},{text:"main",url:"main"}]}),a.toggle=function(a){var b=this.tree.dataItem(a.target);b.set("expanded",!b.expanded)}}]),angular.module("angulardemoApp").config(["$stateProvider",function(a){a.state("treedemo",{url:"/treedemo",templateUrl:"/BookingSystem/app/treedemo/treedemo.html",controller:"TreedemoCtrl"})}]),angular.module("angulardemoApp").factory("Modal",["$rootScope","$modal",function(a,b){function c(c,d){var e=a.$new();return c=c||{},d=d||"modal-default",angular.extend(e,c),b.open({templateUrl:"components/modal/modal.html",windowClass:d,scope:e})}return{confirm:{"delete":function(a){return a=a||angular.noop,function(){var b,d=Array.prototype.slice.call(arguments),e=d.shift();b=c({modal:{dismissable:!0,title:"Confirm Delete",html:"<p>Are you sure you want to delete <strong>"+e+"</strong> ?</p>",buttons:[{classes:"btn-danger",text:"Delete",click:function(a){b.close(a)}},{classes:"btn-default",text:"Cancel",click:function(a){b.dismiss(a)}}]}},"modal-danger"),b.result.then(function(b){a.apply(b,d)})}}}}}]),angular.module("angulardemoApp").controller("NavbarCtrl",["$scope","$location",function(a,b){a.menu=[{title:"Home",link:"/"}],a.isCollapsed=!0,a.isActive=function(a){return a===b.path()}}]),angular.module("angulardemoApp").run(["$templateCache",function(a){a.put("/BookingSystem/app/bookscheduler/bookscheduler.html",'\n\n    <!--<p translate="APP_NAME"></p>-->\n\n\n\n    <div  kendo-splitter="schedulerSplitter1"\n                     k-panes="[{collapsible: false,resizable: false, size: \'30px\'},{collapsible: false }]"\n                     k-orientation="\'vertical\'"  ng-style="style2()" resize2>\n                <div class="">\n                  <img src="/BookingSystem/assets/images/b3bc9e90.clinic-icon-48.png" height="30" width="30" style="padding-left:3px;">\n                  <select id="clinics"\n                          kendo-drop-down-list style="width: 100px;height:24px;"\n                          k-options="clinicsOptions" k-ng-delay="clinicsOptions.dataSource" k-on-change="changeClinic()"></select>\n                          <a class="k-button" ng-click="closeBook()" style="width: 120px;height:28px;background-color:{{currentBookingColor}}"><p translate="NewBookingButton"></p></a>\n                          <a class="k-button" ng-show="cancelCopyVisible" ng-click="cancelCopy()"><p translate="CancelCopy"></p></a>\n                          <a class="k-button" ng-show="cancelMoveVisible" ng-click="cancelMove()"><p translate="CancelMove"></p></a>\n\n                  <!--<a class="k-button fa fa-times fa-lg" ng-show="cancelMoveVisible" ng-click="cancelMove()"><p translate="CancelMove"></p></a>-->\n                </div>\n                <div>\n                  <div kendo-splitter="splitter3"\n                       k-panes="[{collapsible: true, size: \'40%\'},{collapsible: true}]"\n                       k-orientation="\'horizontal\'" style="height:100%">\n                      <div>\n                        <div kendo-splitter="splitter3"\n                             k-panes="[{collapsible: true, size: \'100px\'},{collapsible: true}]"\n                             k-orientation="\'horizontal\'" style="height:100%">\n                             <div>\n                               <div id="itemFilters">\n\n                                 <!--<div kendo-list-view  k-data-source="schedulerOptions_resourceDS">\n                                      <div id="itemsForFilter" k-template>\n                          				        <input checked type="checkbox"  value="{{dataItem.value}}"> {{ dataItem.text}}\n                                      </div>\n                                  </div>-->\n                                  <div id="allCheckbox" style="font-weight:bold;background-color:{{currentBookingColor}}">\n                                    <input  type="checkbox" ng-model="checked" value="All" ng-click="filterAllScheduler()" ng-checked="allChecked"> All\n                                  </div>\n                                 <div id="itemsForFilter" ng-repeat="itemresource in schedulerOptions_resourceDS.data()">\n\n                                   <input  type="checkbox" ng-model="checked" value="{{itemresource.value}}" ng-click="filterScheduler()"> {{ itemresource.text}}\n\n                                 </div>\n\n                               </div>\n                             </div>\n                             <div>\n                               <div  id="scheduler"  kendo-scheduler="bookScheduler" k-options="schedulerOptions" k-ng-delay="schedulerOptions" ></div>\n                             </div>\n                        </div>\n\n                        <!--scheduler-->\n                        <!--<div><button type="button" name="filterItemBtn" ng-click="filterItems()">Filter Items</button></div>\n                        -->\n\n\n\n                      </div>\n                      <div >\n                        <div kendo-splitter="splitter4"\n                             k-panes="[{collapsible: true, size: \'30%\'},{collapsible: false,size:\'70%\'}]"\n                             k-orientation="\'vertical\'" style="height:100%">\n                             <div>\n                               <div style="background-color:{{messageAlertsColor}};font-Weight:bold;padding-left:3px;"><img src="/BookingSystem/assets/images/45ae760e.online-message.png" height="24" width="24">&nbsp;<span translate="BookingAlerts"></span></div>\n                               <div kendo-grid="itemGrid"  k-options="itemGridOptions" k-ng-delay="itemGridOptions"></div>\n                             </div>\n\n                             <div>\n                               <div id="cover" ng-show="disableDIV"></div>\n                               <div style="background-color:{{currentBookingColor}};font-Weight:bold;padding-left:3px;"><img src="/BookingSystem/assets/images/a0140966.editing.png" height="24" width="24"><span translate="CurrentBooking"></span></div>\n                               <div id="currentBookGridID" kendo-grid="currentBookGrid"  k-options="currentBookGridOptions" k-ng-delay="currentBookGridOptions"></div>\n                               <div id="currentDetailGridID" kendo-grid="currentDetailGrid"  k-options="currentDetailGridOptions" k-ng-delay="currentDetailGridOptions" ng-show="currentGridVisible" ></div>\n                               <div style="background-color:{{allBookingColor}};font-Weight:bold;padding-left:3px;"><img src="/BookingSystem/assets/images/16469ef0.all-booking.png" height="24" width="24"><span translate="AllBookings"></span></div>\n                               <div id="bookGridID" kendo-grid="bookGrid"  k-options="mainGridOptions" k-ng-delay="mainGridOptions"></div>\n\n                             </div>\n\n                  </div>\n                </div>\n              </div>\n\n\n\n              <div  style="display:none" kendo-window="win1" k-title="\'Calendar\'" k-on-open="win1visible = true" k-on-close="win1visible = false" k-modal="true">\n                        <div kendo-calendar></div>\n                        <button type="button" id="close2" ng-click="cancelSave()">Close this Window</button>\n              </div>\n              <span kendo-notification="schedulerNotif" k-append-to="\'#scheduler\'"></span>\n    <script id="customEditorTemplate" type="text/x-kendo-template">\n\n    <div class="k-edit-label">\n        <label for="start">{{BookGridStart}}</label>\n    </div>\n    <div data-container-for="start" class="k-edit-field">\n        <input type="text"\n               data-role="datetimepicker"\n               data-type="date"\n               data-bind="value:start,invisible:isAllDay"\n               name="start" required="required" />\n        <span data-for="start" class="k-invalid-msg" style="display: none;"></span>\n    </div>\n    <div class="k-edit-label"><label for="bookDuration"><p translate="Duration"></p></label></div>\n    <div data-container-for="bookDuration" class="k-edit-field">\n        <!--<input type="text" name="bookDuration" class="k-input k-textbox" data-bind="value:bookDuration" style="width:100px">-->\n        <input kendo-numeric-text-box="bookDuration" k-format="\'n0\'" k-step="5" k-min="5" k-on-change="dataItem.dirty=true"  k-ng-model="dataItem.bookDuration" />\n\n    </div>\n    <!--\n    <div class="k-edit-label"><label for="end"><p translate="EndTime"></p></label></div>\n    <div data-container-for="end" class="k-edit-field">\n        <input type="text" data-type="date" data-role="datetimepicker" data-bind="value:end,invisible:isAllDay" name="end" data-datecompare-field="start" data-datecompare-msg="End date should be greater than or equal to the start date" />\n        <input type="text" data-type="date" data-role="datepicker" data-bind="value:end,visible:isAllDay" name="end" data-datecompare-field="start" data-datecompare-msg="End date should be greater than or equal to the start date" />\n        <span data-bind="text: endTimezone"></span>\n        <span data-bind="text: startTimezone, invisible: endTimezone"></span>\n        <span data-for="end" class="k-invalid-msg" style="display: none;"></span>\n    </div>\n  -->\n<!--<div class="k-edit-label"><label for="isAllDay">All day event</label></div>\n    <div data-container-for="isAllDay" class="k-edit-field">\n        <input type="checkbox" name="isAllDay" data-type="boolean" data-bind="checked:isAllDay">\n      </div>\n    <div class="k-edit-label"><label for="recurrenceRule">Repeat</label></div>\n    <div data-container-for="recurrenceRule" class="k-edit-field">\n        <div data-bind="value:recurrenceRule" name="recurrenceRule" data-role="recurrenceeditor"></div>\n    </div>\n\n\n\n    <div class="k-edit-label"><label for="description">Description</label></div>\n    <div data-container-for="description" class="k-edit-field">\n        <textarea name="description" class="k-textbox" data-bind="value:description"></textarea>\n    </div>\n    <div class="k-edit-label"><label for="clinicId">Clinic</label></div>\n    <div data-container-for="clinicId" class="k-edit-field">\n        <textarea name="clinicId" class="k-textbox" data-bind="value:clinicId"></textarea>\n    </div>\n-->\n  <div class="k-edit-label"><label for="serviceItem1"><p translate="ServiceItem1"></p></label></div>\n  <div data-container-for="serviceItem1" class="k-edit-field">\n    <!--<input type="text" name="serviceItem1" class="k-input k-textbox" data-bind="value:serviceItem1">-->\n    <input  name="serviceItem1"\n           kendo-drop-down-list\n           k-data-source=\'serviceItemDS\'\n           k-data-text-field="\'itemDesc\'"\n           k-data-value-field="\'itemCode\'" k-on-change="dataItem.dirty=true"  k-ng-model="dataItem.serviceItem1" style="width:100%;"/>\n    <div class="book-alert-msg">{{dataItem.serviceItemEnMsg1}}</div>\n  </div>\n  <div class="k-edit-label"><label for="serviceItem2"><p translate="ServiceItem2"></p></label></div>\n  <div data-container-for="serviceItem2" class="k-edit-field">\n  <input  name="serviceItem2"\n         kendo-drop-down-list\n         k-data-source=\'serviceItemDS\'\n         k-data-text-field="\'itemDesc\'"\n         k-data-value-field="\'itemCode\'" k-on-change="dataItem.dirty=true"  k-ng-model="dataItem.serviceItem2" style="width:100%;"/>\n  </div>\n  <div class="k-edit-label"><label for="serviceItem3"><p translate="ServiceItem3"></p></label></div>\n  <div data-container-for="serviceItem3" class="k-edit-field">\n  <input  name="serviceItem3"\n         kendo-drop-down-list\n         k-data-source=\'serviceItemDS\'\n         k-data-text-field="\'itemDesc\'"\n         k-data-value-field="\'itemCode\'" k-on-change="dataItem.dirty=true"  k-ng-model="dataItem.serviceItem3" style="width:100%;"/>\n  </div>\n  <div class="k-edit-label"><label for="serviceItem4"><p translate="ServiceItem4"></p></label></div>\n  <div data-container-for="serviceItem4" class="k-edit-field">\n  <input  name="serviceItem4"\n         kendo-drop-down-list\n         k-data-source=\'serviceItemDS\'\n         k-data-text-field="\'itemDesc\'"\n         k-data-value-field="\'itemCode\'" k-on-change="dataItem.dirty=true"  k-ng-model="dataItem.serviceItem4" style="width:100%;"/>\n  </div>\n  <div class="k-edit-label"><label for="serviceItem5"><p translate="ServiceItem5"></p></label></div>\n  <div data-container-for="serviceItem5" class="k-edit-field">\n  <input  name="serviceItem5"\n         kendo-drop-down-list\n         k-data-source=\'serviceItemDS\'\n         k-data-text-field="\'itemDesc\'"\n         k-data-value-field="\'itemCode\'" k-on-change="dataItem.dirty=true"  k-ng-model="dataItem.serviceItem5" style="width:100%;"/>\n  </div>\n  <div class="k-edit-label"><label for="serviceRemark"><p translate="Remark"></p></label></div>\n  <div data-container-for="serviceRemark" class="k-edit-field">\n    <textarea  name="serviceRemark" rows="5" cols="80" class="k-textbox" data-bind="value:serviceRemark"></textarea>\n  </div>\n  <!--\n    <div class="k-edit-label"><label for="md5Password">Password</label></div>\n    <div  data-container-for="md5Password" class="k-edit-field">\n        <input type="password" class="k-input k-textbox" name="md5Password" required="required" data-bind="value:md5Password" data-required-msg="Password is required!">\n        <span data-for="md5Password" class="k-invalid-msg" style="display: none;"></span>\n    </div>\n-->\n\n    <!--\n    <div class="k-edit-label"><label for="ownerId">Doctor</label></div>\n    <div data-container-for="drCode" class="k-edit-field">\n        <select id="drCode" data-bind="value:drCode" data-role="dropdownlist"\n                        data-value-field="value" data-text-field="text">\n          <option value="1">Alex</option>\n          <option value="2">Bob</option>\n          <option value="3">Charlie</option>\n      </select>\n      </div>\n      -->\n    </script>\n    <script id="patientEditorTemplate" type="text/x-kendo-template">\n    <div class="k-edit-label"><label for="patientName"><p translate="EnglishName"></p></label></div>\n    <div data-container-for="lastName" class="k-edit-field">\n        <input type="text" class="k-input k-textbox" name="lastName" placeholder="Last" required="required" data-bind="value:lastName" style="width:100px;">\n        <span data-for="lastName" class="k-invalid-msg" style="display: none;"></span>\n        -<input type="text" class="k-input k-textbox" name="middleName" placeholder="Middle"  data-bind="value:middleName" style="width:100px;">\n        -<input type="text" class="k-input k-textbox" name="firstName" placeholder="First"  data-bind="value:firstName" style="width:100px;">\n        <span data-for="firstName" class="k-invalid-msg" style="display: none;"></span>\n    </div>\n    <div class="k-edit-label"><label for="patientName"><p translate="ChineseName"></p></label></div>\n    <div data-container-for="patientName" class="k-edit-field">\n        <input type="text" class="k-input k-textbox" name="patientName" placeholder="???  data-bind="value:patientName">\n        <span data-for="patientName" class="k-invalid-msg" style="display: none;"></span>\n    </div>\n    <div class="k-edit-label"><label for="patientTel"><p translate="PatientTel"></p></label></div>\n    <div data-container-for="patientTel" class="k-edit-field">\n        <input type="text" class="k-input k-textbox" name="patientTel" required="required" data-bind="value:patientTel">\n        <!--<input k-on-change="dataItem.dirty=true" kendo-numeric-text-box k-min="0" k-max="100" k-ng-model="dataItem.patientTel" style="width: 100%;" />-->\n        <span data-for="patientTel" class="k-invalid-msg" style="display: none;"></span>\n    </div>\n    <div class="k-edit-label"><label for="patientSex"><p translate="PatientSex"></p></label></div>\n    <div data-container-for="patientSex" class="k-edit-field">\n\n      <input type="radio" class="k-radio" name="patientSex" id="ps1" value="M"   data-bind="checked:patientSex">\n      <label class="k-radio-label" for="ps1">Male</label>\n      <input type="radio" class="k-radio" name="patientSex" id="ps2" value="F"  data-bind="checked:patientSex">\n      <label class="k-radio-label" for="ps2">Female</label>\n    </div>\n    <div class="k-edit-label"><label for="patientHkid">HKID</label></div>\n    <div data-container-for="patientHkid" class="k-edit-field">\n        <input type="text" class="k-input k-textbox" name="patientHkid" data-bind="value:patientHkid" style="width:100px;">\n    </div>\n    <div class="k-edit-label">\n        <label for="dateOfBirth"><p translate="DayOfBirth"></p></label>\n    </div>\n    <div data-container-for="dateOfBirth" class="k-edit-field">\n        <input type="text"\n               data-role="datepicker"\n               data-type="date"\n               data-bind="value:dateOfBirth"\n               name="dateOfBirth" required="required" placeholder="YYYY-MM-DD"/>\n        <span data-for="dateOfBirth" class="k-invalid-msg" style="display: none;"></span>\n    </div>\n    <div class="k-edit-label"><label for="vip">VIP</label></div>\n    <div data-container-for="vip" class="k-edit-field">\n      <input type="checkbox"  name="vip" data-type="boolean" data-bind="checked:vip">\n    </div>\n    <!--\n    <div class="k-edit-label"><label for="md5Password">Password</label></div>\n    <div  data-container-for="md5Password" class="k-edit-field">\n        <input type="password" class="k-input k-textbox" name="md5Password" required="required" data-bind="value:md5Password" data-required-msg="Password is required!">\n        <span data-for="md5Password" class="k-invalid-msg" style="display: none;"></span>\n    </div>\n    -->\n    <div class="k-edit-label"><label for="referingDoctor"><p translate="ReferingDoctor"></p></label></div>\n    <div  data-container-for="referingDoctor" class="k-edit-field">\n        <input type="text" class="k-input k-textbox" name="referingDoctor"  data-bind="value:referingDoctor">\n        <span data-for="referingDoctor" class="k-invalid-msg" style="display: none;"></span>\n    </div>\n    <div class="k-edit-label"><label for="referingDrPhone"><p translate="ReferingDrPhone"></p></label></div>\n    <div  data-container-for="referingDrPhone" class="k-edit-field">\n        <input type="text" class="k-input k-textbox" name="referingDrPhone"  data-bind="value:referingDrPhone">\n        <span data-for="referingDrPhone" class="k-invalid-msg" style="display: none;"></span>\n    </div>\n    <div class="k-edit-label"><label for="patientAlert"><p translate="PatientAlert"></p></label></div>\n    <div  data-container-for="patientAlert" class="k-edit-field">\n        <textarea rows="8" cols="80" class=" k-textbox" name="patientAlert"  data-bind="value:patientAlert"></textarea>\n        <span data-for="patientAlert" class="k-invalid-msg" style="display: none;"></span>\n    </div>\n    <div class="k-edit-label"><label for="specialRequest"><p translate="SpecialRequest"></p></label></div>\n    <div  data-container-for="specialRequest" class="k-edit-field">\n        <textarea rows="8" cols="80" class=" k-textbox" name="specialRequest"  data-bind="value:specialRequest"></textarea>\n        <span data-for="specialRequest" class="k-invalid-msg" style="display: none;"></span>\n    </div>\n\n\n    <!--\n    <div class="k-edit-label"><label for="ownerId">Doctor</label></div>\n    <div data-container-for="drCode" class="k-edit-field">\n        <select id="drCode" data-bind="value:drCode" data-role="dropdownlist"\n                        data-value-field="value" data-text-field="text">\n          <option value="1">Alex</option>\n          <option value="2">Bob</option>\n          <option value="3">Charlie</option>\n      </select>\n      </div>\n      -->\n    </script>\n\n    <script id="gridToolbarTemplate" type="text/x-kendo-template">\n          <!--<a kendo-tooltip="gridEditTip" k-content="editContent" k-position="kposition"  class="k-group k-button fa fa-pencil-square-o " href="\\#" ng-click="editBook()"></a>-->\n          <!--<a kendo-tooltip="gridDelTip" k-content="delContent"  k-position="kposition" class="k-group k-button fa fa-refresh " href="\\#" ng-click="refreshBook()"></a>\n          <a kendo-tooltip="gridMoveTip" k-content="moveContent"  k-position="kposition" class="k-group k-button fa fa-adjust " href="\\#" ng-click="moveBook()"></a>\n          <a kendo-tooltip="gridCopyTip" k-content="copyContent"  k-position="kposition" class="k-group k-button fa fa-files-o " href="\\#" ng-click="copyBook()"></a>-->\n          <a kendo-tooltip k-content="closeWinLabel"  k-position="kposition" class="k-group k-button fa fa-ban" href="\\#" ng-click="closeBook()"></a>\n          <a k-position="kposition">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a>\n          <a kendo-tooltip  k-position="kposition" style="color:red"><img src="/BookingSystem/assets/images/7bf2f37e.current-user.png" height="28" width="28">&nbsp;&nbsp;<b><font size="4">{{currentEditUser}}</font></b></a>\n\n\n    </script>\n\n    <script id="bookSubGridRowTemplate" type="text/x-kendo-template">\n	            <tr data-uid="#: uid #">\n		            <td>\n                  #:itemDesc#     <!--<img src="/BookingSystem/assets/images/a0140966.editing.png"/>-->\n		            </td>\n		            <td class="details">\n			           #: kendo.format("{0:yyyy-MM-dd}", start)#&nbsp;<font color=red><b>#: kendo.format("{0:HH:mm}", start)#</b></font>\n		            </td>\n                <td class="country">\n			            #: bookDuration #\n		            </td>\n		            <td >\n                    #if(serviceItem1!==null && serviceItem1!==""){#\n                    <span class="mixMessage">#: serviceItem1#-#: serviceItemDesc1#</span>\n                    #}#\n                    #if(serviceItemMsg1!==null && serviceItemMsg1!==""){#\n                    <span class="book-alert-msg">#: serviceItemMsg1#</span>\n                    #}#\n                   #if(serviceItem2!==null && serviceItem2!==""){#\n                   <span class="mixMessage">#: serviceItem2#-#: serviceItemDesc2#</span>\n                   #}#\n                   #if(serviceItemMsg2!==null && serviceItemMsg2!==""){#\n                   <span class="book-alert-msg">#: serviceItemMsg2#</span>\n                   #}#\n		            </td>\n	           </tr>\n  </script>\n'),
a.put("/BookingSystem/app/clinicpage/clinicpage.html",'<div kendo-splitter\n     k-panes="[{collapsible: true, size: \'30%\'},{collapsible: true}]"\n     k-orientation="\'vertical\'"  ng-style="style2()" resize2>\n     <div >\n       <div kendo-grid="clinicGrid" k-options="clinicGridOptions" k-ng-delay="clinicGridOptions" style="height:98%"></div>\n     </div>\n     <div >\n       <div id="clinicTabStripID" class="clinicTabStripCss" kendo-tab-strip="clinicTabStrip" k-options="tabStripOptions" k-content-urls="[ null, null,null,null]" style="height:98%">\n              <!-- tab list -->\n              <ul>\n                <li id="clinic_items" class="k-state-active"><p translate="BookingItemsSetting"></p></li>\n                <li id="work_hours"><p translate="WorkHoursSetting"></p></li>\n                <li id="special_work_hours"><p translate="SpecialWorkHoursSetting"></p></li>\n                <li id="scheduler_parameters"><p translate="SchedulerParametersSetting"></p></li>\n              </ul>\n\n              <div style="padding: 1em;">\n\n                <div kendo-grid="itemsGrid" k-options="itemsGridOptions" k-ng-delay="itemsGridOptions"></div>\n              </div>\n\n              <div style="padding: 1em;">\n\n                <div kendo-splitter\n                     k-panes="[{collapsible: false, size: \'200px\'},{collapsible: false}]"\n                     k-orientation="\'horizontal\'" ng-style="style3()" resize2 >\n                     <div>\n                       <div kendo-tree-view="hoursTree" k-options="dayTreeOptions" k-rebind="dayTreeOptions" k-on-change="hoursTreeClick(dataItem)"></div>\n                     </div>\n                     <div>\n                       <div kendo-grid="workhourGrid" k-options="workhourGridOptions" k-ng-delay="workhourGridOptions"></div>\n                     </div>\n                </div>\n              </div>\n              <div style="padding: 1em;">\n\n                <div kendo-grid="specialDateGrid" k-options="specialDateGridOptions" k-ng-delay="specialDateGridOptions"></div>\n              </div>\n\n              <div style="padding: 1em;">\n\n                 <div kendo-grid="parasDateGrid" k-options="parasGridOptions" k-ng-delay="parasGridOptions"></div>\n              </div>\n            </div>\n\n     </div>\n</div>\n'),a.put("/BookingSystem/app/griddemo/griddemo.html",'<div mytoolbar testoption="visibelAttrs"></div>\n<div kendo-grid="myGrid" options="mainGridOptions" k-rebind="mainGridOptions.language"></div>\n'),a.put("/BookingSystem/app/itempage/itempage.html",'<div kendo-grid="itemGrid" k-options="itemGridOptions" k-ng-delay="itemGridOptions"></div>\n'),a.put("/BookingSystem/app/login/login.html",'<div class="col-md-12">\n  <div ng-show="error" class="alert alert-danger">{{error}}</div>\n  <form name="form" ng-submit="login()" role="form">\n    <div class="form-group">\n        <label for="username">Username</label>\n        <i class="fa fa-key"></i>\n        <input type="text" name="username" id="username" class="form-control" ng-model="username" required />\n        <span ng-show="form.username.$dirty && form.username.$error.required" class="help-block">Username is required</span>\n    </div>\n    <div class="form-group">\n        <label for="password">Password</label>\n        <i class="fa fa-lock"></i>\n        <input type="password" name="password" id="password" class="form-control" ng-model="password" required />\n        <span ng-show="form.password.$dirty && form.password.$error.required" class="help-block">Password is required</span>\n    </div>\n    <div class="form-actions">\n        <button type="submit" ng-disabled="form.$invalid || dataLoading" class="btn btn-danger">Login</button>\n        <img ng-if="dataLoading" src="data:image/gif;base64,R0lGODlhEAAQAPIAAP///wAAAMLCwkJCQgAAAGJiYoKCgpKSkiH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAEAAQAAADMwi63P4wyklrE2MIOggZnAdOmGYJRbExwroUmcG2LmDEwnHQLVsYOd2mBzkYDAdKa+dIAAAh+QQJCgAAACwAAAAAEAAQAAADNAi63P5OjCEgG4QMu7DmikRxQlFUYDEZIGBMRVsaqHwctXXf7WEYB4Ag1xjihkMZsiUkKhIAIfkECQoAAAAsAAAAABAAEAAAAzYIujIjK8pByJDMlFYvBoVjHA70GU7xSUJhmKtwHPAKzLO9HMaoKwJZ7Rf8AYPDDzKpZBqfvwQAIfkECQoAAAAsAAAAABAAEAAAAzMIumIlK8oyhpHsnFZfhYumCYUhDAQxRIdhHBGqRoKw0R8DYlJd8z0fMDgsGo/IpHI5TAAAIfkECQoAAAAsAAAAABAAEAAAAzIIunInK0rnZBTwGPNMgQwmdsNgXGJUlIWEuR5oWUIpz8pAEAMe6TwfwyYsGo/IpFKSAAAh+QQJCgAAACwAAAAAEAAQAAADMwi6IMKQORfjdOe82p4wGccc4CEuQradylesojEMBgsUc2G7sDX3lQGBMLAJibufbSlKAAAh+QQJCgAAACwAAAAAEAAQAAADMgi63P7wCRHZnFVdmgHu2nFwlWCI3WGc3TSWhUFGxTAUkGCbtgENBMJAEJsxgMLWzpEAACH5BAkKAAAALAAAAAAQABAAAAMyCLrc/jDKSatlQtScKdceCAjDII7HcQ4EMTCpyrCuUBjCYRgHVtqlAiB1YhiCnlsRkAAAOwAAAAAAAAAAAA=="/>\n    </div>\n  </form>\n</div>\n'),a.put("/BookingSystem/app/main/main.html",'\n<!--<div background-image-directive="{{homeBackImage}}" ng-style="{\'height\': homeHeight}">-->\n<div id="mainPage" ng-style="{\'height\': homeHeight}">\n<!--<img src="/BookingSystem/assets/images/327a547b.nurse-cartoon-doctor.jpg" height="200" width="100">-->\n\n</div>\n'),a.put("/BookingSystem/app/main/tab1.html","<div ui-view></div>\n"),a.put("/BookingSystem/app/main/tab2.html","<div ui-view></div>\n"),a.put("/BookingSystem/app/menulabelpage/menulabelpage.html",'  <div kendo-grid="menulabelGrid" k-options="menuGridOptions" k-ng-delay="menuGridOptions"></div>\n'),a.put("/BookingSystem/app/rolepage/rolepage.html",'\n<div class="k-content" ng-style="style2()" resize2 >\n<div kendo-splitter="splitter3"\n     k-panes="[{collapsible: false, size: \'50%\'},{collapsible: false}]"\n     k-orientation="\'horizontal\'" style="height:100%">\n    <div>\n\n      <div kendo-grid="roleGrid" k-options="roleGridOptions" k-ng-delay="roleGridOptions" k-change="changeRole"></div>\n\n    </div>\n    <div>\n\n      <div kendo-toolbar k-options="toolbarOptions"></div>\n      <div ><h4><p translate="SystemMenuList"></p></h4></div>\n      <div kendo-tree-view="tree"\n       k-checkboxes="checkboxes"\n       k-check="onCheck"\n       k-options="treeRoleOptions"\n       k-rebind="treeRoleOptions"\n      </div>\n\n    </div>\n</div>\n</div>\n'),a.put("/BookingSystem/app/scheduledemo/scheduledemo.html",'\n\n    <!--<p translate="APP_NAME"></p>-->\n\n\n\n    <div  kendo-splitter="schedulerSplitter1"\n                     k-panes="[{collapsible: false,resizable: false, size: \'30px\'},{collapsible: false }]"\n                     k-orientation="\'vertical\'"  ng-style="style2()" resize2>\n                <div class="">\n                  <select id="clinics"\n                          kendo-drop-down-list style="width: 50%"\n                          k-options="clinicsOptions" k-ng-delay="clinicsOptions.dataSource" k-on-change="changeClinic()"></select>\n                  <button class="k-primary fa fa-times fa-lg" ng-show="cancelCopyVisible" ng-click="cancelCopy()">Cancel [Copy] Mode</button>\n                  <button class="k-primary fa fa-times fa-lg" ng-show="cancelMoveVisible" ng-click="cancelMove()">Cancel [Move] Mode</button>\n                </div>\n                <div>\n                  <div kendo-splitter="splitter3"\n                       k-panes="[{collapsible: true, size: \'50%\'},{collapsible: true}]"\n                       k-orientation="\'horizontal\'" style="height:100%">\n                      <div>\n\n                        <!--scheduler-->\n                        <div id="scheduler" kendo-scheduler="bookScheduler" k-options="schedulerOptions" k-ng-delay="schedulerOptions" k-rebind="schedulerOptions"></div>\n\n                      </div>\n                      <div>\n                        <div kendo-grid="bookGrid"  k-options="mainGridOptions" k-ng-delay="mainGridOptions"></div>\n                      </div>\n                  </div>\n                </div>\n              </div>\n\n\n\n              <div  style="display:none" kendo-window="win1" k-title="\'Calendar\'" k-on-open="win1visible = true" k-on-close="win1visible = false" k-modal="true">\n                        <div kendo-calendar></div>\n                        <button type="button" id="close2" ng-click="cancelSave()">Close this Window</button>\n              </div>\n              <span kendo-notification="schedulerNotif" k-append-to="\'#scheduler\'"></span>\n    <script id="customEditorTemplate" type="text/x-kendo-template">\n    <div class="k-edit-label"><label for="title">Title</label></div>\n    <div data-container-for="title" class="k-edit-field">\n        <input type="text" class="k-input k-textbox" name="title" required="required" data-bind="value:title">\n    </div>\n    <div class="k-edit-label">\n        <label for="start">Start</label>\n    </div>\n    <div data-container-for="start" class="k-edit-field">\n        <input type="text"\n               data-role="datetimepicker"\n               data-type="date"\n               data-bind="value:start,invisible:isAllDay"\n               name="start"/>\n        <input type="text" data-type="date" data-role="datepicker" data-bind="value:start,visible:isAllDay" name="start" />\n        <!--<span data-bind="text: startTimezone"></span>-->\n        <span data-for="start" class="k-invalid-msg" style="display: none;"></span>\n    </div>\n    <div class="k-edit-label"><label for="end">End</label></div>\n    <div data-container-for="end" class="k-edit-field">\n        <input type="text" data-type="date" data-role="datetimepicker" data-bind="value:end,invisible:isAllDay" name="end" data-datecompare-msg="End date should be greater than or equal to the start date" />\n        <input type="text" data-type="date" data-role="datepicker" data-bind="value:end,visible:isAllDay" name="end" data-datecompare-msg="End date should be greater than or equal to the start date" />\n        <span data-bind="text: endTimezone"></span>\n        <span data-bind="text: startTimezone, invisible: endTimezone"></span>\n        <span data-for="end" class="k-invalid-msg" style="display: none;"></span>\n    </div>\n\n    <!--<div class="k-edit-label"><label for="isAllDay">All day event</label></div>\n    <div data-container-for="isAllDay" class="k-edit-field">\n        <input type="checkbox" name="isAllDay" data-type="boolean" data-bind="checked:isAllDay">\n      </div>\n    <div class="k-edit-label"><label for="recurrenceRule">Repeat</label></div>\n    <div data-container-for="recurrenceRule" class="k-edit-field">\n        <div data-bind="value:recurrenceRule" name="recurrenceRule" data-role="recurrenceeditor"></div>\n    </div>\n-->\n    <div class="k-edit-label"><label for="description">Description</label></div>\n    <div data-container-for="description" class="k-edit-field">\n        <textarea name="description" class="k-textbox" data-bind="value:description"></textarea>\n    </div>\n    <div class="k-edit-label"><label for="clinicId">Clinic</label></div>\n    <div data-container-for="clinicId" class="k-edit-field">\n        <textarea name="clinicId" class="k-textbox" data-bind="value:clinicId"></textarea>\n    </div>\n    <div class="k-edit-label"><label for="md5Password">Password</label></div>\n    <div  data-container-for="md5Password" class="k-edit-field">\n        <input type="password" class="k-input k-textbox" name="md5Password" required="required" data-bind="value:md5Password" data-required-msg="Password is required!">\n        <span data-for="md5Password" class="k-invalid-msg" style="display: none;"></span>\n    </div>\n\n\n    <!--\n    <div class="k-edit-label"><label for="ownerId">Doctor</label></div>\n    <div data-container-for="drCode" class="k-edit-field">\n        <select id="drCode" data-bind="value:drCode" data-role="dropdownlist"\n                        data-value-field="value" data-text-field="text">\n          <option value="1">Alex</option>\n          <option value="2">Bob</option>\n          <option value="3">Charlie</option>\n      </select>\n      </div>\n      -->\n    </script>\n    <script id="gridToolbarTemplate" type="text/x-kendo-template">\n          <a kendo-tooltip="gridEditTip" k-content="editContent" k-position="kposition"  class="k-group k-button fa fa-pencil-square-o " href="\\#" ng-click="editBook()"></a>\n          <a kendo-tooltip="gridDelTip" k-content="delContent"  k-position="kposition" class="k-group k-button fa fa-times " href="\\#" ng-click="delBook()"></a>\n          <a kendo-tooltip="gridMoveTip" k-content="moveContent"  k-position="kposition" class="k-group k-button fa fa-adjust " href="\\#" ng-click="moveBook()"></a>\n          <a kendo-tooltip="gridCopyTip" k-content="copyContent"  k-position="kposition" class="k-group k-button fa fa-files-o " href="\\#" ng-click="copyBook()"></a>\n    </script>\n'),a.put("/BookingSystem/app/treedemo/treedemo.html",'<div kendo-tree-view="tree"\n                 k-data-source="treeData"\n                 k-on-change="selectedItem = dataItem">\n                 <!--<span ng-if="dataItem.url===\'treedemo\'" k-template >\n                      <a ui-sref="{{dataItem.url}}">{{dataItem.text}}</a>\n                 </span>\n                 <span ng-if="dataItem.url===\'\'" k-template >\n                      <a ui-sref="#">{{dataItem.text}}</a><button>ttest</button>\n                 </span>-->\n</div>\n'),a.put("components/modal/modal.html",'<div class="modal-header">\r\n  <button ng-if="modal.dismissable" type="button" ng-click="$dismiss()" class="close">&times;</button>\r\n  <h4 ng-if="modal.title" ng-bind="modal.title" class="modal-title"></h4>\r\n</div>\r\n<div class="modal-body">\r\n  <p ng-if="modal.text" ng-bind="modal.text"></p>\r\n  <div ng-if="modal.html" ng-bind-html="modal.html"></div>\r\n</div>\r\n<div class="modal-footer">\r\n  <button ng-repeat="button in modal.buttons" ng-class="button.classes" ng-click="button.click($event)" ng-bind="button.text" class="btn"></button>\r\n</div>'),a.put("components/navbar/navbar.html",'<div class="navbar navbar-default navbar-static-top" ng-controller="NavbarCtrl">\n  <div class="container">\n    \n    <div class="navbar-header">\n      <button class="navbar-toggle" type="button" ng-click="isCollapsed = !isCollapsed">\n        <span class="sr-only">Toggle navigation</span>\n        <span class="icon-bar"></span>\n        <span class="icon-bar"></span>\n        <span class="icon-bar"></span>\n      </button>\n      <a href="/" class="navbar-brand">angulardemo</a>\n    </div>\n    <div collapse="isCollapsed" class="navbar-collapse collapse" id="navbar-main">\n      <ul class="nav navbar-nav">\n        <li ng-repeat="item in menu" ng-class="{active: isActive(item.link)}">\n            <a ng-href="{{item.link}}">{{item.title}}</a>\n        </li>\n      </ul>\n    </div>\n\n  </div>\n</div>\n'),a.put("components/partials/toolbar.html",'\n<div kendo-toolbar k-options="toolbarOptions" ng-click="doOperation(item)"></div>\n')}]);